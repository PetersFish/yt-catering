function getWechatMenuInfo(){$.get("/WeiXin/QueryMenu/",function(n){var i,u,t;if(n&&n.succeed){var f=JSON.parse(n.values),r=f.menu.button,t='<li style="width: 50px;" id=""><img src="/skin_N3/images/type-img.png" /><\/li>';if(r&&r.length>0){for(i=0;i<r.length;i++){if(t+='<li data-menu="1" class="menuList_li js_addMenuBox" data-media_id="'+(r[i].media_id||"")+'" data-url="'+(r[i].url||"")+'" data-name="'+r[i].name+'" data-add="0" data-type="'+(r[i].type||"")+'" data-key="'+(r[i].key||"")+'">',r[i].sub_button.length>0){for(t+="<span>"+r[i].name+"<\/span>",t+='<div class="big_box"><div class="sub_pre_menu_box"><ul class="menuList" id="menuList'+i+'">',u=0;u<r[i].sub_button.length;u++)t+='<li data-menu="2" class="js_addMenuBox" data-media_id="'+(r[i].sub_button[u].media_id||"")+'" data-url="'+(r[i].sub_button[u].url||"")+'" data-name="'+r[i].sub_button[u].name+'" data-type="'+(r[i].sub_button[u].type||"")+'" data-key="'+(r[i].sub_button[u].key||"")+'">',t+='<span class="jsSubView js_addL2Btn">',t+=""+r[i].sub_button[u].name+"<\/span><\/li>";r[i].sub_button.length<5&&(t+='<li class="js_addMenuBox" data-sub_addbtn="1">',t+='<span id="addmenu'+i+'" class="jsSubView js_addL2Btn icon-plus" title="\u6700\u591a\u6dfb\u52a05\u4e2a\u5b50\u83dc\u5355">',t+="<\/span><\/li>");t+="<\/ul><\/div><\/div>"}else t+="<span>"+r[i].name+"<\/span>",t+='<div class="big_box"><div class="sub_pre_menu_box"><ul class="menuList" id="menuList'+i+'">',t+='<li class="js_addMenuBox" data-sub_addbtn="1">',t+='<span id="addmenu'+i+'" class="jsSubView js_addL2Btn icon-plus" title="\u6700\u591a\u6dfb\u52a05\u4e2a\u5b50\u83dc\u5355" draggable="false">',t+="<\/span><\/li>",t+="<\/ul><\/div><\/div>";t+="<\/li>"}r.length<3&&(t+='<li class="menuList_li js_addMenuBox" data-type="media_id" data-add="1" id="add_menu" title="\u6700\u591a\u6dfb\u52a03\u4e2a\u4e00\u7ea7\u83dc\u5355"><span class="icon-plus menutext"><\/span>',t+='<div class="big_box"><div class="sub_pre_menu_box"><ul class="menuList">',t+='<li class="js_addMenuBox" data-sub_addbtn="1">',t+='<span id="addmenu" class="jsSubView js_addL2Btn icon-plus" title="\u6700\u591a\u6dfb\u52a05\u4e2a\u5b50\u83dc\u5355" draggable="false">',t+="<\/span><\/li>",t+="<\/ul><\/div><\/div><\/li>");$("#menu_theer").html(t)}}else t='<li style="width: 50px;" id=""><img src="/skin_N3/images/type-img.png" /><\/li>',t+='<li class="menuList_li js_addMenuBox" data-type="media_id" data-add="1" id="add_menu" title="\u6700\u591a\u6dfb\u52a03\u4e2a\u4e00\u7ea7\u83dc\u5355"><span class="icon-plus menutext"><\/span>',t+='<div class="big_box"><div class="sub_pre_menu_box"><ul class="menuList" id="menuList">',t+='<li class="js_addMenuBox" data-sub_addbtn="1">',t+='<span id="addmenu" class="jsSubView js_addL2Btn" title="\u6700\u591a\u6dfb\u52a05\u4e2a\u5b50\u83dc\u5355">',t+="<\/span><\/li>",t+="<\/ul><\/div><\/div><\/li>",$("#menu_theer").html(t),layer.msg(n.errmsg+"\u8bf7\u68c0\u67e5\u6216\u91cd\u65b0\u914d\u7f6e\u3002")})}function selectWechatMenuFn(n,t,i,r,u){var e,o,f;u=="1"?(e=$("#menu_theer li.active").parent("ul").children("li"),o='<li data-menu="2" class="js_addMenuBox" data-url="" data-name="\u4e8c\u7ea7\u83dc\u5355\u540d\u79f0" data-type="media_id" data-key=""><span class="jsSubView js_addL2Btn">\u4e8c\u7ea7\u83dc\u5355\u540d\u79f0<\/span><\/li>',e.length<5?($(o).insertBefore("#menu_theer li.active"),$("#menu_theer li.active").parent("ul").parent(".sub_pre_menu_box").parent(".big_box").parent(".menuList_li").removeAttr("data-type")):(f=$("#menu_theer li.active"),f.removeAttr("data-sub_addbtn"),f.attr("data-name","\u4e8c\u7ea7\u83dc\u5355\u540d\u79f0"),f.attr("data-type","media_id"),f.attr("data-key",""),f.attr("data-url",""),f.attr("data-media_id",""),f.attr("data-menu","2"),f.find(".js_addL2Btn").removeClass("icon-plus").html("\u4e8c\u7ea7\u83dc\u5355\u540d\u79f0"))):($("#Menu_more_value").val(t),n=="media_id"||n=="view_limited"?($("#menu_conten").show(0),$("#Menu_more_key_value").val(r),n=="view_limited"&&(n="media_id"),$("input.checkinput[data-menutype="+n+"]").click()):n=="view"?($("#menu_conten").show(0),$("input.checkinput[data-menutype="+n+"]").click(),$("#a_href_list").val(i)):n=="scancode_push"?($("#menu_conten").show(0),$("input.checkinput[data-menutype="+n+"]").click()):$("#menu_conten").hide(0))}function selectMaterialFn(){var n=$("#selectmessagetype li.active").attr("data-type");$.get("/WeiXin/GetForeverNews",{type:n},function(t){if(t.succeed==!0&&t.values!=null&&t.values!=""){var i=JSON.parse(t.values),r=i.total_count,u=Math.ceil(r/50);laypage({cont:$("#pageGro"),pages:u,skin:"molv",first:"\u9996\u9875",last:"\u5c3e\u9875",prev:"\u4e0a\u4e00\u9875",next:"\u4e0b\u4e00\u9875",jump:function(t){getForeverNews(t.curr,n)}})}})}function getForeverNews(n,t){$.get("/WeiXin/GetForeverNews",{pageIndex:n,pageSize:20,type:t},function(n){var i;if(n.succeed==!0&&n.values!=null&&n.values!=""){var h=JSON.parse(n.values),r=h.item,u="",f="",s="",e="",o="";for(i=0;i<r.length;i++)t=="news"?(f=r[i].content.news_item[0].thumb_url,s=r[i].content.news_item[0].url,e=r[i].content.news_item[0].title,o=r[i].media_id):t=="image"?(o=r[i].media_id,s=r[i].url,f=r[i].url,e=r[i].name):(t=="video"||t=="voice")&&(o=r[i].media_id,e=r[i].name,f="/skin_N3/images/shopimgupdonw.png"),u+='<li data-url="'+s+'" data-media_id="'+o+'" data-imgurl="'+f+'" data-title='+e+"><i><\/i>",u+='<img src="'+f+'" />',u+=' <p class="title">'+e+"<\/p>",u+="<\/li>";$("#selectMaterial").html(u)}})}$(document).ready(function(){getWechatMenuInfo()});$(document).unbind("click","#menu_theer li.js_addMenuBox").on("click","#menu_theer li.js_addMenuBox",function(){var i=$("#menu_theer li.menuList_li"),t,n;$("#menu_theer li").removeClass("active");$(this).addClass("active");t=$(this).attr("data-add");t!=1&&$(this).find(".big_box").show().parent("li").siblings("li.menuList_li").find(".big_box").hide(0);t==1&&i.length<3?(n='<li class="menuList_li js_addMenuBox active" data-menu="1" data-add="0" data-type="media_id" data-name="\u83dc\u5355\u540d\u79f0" id=""><span class="menutext">\u83dc\u5355\u540d\u79f0<\/span>',n+='<div class="big_box"><div class="sub_pre_menu_box"><ul class="menuList" id="menuList">',n+='<li class="js_addMenuBox" data-sub_addbtn="1">',n+='<span id="addmenu" class="jsSubView js_addL2Btn icon-plus" title="\u6700\u591a\u6dfb\u52a05\u4e2a\u5b50\u83dc\u5355">',n+="<\/span><\/li>",n+="<\/ul><\/div><\/div><\/li>",$("#menu_theer li").removeClass("active"),$(n).insertBefore(this)):i.length==3&&$(this).find(".menutext").text()==""&&$(this).attr("data-menu")!=2&&$(this).attr("data-sub_addbtn")!=1&&$(this).attr("data-menu")!="1"&&($(this).attr("data-name","\u83dc\u5355\u540d\u79f0"),$(this).attr("data-menu","1"),$(this).attr("data-add","0"),$(this).find(".menutext").removeClass("icon-plus").text("\u83dc\u5355\u540d\u79f0"));var r=$(this).attr("data-type"),u=$(this).attr("data-name"),f=$(this).attr("data-url"),e=$(this).attr("data-key"),o=$(this).attr("data-menu"),s=$("#menu_theer li.active").attr("data-sub_addbtn");return $(".menutexttips1").eq(o-1).show(0).siblings(".menutexttips1").hide(),selectWechatMenuFn(r,u,f,e,s),!1});$("#Menu_more_value").on("keyup",function(){var n=$(this).val().trim();$("#menu_theer li.active").attr("data-name",n);$("#menu_theer li.active").find("span").eq(0).text(n)});$("#Menu_more_key_value").on("keyup",function(){var n=$(this).val().trim();$("#menu_theer li.active").attr("data-key",n)});$(document).unbind("click","input[name='messagetype']").on("click","input[name='messagetype']",function(){var n=$(this).data("type"),t=$(this).attr("data-menutype");$("#menu_theer li.active").attr("data-type",t);n==0?($("#wechatUrlBox").hide(0),$("#menukey").show(0),$("#wechatTextPicturebox").show(0)):n==1?($("#wechatTextPicturebox").hide(0),$("#menukey").hide(0),$("#wechatUrlBox").show(0)):($("#wechatTextPicturebox").hide(0),$("#menukey").hide(0),$("#wechatUrlBox").hide(0))});$("#a_href_list").on("keyup",function(){var n=$(this).val().trim();$("#menu_theer li.active").attr("data-url",n)});$("#selectmessagetype li").click(function(){$(this).addClass("active").siblings("li").removeClass("active")});$("#picture-box1").click(function(){var n=$("#selectmessagetype li.active").attr("data-type");layerpage.Deke_layerpage.noneClosePage("1","\u4ece\u7d20\u6750\u5e93\u4e2d\u9009\u62e9\u7d20\u6750","/ajaxHtml_N3/wechat/selectMaterial.html?="+getTimeStamp(),["740px","500px"],selectMaterialFn)});$(document).unbind("click","#selectMaterial li").on("click","#selectMaterial li",function(){$(this).addClass("active").siblings("li").removeClass("active")});$(document).unbind("click","#btnSelectMaterial").on("click","#btnSelectMaterial",function(){var n=$("#selectMaterial li.active"),t=n.attr("data-media_id"),i=n.attr("data-imgurl");console.log(t,i);$("#menu_theer li.active").attr("data-media_id",t);layer.closeAll();layer.msg("\u9009\u62e9\u6210\u529f\uff01")});$("#btnSaveMenu").click(function(){var i=$("#menu_theer li.menuList_li[data-add='0']"),t={button:[]},n=!0;$.each(i,function(i){var h=$(this).find(".menuList li[data-menu='2']"),r=$(this).attr("data-type"),u=$(this).attr("data-name"),f="",s,e,o;if(r==""||r==undefined||r==null)s=[],$.each(h,function(t){var e=[],r=$(this).attr("data-type"),i=$(this).attr("data-name"),o="sub_menu_key_"+t,u,f;if(r!=""&&i!=""){if(r=="media_id"||r=="view_limited")if(u=$(this).attr("data-media_id"),u!=""&&u!=undefined&&u!=null&&i!=""&&i!=undefined&&i!=null)e={type:r,name:i,media_id:u,key:o};else{layer.msg(i+":\u8bf7\u9009\u62e9\u7d20\u6750\u6216\u586b\u5199\u540d\u79f0");n=!1;return}else if(r=="view")if(f=$(this).attr("data-url"),f!=""&&f!=undefined&&f!=null&&i!=""&&i!=undefined&&i!=null)e={type:r,name:i,key:o,url:f};else{layer.msg(i+":\u8bf7\u586b\u5199\u8df3\u8f6c\u94fe\u63a5\u6216\u586b\u5199\u540d\u79f0");n=!1;return}else e={type:r,name:i,key:o};s.push(e)}else{layer.msg("\u6570\u636e\u5b58\u5728\u9519\u8bef\uff0c\u8bf7\u68c0\u67e5\u83dc\u5355\u914d\u7f6e");n=!1;return}}),f={name:u,sub_button:s};else if(e=$(this).attr("data-media_id"),o=$(this).attr("data-url"),r!=""&&r!=undefined&&r!=null&&u!=""&&u!=undefined&&u!=null)if(r=="view")if(o!=""&&o!=undefined&&o!=null)f={name:u,type:r,key:"menu_key_"+i,url:o};else{layer.msg(u+":\u8bf7\u586b\u5199\u8df3\u8f6c\u94fe\u63a5");n=!1;return}else if(r=="media_id"||r=="view_limited")if(e!=""&&e!=undefined&&e!=null)f={name:u,type:r,key:"menu_key_"+i,media_id:e};else{layer.msg(u+":\u8bf7\u9009\u62e9\u7d20\u6750");n=!1;return}else f={name:u,type:r,key:"menu_key_"+i};else{layer.msg("\u6570\u636e\u5b58\u5728\u9519\u8bef\uff0c\u8bf7\u68c0\u67e5\u83dc\u5355\u914d\u7f6e");n=!1;return}t.button.push(f)});t&&t.button.length>0&&n&&(disableButtonById("btnSaveMenu"),$.post("/WeiXin/CreateMenu",t,function(n){if(n.succeed)layer.msg("\u53d1\u5e03\u6210\u529f\uff01"),enabledButtonById("btnSaveMenu"),getWechatMenuInfo();else{var t=n.errmsg;layer.msg(t);enabledButtonById("btnSaveMenu")}}))});$("#delete_btn").click(function(){var n=$("#menu_theer li.active"),r=n.attr("data-menu"),t,u,f,e,i;r=="1"?(n.remove(),t='<li class="menuList_li js_addMenuBox" data-type="media_id" data-add="1" id="add_menu" title="\u6700\u591a\u6dfb\u52a03\u4e2a\u4e00\u7ea7\u83dc\u5355"><span class="icon-plus menutext"><\/span>',t+='<div class="big_box"><div class="sub_pre_menu_box"><ul class="menuList">',t+='<li class="js_addMenuBox" data-sub_addbtn="1">',t+='<span id="addmenu" class="jsSubView js_addL2Btn icon-plus" title="\u6700\u591a\u6dfb\u52a05\u4e2a\u5b50\u83dc\u5355" draggable="false">',t+="<\/span><\/li>",t+="<\/ul><\/div><\/div><\/li>",$("#menu_theer").append(t)):r=="2"&&(u=n.siblings("li[data-menu='2']").length,f=n.parent("ul").parent(".sub_pre_menu_box").parent(".big_box").parent(".menuList_li"),u==0&&(n.remove(),f.addClass("active"),$("#menu_conten").show(0),$("input.checkinput[data-menutype='media_id']").click()),e=n.siblings("li[data-sub_addbtn='1']"),e.length==0&&(i='<li class="js_addMenuBox" data-sub_addbtn="1">',i+='<span id="addmenu" class="jsSubView js_addL2Btn icon-plus" title="\u6700\u591a\u6dfb\u52a05\u4e2a\u5b50\u83dc\u5355">',i+="<\/span><\/li>",n.parent("ul").append(i)),n.remove())});