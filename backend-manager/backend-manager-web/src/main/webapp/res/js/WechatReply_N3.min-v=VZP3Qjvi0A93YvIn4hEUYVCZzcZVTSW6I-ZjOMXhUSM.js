function selectMaterialFn(){var n=$("#selectmessagetype li.active").attr("data-type");$.get("/WeiXin/GetForeverNews",{type:n},function(t){if(t.succeed==!0&&t.values!=null&&t.values!=""){var i=JSON.parse(t.values),r=i.total_count,u=Math.ceil(r/50);laypage({cont:$("#pageGro"),pages:u,skin:"molv",first:"\u9996\u9875",last:"\u5c3e\u9875",prev:"\u4e0a\u4e00\u9875",next:"\u4e0b\u4e00\u9875",jump:function(t){getForeverNews(t.curr,n)}})}else layer.closeAll(),layer.msg(t.errmsg)})}function getForeverNews(n,t){$.get("/WeiXin/GetForeverNews",{pageIndex:n,pageSize:20,type:t},function(n){var i;if(n.succeed==!0&&n.values!=null&&n.values!=""){var h=JSON.parse(n.values),r=h.item,u="",f="",s="",e="",o="";for(i=0;i<r.length;i++)t=="news"?(f=r[i].content.news_item[0].thumb_url,s=r[i].content.news_item[0].url,e=r[i].content.news_item[0].title,o=r[i].media_id):t=="image"?(o=r[i].media_id,s=r[i].url,f=r[i].url,e=r[i].name):(t=="video"||t=="voice")&&(o=r[i].media_id,e=r[i].name,f="/skin_N3/images/shopimgupdonw.png"),u+='<li data-url="'+s+'" data-media_id="'+o+'" data-imgurl="'+f+'" data-title='+e+"><i><\/i>",u+='<img src="'+f+'" />',u+=' <p class="title">'+e+"<\/p>",u+="<\/li>";$("#selectMaterial").html(u)}})}function getWechatReplyMessageFn(n){$.get("/weixin/GetReplyRuleList?sv_rule_type_id="+n,function(t){if(t&&t.length>0){var i="";n==0?($.each(t,function(n,t){var u,r,n;if(i+="<tr>",i+="<td>"+t.sv_rule_type_name+"<\/td>",i+="<td>"+t.sv_rule_name+"<\/td>",i+="<td>",u=JSON.parse(t.sv_rule_keywards),u!=""&&u.length>0)for(n=0;n<u.length;n++)i+="<span>"+u[n].keywards_text+"<\/span><br />";if(i+="<\/td>",i+="<td>",r=JSON.parse(t.sv_rule_content),r!=""&&r.length>0)for(n=0;n<r.length;n++)i+=r[n].type=="text"?"<span>"+r[n].content+"<\/span><br />":"<span>"+r[n].media_id+"(\u7d20\u6750ID)<\/span><br />";i+="<\/td>";i+='<td class="changeproduct changeproduct2"><button class="btn deleteWechatMessageList" data-rule_id="'+t.sv_replyid+'">\u5220\u9664<\/button><\/td>';i+="<\/tr>"}),$("#messageRuleList").html(i),$("#wechatMessageList").show(0)):($("#sv_replyid").val(t[0].sv_replyid),$.each(t,function(n,t){i+="<tr>";i+="<td>"+t.sv_rule_type_name+"<\/td>";i+="<td>"+t.sv_rule_type_name+"<\/td>";var r=JSON.parse(t.sv_rule_content);i+="<td><\/td>";i+=r[0].type!="text"?"<td>"+r[0].media_id+"(\u7d20\u6750ID)<\/td>":"<td>"+r[0].content+"<\/td>";i+='<td class="changeproduct changeproduct2"><button class="btn deleteWechatMessageList" data-rule_id="'+t.sv_replyid+'">\u5220\u9664<\/button><\/td>';i+="<\/tr>"}),$("#messageRuleList").html(i),$("#wechatMessageList").show(0))}})}$("#selectmessagetype li").click(function(){var n=$(this).data("type");$(this).addClass("active").siblings("li").removeClass("active");n=="text"?($("#orthercontent").hide(0),$("#textcontent").show(0)):($("#textcontent").hide(0),$("#orthercontent").show(0))});$("#selecteMssagechecked input[name='messagetype']").click(function(){$("#sv_replyid").val("");var n=$(this).data("type");$("#messagecontent").empty();n==0?(getWechatReplyMessageFn(n),$("#needshowbox").show()):(getWechatReplyMessageFn(n),$("#needshowbox,#wechatMessageList").hide())});$("#picture-box1").click(function(){var n=$("#selectmessagetype li.active").attr("data-type");layerpage.Deke_layerpage.noneClosePage("1","\u4ece\u7d20\u6750\u5e93\u4e2d\u9009\u62e9\u7d20\u6750","/ajaxHtml_N3/wechat/selectMaterial.html?="+getTimeStamp(),["740px","500px"],selectMaterialFn)});$(document).unbind("click","#selectMaterial li").on("click","#selectMaterial li",function(){$(this).addClass("active").siblings("li").removeClass("active")});$(document).unbind("click","#btnSelectMaterial").on("click","#btnSelectMaterial",function(){var n=$("#selectMaterial li.active"),t=n.attr("data-media_id"),r=n.attr("data-imgurl"),f=n.attr("data-title"),e=$("#selectmessagetype li.active").data("type"),o=$("input[name='messagetype']:checked").data("type"),u,i;$("#menu_theer li.active").attr("data-media_id",t);u=$("#messagecontent li").length;u<5&&t?(i='<li data-content="" data-imgUrl="'+r+'" data-media_id="'+t+'" data-type="'+e+'"><button class="deleteMessageBtn deleteThisMessageBtn btn icon-trash" type="button"><\/button><div class="imgbox"><img src="'+r+'" alt="" /><p class="textmessage">'+f+"<\/p><\/div><\/li>",o==0?($("#messagecontent").append(i),layer.closeAll(),layer.msg("\u9009\u62e9\u6210\u529f\uff01")):($("#messagecontent").html(i),layer.closeAll(),layer.msg("\u9009\u62e9\u6210\u529f\uff01"))):layer.msg("\u8bf7\u9009\u62e9\u7d20\u6750\u5e76\u4e14\u6700\u591a\u4e00\u6b21\u53ef\u6dfb\u52a05\u6761\u6d88\u606f\uff01")});$("#deletrimebtntext").click(function(){var i=$("#selectmessagetype li.active").data("type"),n=$("#messageTypeContent").val().trim(),r=$("#messagecontent li").length,u=$("input[name='messagetype']:checked").data("type"),t;n&&r<5?(t='<li data-content="'+n+'" data-imgUrl="" data-media_id="" data-type="'+i+'"><button class="deleteMessageBtn deleteThisMessageBtn btn icon-trash" type="button"><\/button><p>'+n+"<\/p><\/li>",u==0?($("#messagecontent").append(t),$("#messageTypeContent").val("")):($("#messagecontent").html(t),$("#messageTypeContent").val(""))):($("#messageTypeContent").focus(),layer.msg("\u8bf7\u8f93\u5165\u6587\u5b57\u5728\u6267\u884c\u6b64\u64cd\u4f5c\u5e76\u4e14\u6700\u591a\u4e00\u6b21\u53ef\u6dfb\u52a05\u6761\u6d88\u606f\uff01"))});$(document).unbind("click","#messagecontent .deleteThisMessageBtn").on("click","#messagecontent .deleteThisMessageBtn",function(){$(this).parent().remove()});$(document).unbind("click","#addkeywardscontent .addkeywardsbtn").on("click","#addkeywardscontent .addkeywardsbtn",function(){var t=$("#addkeywardscontent li").length,n;t<10?(n='<li><button class="deletekeywardsbtn deletekeywardslength icon-minus btn" type="button"><\/button><div class="rule_name">\u5173\u952e\u8bcd<\/div><div class="rule_name2"><select name="match" class="form-control"><option value="0">\u534a\u5339\u914d<\/option><option value="1">\u5168\u5339\u914d<\/option><\/select><\/div><div class="rule_input"><input type="text" class="form-control" maxlength="30" name="keywards-text" placeholder="\u8f93\u5165\u5173\u952e\u8bcd(\u6700\u591a30\u4e2a\u5b57)" value=""><\/div> <\/li>',$("#addkeywardscontent").append(n)):layer.msg("\u5173\u952e\u8bcd\u6700\u591a\u6dfb\u52a010\u6761\uff01")});$(document).unbind("click","#addkeywardscontent .deletekeywardslength").on("click","#addkeywardscontent .deletekeywardslength",function(){$(this).parent().remove()});$("#btnSaveWechatMessage").click(function(){var n={sv_replyid:$("#sv_replyid").val(),sv_rule_name:"",sv_rule_type_name:"",sv_rule_type_id:"",sv_rule_keywards:[],sv_rule_content:[]},t=$("input[name='messagetype']:checked").data("type"),i=!0,r,f,u;if(t==0){if(n.sv_rule_type_name="\u5173\u952e\u8bcd\u56de\u590d",n.sv_rule_type_id=t,r=$("#rule_name").val(),r)n.sv_rule_name=r;else return $("#rule_name").focus(),layer.msg("\u8bf7\u586b\u5199\u89c4\u5219\u540d\u79f0"),i=!1,!1;f=$("#addkeywardscontent li");$.each(f,function(){var u=$(this).find("select[name='match']").val(),t=$(this).find("input[name='keywards-text']").val(),r;if(t)r={type:u,keywards_text:t},n.sv_rule_keywards.push(r);else return $(this).find("input[name='keywards-text']").focus(),layer.msg("\u8bf7\u8f93\u5165\u5173\u952e\u8bcd"),i=!1,!1})}else t==1?(n.sv_rule_type_name="\u6536\u5230\u6d88\u606f\u56de\u590d",n.sv_rule_type_id=t):(n.sv_rule_type_name="\u88ab\u5173\u6ce8\u56de\u590d",n.sv_rule_type_id=t);if(u=$("#messagecontent li"),u.length>0)$.each(u,function(){var t=$(this).data("type"),r,i;if(t!="text")var u=$(this).data("imgurl"),f=$(this).data("media_id"),i={type:t,imgurl:u,media_id:f};else r=$(this).data("content"),i={type:t,content:r};n.sv_rule_content.push(i)});else return layer.msg("\u8bf7\u9009\u62e9\u6216\u586b\u5199\u56de\u590d\u6d88\u606f\u5185\u5bb9"),i=!1,!1;n.sv_rule_content=JSON.stringify(n.sv_rule_content);n.sv_rule_keywards=JSON.stringify(n.sv_rule_keywards);$.post("/weixin/SaveReplyRule",n,function(n){n?(layer.msg("\u4fdd\u5b58\u6210\u529f\uff01"),setTimeout(function(){location.reload()},1e3)):layer.msg("\u4fdd\u5b58\u5931\u8d25\uff01")})});getWechatReplyMessageFn(0);$(document).unbind("click",".deleteWechatMessageList").on("click",".deleteWechatMessageList",function(){var n=$(this).data("rule_id");$.post("/weixin/DeleteReplyRule?sv_replyid="+n,function(n){n?(layer.msg("\u5220\u9664\u6210\u529f"),setTimeout(function(){location.reload()},1e3)):layer.msg("\u5220\u9664\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5")})});