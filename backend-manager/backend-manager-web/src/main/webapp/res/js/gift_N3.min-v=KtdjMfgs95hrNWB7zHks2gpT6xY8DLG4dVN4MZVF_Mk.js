$(document).ready(function(){integralGift.getGiftPage("");integralGift.addGift();integralGift.deleteGift()});var integralGift={getGiftPage:function(n,t){$.get("/Gift/Total/",function(i){var r=Math.ceil(i/24);laypage({cont:$("#pageGro"),pages:r,skin:"molv",curr:t||1,skip:!0,first:"\u9996\u9875",last:"\u5c3e\u9875",prev:"\u4e0a\u4e00\u9875",next:"\u4e0b\u4e00\u9875",jump:function(i){t=i.curr;integralGift.getGiftList(i.curr,n,24)}})})},getGiftList:function(n,t,i){var r="";$.getJSON("/Gift/PageList/",{pageIndex:n,seach:t,pageSize:i},function(n){if(n&&n.length>0){for(var t=0;t<n.length;t++)r+='<li class="productlistbox" data-sv_gift_id="'+n[t].sv_gift_id+'">',r+='<div class="productimagebox fl">',r+=n[t].sv_giftpicture?'<img src="'+_g_res_images_url+n[t].sv_giftpicture+'" alt="" />':'<img src="/skin_N3/images/002.jpg" alt="" />',r+="<\/div>",r+='<div class="productcontent">',r+="<p>"+n[t].sv_giftname+"<\/p>",r+="<p>"+n[t].sv_giftnumber+"<\/p>",r+='<p class="colorff">\u79ef\u5206\uff1a'+n[t].sv_giftintegral+"<\/p>",r+='<div class="gifstock">',r+='<p class="stockproduct"><i class="remaining">\u5269<\/i><span>'+n[t].sv_giftalready+"<\/span><\/p>",r+='<p class="stockproduct"><i class="remaining stockproductnumber">\u603b<\/i><span>'+n[t].sv_giftquantity+"<\/span><\/p>",r+='<\/div><\/div><i class="selectgift icon-ok"><\/i>',r+="<\/li>";$("#giftList_ul").html(r)}else $("#giftList_ul").html('<li style="width: 100%;text-align:center;line-height:100px;color: #31c17b;"><img src="../skin_N3/images/sad.png" /><i class="padd0">\u6682\u65e0\u793c\u54c1\u6570\u636e<\/i><\/li>')})},addGift:function(){function n(){$("#sv_giftnumber").focus();$.getAsyncJson("/Product/GetUserDiscount",null,function(n){var t,i;if(n&&n.unit&&n.unit.length>0){t="";for(i in n.unit)t+='<option value="'+n.unit[i]+'">'+n.unit[i]+"<\/option>";$("#sv_gift_unit").html(t)}})}function t(n){var e=$("#sv_gift_id").val(),i=$("#sv_giftnumber").val().trim(),r=$("#sv_giftname").val().trim(),u=$("#sv_giftintegral").val().trim(),t=$("#sv_giftalready").val().trim(),o=$("#sv_gift_unit").val(),s=$("#sv_giftpicture").val(),f;isNullOrWhiteSpace(i)?isNullOrWhiteSpace(r)?isNullOrWhiteSpace(t)?t>=0&&u>=1?(f={sv_gift_id:e,sv_giftnumber:i,sv_giftname:r,sv_giftintegral:u,sv_giftalready:t,sv_giftpicture:s,sv_gift_unit:o},disableButtonById("saveGift"),disableButtonById("saveGiftAndAddNew"),$.postJson("/Gift/Save",f,function(t){t==!1?(enabledButtonById("saveGift"),enabledButtonById("saveGiftAndAddNew"),layer.msg("\u4fdd\u5b58\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\uff01"),layer.close(index)):t==!0?(enabledButtonById("saveGift"),enabledButtonById("saveGiftAndAddNew"),n==0?layer.closeAll():($("#emityInput").find("input").val(""),$(".addmemberphoto2").show(0),$("#sv_giftpictureImg").attr("src","").hide(0)),integralGift.getGiftPage(""),layer.msg("\u4fdd\u5b58\u6210\u529f\uff01")):t==-5?(enabledButtonById("saveGift"),enabledButtonById("saveGiftAndAddNew"),layer.msg("\u8be5\u793c\u54c1\u7f16\u7801\u5df2\u5b58\u5728\uff01")):t==-2&&(enabledButtonById("saveGift"),enabledButtonById("saveGiftAndAddNew"),layer.closeAll(),layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01"))})):($("#sv_giftintegral").focus(),layer.msg("\u793c\u54c1\u6570\u91cf\u4e0d\u80fd\u4e3a\u5c0f\u4e8e0,\u6240\u9700\u79ef\u5206\u4e0d\u80fd\u5c11\u4e8e1")):($("#sv_giftalready").focus(),layer.msg("\u793c\u54c1\u6570\u91cf\u4e0d\u80fd\u4e3a\u7a7a\uff01")):($("#sv_giftname").focus(),layer.msg("\u793c\u54c1\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01")):($("#sv_giftnumber").focus(),layer.msg("\u793c\u54c1\u7f16\u53f7\u4e0d\u80fd\u4e3a\u7a7a\uff01"))}function i(){var t=$("#giftList_ul>li.active").data("sv_gift_id");$("#saveGiftAndAddNew").hide(0);$.getJSON("/Gift/Edit/",{giftId:t},function(n){for(var t in n)$("#"+t).val(n[t]),t=="sv_giftpicture"&&n[t]&&($(".addmemberphoto2").hide(0),$("#sv_giftpictureImg").attr("src",_g_res_images_url+n[t]).show())});n()}$("#addgift").click(function(){layerpage.Deke_layerpage.show_Url2("1","\u65b0\u589e\u793c\u54c1","/ajaxHtml_N3/integral/addgift.html?="+getTimeStamp(),["565px","400px"],n)});$(document).on("change","#uploadLocalFile",function(){$.commonUploadImg("uploadLocalFile","Gift","true",function(n){n&&($("#sv_giftpicture").val(n),$(".addmemberphoto2").hide(0),$("#sv_giftpictureImg").attr("src",_g_res_images_url+n).show(0))})});$(document).unbind("click","#saveGift").on("click","#saveGift",function(){t(0)});$(document).unbind("click","#saveGiftAndAddNew").on("click","#saveGiftAndAddNew",function(){t(1)});$(document).unbind("click","#giftList_ul>li").on("click","#giftList_ul>li",function(){$(this).toggleClass("active").siblings("li").removeClass("active")});$(document).unbind("click","#updateGift").on("click","#updateGift",function(){var n=$("#giftList_ul>li.active").data("sv_gift_id");n!=""&&n!=null&&n!=undefined?layerpage.Deke_layerpage.show_Url2("1","\u65b0\u589e\u793c\u54c1","/ajaxHtml_N3/integral/addgift.html?="+getTimeStamp(),["565px","400px"],i):layer.msg("\u8bf7\u9009\u62e9\u8981\u4fee\u6539\u7684\u793c\u54c1\uff01")});$("#querygift").keypress(function(n){n.keyCode==13&&($(this).val()?integralGift.getGiftPage($(this).val().trim()):layer.msg("\u8bf7\u8f93\u5165\u5728\u67e5\u8be2"))});$("#querygiftbtn").click(function(){$("#querygift").val().trim()?integralGift.getGiftPage($("#querygift").val().trim()):($("#querygift").focus(),layer.msg("\u8bf7\u8f93\u5165\u67e5\u8be2\u7684\u793c\u54c1\u540d\u79f0\uff01"))})},deleteGift:function(){$("#deleteGift").click(function(){var n=$("#giftList_ul>li.active").data("sv_gift_id");n!=""&&n!=null&&n!=undefined?layer.confirm("\u786e\u8ba4\u8981\u5220\u9664\u9009\u4e2d\u7684\u4fe1\u606f\u5417\uff1f",{btn:["\u786e\u8ba4","\u53d6\u6d88\u5220\u9664"]},function(){$.post("/Gift/Delete",{giftId:n},function(n){n==!0?(layer.msg("\u5220\u9664\u6210\u529f"),integralGift.getGiftPage("")):n==-2?(layer.closeAll(),layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01")):(layer.closeAll(),layer.msg("\u5220\u9664\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\uff01"))})}):layer.msg("\u8bf7\u9009\u62e9\u8981\u5220\u9664\u7684\u793c\u54c1")})}};