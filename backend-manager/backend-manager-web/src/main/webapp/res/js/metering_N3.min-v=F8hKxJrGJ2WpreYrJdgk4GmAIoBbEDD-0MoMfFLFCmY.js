function salesGetShopNameFn(){$.get("/BranchStore/GetStorelist/?type=0",function(n){var t,i;if(n==-2)layer.msg("\u60a8\u6ca1\u6709\u8be5\u6743\u9650\uff01");else if(n==-1)$("#getshopname").hide();else{$("#getshopname").show();t="";for(i in n)t+=n[i];$("#getshopname").html(t)}})}function salesGetOperatorFn(){var n='<option value="">\u64cd\u4f5c\u5458<\/option>';$.getJSON("/Salesclerk/PageList/",{page:1,pagesize:100},function(t){if(t!=null&&t.length>0)for(var i=0;i<t.length;i++)n+=isNullOrWhiteSpace(t[i].sv_employee_name)?'<option value="'+t[i].sp_salesclerkid+'">'+t[i].sv_employee_name+"<\/option>":'<option value=""><\/option>';$("#getoperator").html(n)})}function shareQueryMeteringInfoFn(){var n=$("#queryday>li.active").data("queryday"),t=$("#salesmemberInfo").val(),i=$("#serialNumberinfo").val();beginDate=$("#begindateval").val();endDate=$("#enddateval").val();storeSearch=$("#getshopname").val();order_operator=$("#getoperator").val();getMeteringCountFn(n,t,i,beginDate,endDate,storeSearch,order_operator)}function meteringReturnFn(n){$("#returnmeteringnumber").val(n.salesnumber);$("#agreemeteringreturn").click(function(){var t=$("#returnmeteringnumber").val(),i;if(t&&t>1){layer.msg("\u64a4\u9500\u6263\u6b21\u5fc5\u987b\u8f93\u5165\u6570\u91cf");return}i={order_id:n.order_id,return_cause:$("#returnreson").val(),return_remark:$("#return_remark").val(),return_num:$("#returnmeteringnumber").val(),return_pordcot:n.product_id,return_type:1,order_product_id:parseInt(n.order_product_id)};$.post("/intelligent/returensales",i,function(n){n==-2?layer.msg("\u5bf9\u4e0d\u8d77\uff0c\u60a8\u9000\u8d27\u7684\u6570\u91cf\u8d85\u8fc7\u8d2d\u4e70\u7684\u6570\u91cf\uff0c\u8bf7\u6838\u5bf9\uff01"):n==0?layer.msg("\u5bf9\u4e0d\u8d77\uff0c\u64cd\u4f5c\u9000\u8d27\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5"):n==-3?layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01"):(layer.closeAll(),layer.msg("\u64cd\u4f5c\u6210\u529f"),shareQueryMeteringInfoFn())})})}function getMeteringCountFn(n,t,i,r,u,f,e){$.get("/intelligent/Getmeteringcount/",{day:n,key:t,liushui:i,date:r,date2:u,storeid:f,order_operator:e},function(o){$("#rowmeteringcount").text(o.count-o.count2);$("#defrowmeteringcount").text(o.count2);var s=Math.ceil(o.count/pagesize);laypage({cont:$("#layerpage"),pages:s,skin:"molv",skip:!0,first:"\u9996\u9875",last:"\u5c3e\u9875",prev:"\u4e0a\u4e00\u9875",next:"\u4e0b\u4e00\u9875",jump:function(o){pageinxe=o.curr;getMeteringFn(o.curr,n,t,i,r,u,f,e,pagesize);s>1?(addPageSizeFn("#selectpagesize"),$("#pagesize").find("option[value='"+pagesize+"']").attr("selected",!0)):$("#selectpagesize").html("")}})})}function getMeteringFn(n,t,i,r,u,f,e,o){var s="",h="";$.get("/intelligent/Getmetering/"+n,{day:t,key:i,liushui:r,date:u,date2:f,storeid:e,order_operator:o,top:pagesize},function(n){var t,i;if(n&&n.length>0){for(t=0;t<n.length;t++)h=n[t].order_stutia==2?"isonereturnclass":"",s+="<tr>",s+='<td><span class="productnamespan">'+n[t].product_name+"<\/span><\/td>",s+="<td><span>"+n[t].sv_mr_name+"<\/span><\/td>",s+="<td><span>"+n[t].product_num+"<\/span><\/td>",s+=n[t].product_num==0?"<td><span>"+n[t].product_num+"\u6b21<\/span><\/td>":"<td><span>-"+n[t].product_num+"\u6b21<\/span><\/td>",s+="<td><span>"+n[t].consumeusername+"<\/span><\/td>",s+="<td><span>"+n[t].memberuserName+"<\/span><\/td> ",s+="<td><span>"+new Date(n[t].order_datetime).Format("MM-dd hh:mm:ss")+"<\/span><\/td>",s+='<td class="shareexecl">',s+='<a href="javascript:void(0);" class="meteringReturn '+h+'" data-prid="'+n[t].product_id+'"  data-id="'+n[t].order_id+'" data-salesnumber="'+n[t].product_num+'" data-orderprId="'+n[t].id+'">\u64a4\u9500\u6263\u6b21 <\/a>',s+='<a href="javascript:void(0);" class="meteringprint '+h+'" data-id="'+n[t].order_id+'">\u6253\u5370 <\/a>',s+="<\/td>",s+="<\/tr>";$("#meteringlisthtml").html(s)}else i=$("#rowlength").children("th").length,$("#meteringlisthtml").html('<tr><td class="text-center sad" style="" colspan="'+i+'"><img src="../skin_N3/images/sad.png" /><i class="padd0">\u6682\u65e0\u6570\u636e<\/i><\/td><\/tr>')})}var pagesize=5,pageIndex=1;$(document).ready(function(){salesGetShopNameFn();salesGetOperatorFn();getMeteringCountFn(1,"","","","","","")});$(document).unbind("click","#queryday>li").on("click","#queryday>li",function(){var n=$(this).data("queryday");$(this).addClass("active").siblings("li").removeClass("active");n!=3?($(".querydate").css("display","none"),shareQueryMeteringInfoFn()):$(".querydate").css("display","block");$("#otherday").unbind("click").click(function(){shareQueryMeteringInfoFn()})});$("#begindate").datetimepicker({language:"zh",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,forceParse:0,endDate:new Date,pickerPosition:"bottom-left"}).on("change",function(){var n=$("#begindateval").val();$("#enddate").datetimepicker("setStartDate",n);$("#begindate").datetimepicker("hide")});$("#enddate").datetimepicker({language:"zh",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,forceParse:0,startDate:$("#begindateval").val(),endDate:new Date,pickerPosition:"bottom-left"}).on("change",function(){var n=$("#enddateval").val();$("#begindate").datetimepicker("setReturnDate",n);$("#enddate").datetimepicker("hide")});$("#getshopname,#getoperator").change(function(){shareQueryMeteringInfoFn()});$(document).on("change","#pagesize",function(){pagesize=$(this).val();shareQueryMeteringInfoFn()});$(document).on("click","#btnOrderQuery",function(){shareQueryMeteringInfoFn()});$("#meteringlisthtml").delegate(".meteringReturn","click",function(){var t=$(this).hasClass("isonereturnclass"),n;t||(n={order_product_id:$(this).attr("data-orderprId"),salesnumber:$(this).data("salesnumber"),product_id:$(this).data("prid"),order_id:$(this).data("id")},layerpage.Deke_layerpage.getpage2("1","\u64a4\u9500\u6263\u6b21","/ajaxHtml_N3/sales/meteringReturn.html?="+getTimeStamp(),["440px","330px"],meteringReturnFn,n))});$("#salesmemberInfo").keydown(function(n){if(n.keyCode==113){var t=typeof Cef;t!=undefined&&GetICCardEventData($("#salesmemberInfo"),n)}});$("#exportsalesreport").click(function(){layer.load();$.getJSON("/intelligent/Getmetering/",{day:$("#queryday>li.active").data("queryday"),key:$("#salesmemberInfo").val(),liushui:$("#serialNumberinfo").val(),date:$("#begindateval").val(),date2:$("#enddateval").val(),storeid:$("#getshopname").val(),order_operator:$("#getoperator").val(),isexport:1},function(n){layer.closeAll();n==-2?layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01"):n!=0?(location.href=n,Cef.Download(n)):layer.msg("\u6570\u636e\u5bfc\u51fa\u5931\u8d25!")})});