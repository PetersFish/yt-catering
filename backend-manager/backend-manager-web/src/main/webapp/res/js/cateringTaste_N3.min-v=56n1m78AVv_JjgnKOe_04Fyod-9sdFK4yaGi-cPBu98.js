var pageSize=100,listNameArrays=[],listIdsArrays=[],productListCache={succeed:!0,values:[]},productCategoryListCache={succeed:!0,values:[]},productCategorySelectListCache={succeed:!0,values:[]},cateringTaste;$(document).ready(function(){cateringTaste.getCateringTastePageList("");cateringTaste.operatingCateringTasts()});cateringTaste={pageLoadCateringTaste:function(){$.get("/CateringTaste/GetCateringTasteTotal/",{seachStr:seachStr},function(n){var t=Math.ceil(n.values/pageSize);laypage({cont:$(".pageCateringTasteList"),pages:t,skin:"molv",first:"\u9996\u9875",last:"\u5c3e\u9875",prev:"\u4e0a\u4e00\u9875",next:"\u4e0b\u4e00\u9875",jump:function(n){getCateringTastePageList(n.curr,pageSize,seachStr)}})})},getCateringTastePageList:function(n){var t="";$.getJSON("/CateringTaste/GetCateringTastePageList",{pageIndex:1,pageSize:100,seachStr:n},function(n){var r,i,f;if(n.succeed&&n.values!=null&&n.values.length>0){for(r=n.values,i=0;i<r.length;i++){var e=r[i].sv_taste_for_all==!0?"\u662f":"\u5426",o=r[i].sv_remark!=null?r[i].sv_remark:"",u="";r[i].sv_taste_type!=0||r[i].sv_taste_for_all?r[i].sv_taste_type!=1||r[i].sv_taste_for_all?r[i].sv_taste_type!=2||r[i].sv_taste_for_all||(u="\u83dc\u54c1"):u="\u83dc\u7c7b":u="\u83dc\u8c31";t+='<tr><td><input data-id="'+r[i].sv_taste_id+'" class="checkinput checkradio" type="radio" name="checkTaste" id="" value="" /><\/td>';t+="<td>"+r[i].sv_taste_name+"<\/td>";t+='<td><i class="colorff">\u00a5 '+parseFloat(r[i].sv_taste_price).toFixed(2)+"<\/i><\/td>";t+='<td class="minhide">'+r[i].sv_taste_sort+"<\/td>";t+="<td>"+e+"<\/td>";t+="<td>"+u+"<\/td>";t+='<td class="minhide">'+new Date(r[i].sv_creation_date).Format("yyyy-MM-dd")+"<\/td>";t+=r[i].sv_enabled==!0?'<td class="colorff">\u5df2\u542f\u7528<\/td>':'<td class="amountcolor2">\u672a\u542f\u7528<\/td>';t+='<td class="minhide">'+o+"<\/td>";t+='<td class="changeproduct" style="width: 120px;"><a href="javascript:void(0);" data-id ="'+r[i].sv_taste_id+'" data-type="'+r[i].sv_taste_type+'" class="tasteinfo">\u8be6\u60c5<\/a><\/td><\/tr>'}$("#CateringTasteTableListHtml").html(t)}else f=$("#rowlength").children("th").length,$("#CateringTasteTableListHtml").html('<tr><td class="text-center sad" style="text-align:center !important" colspan="'+f+'"><img src="../skin_N3/images/sad.png" /><i class="padd0">\u6682\u65e0\u6570\u636e<\/i><\/td><\/tr>')})},operatingCateringTasts:function(){function f(){listNameArrays=[];listIdsArrays=[]}function e(n,t){var r=!1,u=!0,i;if(listIdsArrays.length>0)if(listIdsArrays.length<90){for(i=0;i<listIdsArrays.length;i++)listIdsArrays[i]==n&&(r=!0);r||(listIdsArrays.push(n),listNameArrays.push(t))}else u=!1,layer.msg("\u6700\u591a\u53ea\u80fd\u9009\u62e990\u6761\u6570\u636e\uff01");else listIdsArrays.push(n),listNameArrays.push(t);return u}function n(n,i,r){var u=$("#cateringTasteTypeListNames").attr("data-id"),f=$("#cateringTasteTypeListNames").val(),e;isNullOrWhiteSpace(u)&&(listIdsArrays=u.split(","));isNullOrWhiteSpace(f)&&(listNameArrays=f.split(","));e="/CateringTaste/GetCateringTasteTypeDataList";!isNullOrWhiteSpace(i)&&productCategoryListCache.values.length>0&&n==1&&r<=0?t(productCategoryListCache):!isNullOrWhiteSpace(i)&&productListCache.values.length>0&&n==2&&r<=0?t(productListCache):$.getJSON("/CateringTaste/GetCateringTasteTypeDataList",{type:n,seachStr:i,productCategory:r,top:30},function(u){u.succeed&&u.values!=null&&u.values.length>0&&(!isNullOrWhiteSpace(i)&&n==1&&r<=0?productCategoryListCache.values=u.values:!isNullOrWhiteSpace(i)&&n==2&&r<=0&&(productListCache.values=u.values),t(u))})}function t(n){for(var f,u,r,e="",i=n.values,t=0;t<i.length;t++){for(f="",u=0;u<listIdsArrays.length;u++)listIdsArrays[u]==i[t].id&&(f="active");r=i[t].name;r.length>17&&(r=r.substring(0,17));e+='<li class="'+f+'" data-id="'+i[t].id+'" data-name = "'+i[t].name+'"><i class="square"><\/i><span>'+r+"<\/span><\/li>"}$("#CateringTasteTypeListHtml").html(e)}function r(){productCategorySelectListCache.values.length>0?u(productCategorySelectListCache):$.getJSON("/CateringTaste/GetCateringTasteTypeDataList",{type:1,seachStr:null,productCategory:0,top:100},function(n){n.succeed&&n.values!=null&&n.values.length>0&&(productCategorySelectListCache.values=n.values,u(n))})}function u(n){var r="",i,t;for(r+='<option value="0">\u9009\u62e9\u83dc\u7c7b<\/option>',i=n.values,t=0;t<i.length;t++)r+='<option value="'+i[t].id+'">'+i[t].name+"<\/option>";$("#productCategorySelect").html(r)}function o(t,i){if(t>0){$("#cateringTasteTypeListNames_li").show();$("#showTasteRelationList").show();var u=$("#addnewmemberpage").parent().width();u<720&&($("#addnewmemberpage").parent().width($("#addnewmemberpage").parent().width()+270),$("#shareul").addClass("col-xs-8").removeClass("col-xs-12"));$("#cateringTasteTypeListNames_li label").html("\u6240\u5c5e"+i);$("#cateringTasteTypeListNames_li input").attr("placeholder","\u8bf7\u9009\u62e9\u53f3\u4fa7"+i+"\u5217\u8868\u6570\u636e");t==2?($("#productCategorySelect").show(),r()):t==1&&$("#productCategorySelect").hide();n(t,"",0)}else $("#cateringTasteTypeListNames_li").hide(),$("#productCategorySelect").hide(),$("#cateringTasteTypeListNames_li").hide(),$("#showTasteRelationList").hide(),$("#cateringTasteTypeListNames").val("").attr("data-id","").attr("value","").attr("title",""),$("#addnewmemberpage").parent().width($("#addnewmemberpage").parent().width()-270),$("#shareul").addClass("col-xs-12").removeClass("col-xs-8")}function s(){listNameArrays=[];listIdsArrays=[];var i=$("#sv_taste_for_all").is(":checked"),t=$("#sv_taste_type").val();i||($("#addnewmemberpage").parent().width($("#addnewmemberpage").parent().width()+270),$("#shareul").addClass("col-xs-8").removeClass("col-xs-12"));t==1?n(1,""):t==2&&($("#productCategorySelect").show(),r(),n(2,""))}function h(n,t){setTimeout(function(){$.getJSON("/CateringTaste/GetCateringTasteModelInfo",{tasteId:n},function(n){var t,r,u,i;if(n)for(t in n)$("#"+t).html(n[t]),t=="sv_creation_date"&&$("#"+t).html(new Date(n[t]).Format("yyyy-MM-dd hh:mm:ss")),t=="sv_enabled"&&(r=n[t]==!0?"\u5df2\u542f\u7528":"\u505c\u7528",$("#"+t).html(r)),t=="sv_taste_for_all"&&(u=n[t]==!0?"\u662f":"\u5426",$("#"+t).html(u)),t=="sv_taste_type"&&($("#hidden_sv_taste_type").val(n[t]),i="",i=n[t]==0?"\u83dc\u8c31":n[t]==1?"\u83dc\u7c7b":n[t]==2?"\u83dc\u54c1":"",$("#"+t).html(i)),t=="sv_taste_id"&&$("#hidden_sv_taste_id").val(n[t]),t=="sv_taste_price"&&$("#sv_taste_price").html("\u00a5"+parseFloat(n[t]).toFixed(2))});t>0&&i(t,n,"")},200)}function i(n,t,i){var r=10;$.get("/CateringTaste/GetTasteRelationTotalByType/",{type:n,tasteId:t,seachStr:i},function(u){if(u.succeed){var f=Math.ceil(u.values/r);laypage({cont:$("#pageCateringTasteRelationList"),pages:f,skin:"molv",skip:!0,first:"\u9996\u9875",last:"\u5c3e\u9875",prev:"\u4e0a\u4e00\u9875",next:"\u4e0b\u4e00\u9875",jump:function(u){c(u.curr,r,i,n,t)}})}})}function c(n,t,i,r,u){var f="",e=commonOpenLoading();$.getJSON("/CateringTaste/GetTasteRelationListByType",{type:r,tasteId:u,pageIndex:n,pageSize:t,seachStr:i},function(n){var i,t,r,u;if(commonCloseLoading(e),n.succeed&&n.values!=null&&n.values.length>0){for(i=n.values,t=0;t<i.length;t++)r="",r=i[t].sv_taste_relation_type==0?"\u83dc\u8c31":i[t].sv_taste_relation_type==1?"\u83dc\u7c7b":i[t].sv_taste_relation_type==2?"\u83dc\u54c1":"",f+="<tr>",f+="<td>"+i[t].sv_relation_name+"<\/td>",f+="<td>"+r+"<\/td>",f+="<td>"+new Date(i[t].sv_creation_date).Format("yyyy-MM-dd hh:mm:ss")+"<\/td>",f+="<\/tr>";$("#CateringTasteRelationListHtml").html(f)}else commondResultMsg(n.errmsg,1,600),u=$("#rowlength2").children("th").length,$("#CateringTasteRelationListHtml").html('<tr><td class="text-center sad" style="text-align:center !important" colspan="'+u+'"><img src="../skin_N3/images/sad.png" /><i class="padd0">\u6682\u65e0\u6570\u636e<\/i><\/td><\/tr>')})}$("#txtSeachCateringTaste").keypress(function(n){if(n.keyCode==13){var t=$(this).val().replace(/\ +/g,"");isNullOrWhiteSpace(t)?cateringTaste.getCateringTastePageList(t):($("#txtSeachCateringTaste").focus(),layer.msg("\u8bf7\u8f93\u5165\u8981\u67e5\u8be2\u7684\u6570\u636e\uff01"))}});$("#BtntxtSeachCateringTaste").click(function(){var n=$("#txtSeachCateringTaste").val().replace(/\ +/g,"");isNullOrWhiteSpace(n)?cateringTaste.getCateringTastePageList(n):($("#txtSeachCateringTaste").focus(),layer.msg("\u8bf7\u8f93\u5165\u8981\u67e5\u8be2\u7684\u6570\u636e\uff01"))});$("#btnAddCateringTaste").click(function(){layerpage.Deke_layerpage.getpage3("\u65b0\u589e\u53e3\u5473","/CateringTaste/_PartialOperateCateringTaste?tasteId=0",f,["450px","520px"],"addnewmemberpage")});$(document).unbind("click","#selectCheckAll").on("click","#selectCheckAll",function(){$("#cateringTasteTypeListNames").val("").attr("data-id","").attr("value","").attr("title","");var t=$("#CateringTasteTypeListHtml li"),n=!0;$.each(t,function(){n=e($(this).attr("data-id"),$(this).attr("data-name"))});$("#cateringTasteTypeListNames").val(listNameArrays).attr("data-id",listIdsArrays);n&&$("#CateringTasteTypeListHtml li").addClass("active")});$(document).unbind("click","#selectUnCheckAll").on("click","#selectUnCheckAll",function(){listNameArrays=[];listIdsArrays=[];$("#CateringTasteTypeListHtml li").removeClass("active");$("#cateringTasteTypeListNames").val("").attr("data-id","").attr("value","").attr("title","")});$(document).unbind("click","#CateringTasteTypeListHtml li").on("click","#CateringTasteTypeListHtml li",function(){var n=$(this).hasClass("active"),r=$(this).attr("data-name"),u=$("#cateringTasteTypeListNames").attr("data-id"),f=$("#cateringTasteTypeListNames").val(),t=$(this).attr("data-id"),i;n?($.each(listIdsArrays,function(n,i){i==t&&listIdsArrays.splice(n,1)}),$("#cateringTasteTypeListNames").attr("data-id",listIdsArrays),$(this).removeClass("active")):($(this).addClass("active"),listIdsArrays.push(t),$("#cateringTasteTypeListNames").attr("data-id",listIdsArrays));n?(i=$.trim($(this).attr("data-name")),$.each(listNameArrays,function(n,t){t==i&&listNameArrays.splice(n,1)}),$("#cateringTasteTypeListNames").val(listNameArrays).attr("title",listNameArrays),$(this).removeClass("active")):($(this).addClass("active"),listNameArrays.push(r),$("#cateringTasteTypeListNames").val(listNameArrays).attr("title",listNameArrays))});$(document).unbind("click","#sv_taste_for_all").on("click","#sv_taste_for_all",function(){var t=$(this).is(":checked"),n;listNameArrays=[];listIdsArrays=[];$("#CateringTasteTypeListHtml li").removeClass("active");$("#cateringTasteTypeListNames").val("").attr("data-id","").attr("value","").attr("title","");$("#sv_taste_type").val(-1);t?($("#sv_taste_type_li").hide(),$("#cateringTasteTypeListNames_li").hide(),$("#productCategorySelect").hide(),$("#cateringTasteTypeListNames_li").hide(),$("#showTasteRelationList").hide(),$("#cateringTasteTypeListNames").val("").attr("data-id","").attr("value","").attr("title",""),n=$("#addnewmemberpage").parent().width(),n>=720&&($("#addnewmemberpage").parent().width($("#addnewmemberpage").parent().width()-270),$("#shareul").addClass("col-xs-12").removeClass("col-xs-8"))):$("#sv_taste_type_li").show()});$(document).unbind("click","#btnSaveCateringTasteInfo").on("click","#btnSaveCateringTasteInfo",function(){var i=$("#sv_taste_name").val().replace(/\ +/g,""),r=$("#sv_taste_price").val().replace(/\ +/g,""),u=$("#sv_taste_sort").val().replace(/\ +/g,""),e=$("#sv_taste_for_all").is(":checked"),n=$("#sv_taste_type").val(),l=$("#sv_enabled").is(":checked"),f=$("#sv_remark").val(),a=$("#CateringTasteType").val(),o=[],t,s,h,c;if(isNullOrWhiteSpace(i))if(i.length>15)layer.msg("\u53e3\u5473\u540d\u79f0\u4e0d\u80fd\u5927\u4e8e15\u4e2a\u5b57\u7b26\u4e32"),$("#sv_taste_name").focus();else if(isNullOrWhiteSpace(u)&&parseInt(u)<0)layer.msg("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u6392\u5e8f\u6570\u5b57"),$("#sv_taste_sort").focus();else if(isNullOrWhiteSpace(r)&&parseFloat(r)<0)layer.msg("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u91d1\u989d"),$("#sv_taste_price").focus();else if(isNullOrWhiteSpace(f)&&f.length>20)layer.msg("\u5907\u6ce8\u4fe1\u606f\u8bf7\u8f93\u516520\u5b57\u4ee5\u5185"),$("#sv_remark").focus();else{if(e)n=0;else if(n>0)if(listIdsArrays!=null&&listIdsArrays!=undefined&&listIdsArrays!=""&&listIdsArrays.length>0)if(listIdsArrays.length<=90)for(t=0;t<listIdsArrays.length;t++)s={sv_taste_type_id:listIdsArrays[t],sv_taste_relation_type:n},o.push(s);else{layer.msg("\u53e3\u5473\u6240\u5c5e\u5217\u8868\u6570\u636e\u6700\u591a\u53ea\u80fd\u9009\u62e990\u6761\uff01");return}else{layer.msg("\u8bf7\u9009\u62e9\u53e3\u5473\u6240\u5c5e\u5217\u8868\u6570\u636e\uff01");return}else{layer.msg("\u8bf7\u9009\u62e9\u53e3\u5473\u6240\u5c5e\u79cd\u7c7b\uff01");return}h={sv_taste_id:$("#sv_taste_id").val(),sv_taste_name:i,sv_taste_price:r,sv_taste_sort:u,sv_taste_for_all:e,sv_taste_type:n,sv_enabled:l,sv_remark:f,tasteRelationList:o};c=commonOpenLoading();$.postAsyncJson("/CateringTaste/OperateCateringTaste",h,function(n){commonCloseLoading(c);n.succeed?(layer.closeAll(),layer.msg("\u4fdd\u5b58\u6570\u636e\u6210\u529f"),cateringTaste.getCateringTastePageList("")):layer.msg(n.errmsg)})}else layer.msg("\u53e3\u5473\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a"),$("#sv_taste_name").focus()});$(document).unbind("change","#sv_taste_type").on("change","#sv_taste_type",function(){listNameArrays=[];listIdsArrays=[];var n=$(this).val(),t=$(this).find("option:selected").text();o(n,t)});$(document).unbind("click","#btnSeachProductNameOrCategoryName").on("click","#btnSeachProductNameOrCategoryName",function(){var t=$("#txtSeachProductNameOrCategoryName").val().replace(/\ +/g,""),r=$("#productCategorySelect").val(),i=$("#sv_taste_type").val();isNullOrWhiteSpace(t)?n(i,t,r):(layer.msg("\u8bf7\u8f93\u5165\u8981\u67e5\u8be2\u7684\u6570\u636e\uff01"),$("#txtSeachProductNameOrCategoryName").focus(),n(i,"",0))});$(document).unbind("keypress","#txtSeachProductNameOrCategoryName").on("keypress","#txtSeachProductNameOrCategoryName",function(t){if(t.keyCode==13){var i=$(this).val().replace(/\ +/g,""),u=$("#productCategorySelect").val(),r=$("#sv_taste_type").val();isNullOrWhiteSpace(i)?n(r,i,u):(layer.msg("\u8bf7\u8f93\u5165\u8981\u67e5\u8be2\u7684\u6570\u636e\uff01"),n(r,"",0),$(this).focus())}});$(document).unbind("change","#productCategorySelect").on("change","#productCategorySelect",function(){n(2,"",$(this).val())});$(document).unbind("click","#btnCancel").on("click","#btnCancel",function(){layer.closeAll()});$("#btnUpdateCateringTaste").click(function(){var n=$("#CateringTasteTableListHtml").find(".checkradio:checked").attr("data-id");n>0?layerpage.Deke_layerpage.getpage3("\u4fee\u6539\u53e3\u5473\u4fe1\u606f","/CateringTaste/_PartialOperateCateringTaste?tasteId="+n,s,["450px","520px"],"addnewmemberpage"):layer.msg("\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u53e3\u5473\u8fdb\u884c\u7f16\u8f91\u64cd\u4f5c!")});$("#btnRefreshCateringTaste").click(function(){cateringTaste.getCateringTastePageList("")});$("#btnDeleteCateringTaste").click(function(){var n=$("#CateringTasteTableListHtml").find(".checkradio:checked").attr("data-id");n>0?layer.confirm("\u662f\u5426\u786e\u8ba4\u5220\u9664\u8be5\u6570\u636e\uff1f",{btn:["\u662f","\u5426"]},function(){$.postAsyncJson("/CateringTaste/DeleteCateringTaste",{tasteId:n},function(n){n.succeed?(layer.msg("\u5220\u9664\u6570\u636e\u6210\u529f\uff01"),cateringTaste.getCateringTastePageList("")):layer.msg(n.errmsg)})},function(){}):layer.msg("\u8bf7\u9009\u62e9\u8981\u5220\u9664\u7684\u53e3\u5473\uff01")});$(document).unbind("click","#btnShowCateringTasteInfo, #btnShowTasteRelationList").on("click","#btnShowCateringTasteInfo, #btnShowTasteRelationList",function(){var i=$(this).attr("data-name"),n,t;$("#btnShowCateringTasteInfo, #btnShowTasteRelationList").removeClass("active");$(this).addClass("active");$("#panel_TasteRelationList, #panel_CateringTasteInfo").hide();$("#"+i).show();n=92.5;t=$(this).index()*n+1;$(".border-bottom").animate({left:t+"px"},300)});$(document).unbind("click","#CateringTasteTableListHtml .tasteinfo").on("click","#CateringTasteTableListHtml .tasteinfo",function(){var n=$(this).attr("data-id"),t=$(this).attr("data-type");n>0&&layerpage.Deke_layerpage.show_Url2("1","\u53e3\u5473\u8be6\u60c5\u4fe1\u606f","/CateringTaste/TasteRelationInfo_N3",["750px","520px"],h(n,t))});$(document).unbind("keypress","#textTasteTypeNmae").on("keypress","#textTasteTypeNmae",function(n){if(n.keyCode==13){var t=$(this).val().replace(/\ +/g,""),r=$("#hidden_sv_taste_type").val(),u=$("#hidden_sv_taste_id").val();isNullOrWhiteSpace(t)?r>0&&u>0?i(r,u,t):layer.msg("\u5f53\u524d\u53e3\u5473\u672a\u6dfb\u52a0\u6240\u5c5e\u5206\u7c7b\uff0c\u4e0d\u80fd\u8fdb\u884c\u67e5\u8be2\uff01"):layer.msg("\u8bf7\u8f93\u5165\u8981\u67e5\u8be2\u7684\u6570\u636e\uff01")}});$(document).unbind("click","#BtntextTasteTypeNmae").on("click","#BtntextTasteTypeNmae",function(){var n=$("#textTasteTypeNmae").val().replace(/\ +/g,""),t=$("#hidden_sv_taste_type").val(),r=$("#hidden_sv_taste_id").val();isNullOrWhiteSpace(n)?t>0&&r>0?i(t,r,n):layer.msg("\u5f53\u524d\u53e3\u5473\u672a\u6dfb\u52a0\u6240\u5c5e\u5206\u7c7b\uff0c\u4e0d\u80fd\u8fdb\u884c\u67e5\u8be2\uff01"):layer.msg("\u8bf7\u8f93\u5165\u8981\u67e5\u8be2\u7684\u6570\u636e\uff01")})}};