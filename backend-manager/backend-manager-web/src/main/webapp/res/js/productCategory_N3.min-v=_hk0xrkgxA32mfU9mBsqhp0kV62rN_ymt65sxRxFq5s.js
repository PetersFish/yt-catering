var pageSize=5,samllCategorieslistlength,readyProductBigCategory;$(document).ready(function(){readyProductBigCategory.getProductFirstCategory();readyProductBigCategory.getProductFirstCategoryTable();readyProductBigCategory.operatingProductCategroy()});samllCategorieslistlength=0;readyProductBigCategory={getProductFirstCategory:function(){$.get("/ProductCategory/GetFirstCategory").done(function(n){if(n&&n.length>0){var t='<li class="active"><div class="bigCategorieslist-name paddright allbigCategorieslist"><span class="name">\u6240\u6709\u5206\u7c7b<\/span><\/div><\/li>';$(n).each(function(n,i){t+='<li data-producttype_id="'+i.producttype_id+'" data-productcategory_id = "'+i.productcategory_id+'" data-name="'+i.sv_pc_name+'"><div class="bigCategorieslist-name">';t+='<i class="icon-stop stop-type"><\/i>';t+="<span>"+i.sv_pc_name+"<\/span>";t+="<\/div>";t+='<div class="editbigCategorieslist">';t+='<a data-productcategory_id = "'+i.productcategory_id+'" href="javascript:void(0);" class="editFirstCategroy">';t+='<i class="icon-edit"><\/i>';t+="<\/a>";t+='<a data-productcategory_id = "'+i.productcategory_id+'" href="javascript:void(0);" data-categroyType="1" class="deletecategories">';t+='<i class="icon-remove"><\/i>';t+="<\/a><\/div><\/li>"});$("#bigCategorieslist").html(t)}else $("#bigCategorieslist").html('<li><div class="bigCategorieslist-name text-center">\u6682\u65e0\u6570\u636e<\/div><\/li>')}).done(function(){function n(n){$.get("/AjaxProduct/GetCategoryById?cid="+n+"&pange=1&count=1000").done(function(n){if(n&&n.length>0){var t="";samllCategorieslistlength=n.length;$(n).each(function(n,i){t+='<li data-productcategory_id = "'+i.productsubcategory_id+'" data-name="'+i.sv_psc_name+'"><div class="bigCategorieslist-name">';t+='<i class="icon-stop stop-type"><\/i>';t+="<span>"+i.sv_psc_name+"<\/span>";t+="<\/div>";t+='<div class="editbigCategorieslist">';t+='<a data-productcategory_id = "'+i.productsubcategory_id+'" href="javascript:void(0);" class="editSecondCategroy">';t+='<i class="icon-edit"><\/i>';t+="<\/a>";t+='<a data-productcategory_id = "'+i.productsubcategory_id+'" href="javascript:void(0);" data-categroyType="2" class="deletecategories">';t+='<i class="icon-remove"><\/i>';t+="<\/a><\/div><\/li>"});$("#samllCategorieslist").html(t)}else samllCategorieslistlength=0,$("#samllCategorieslist").html('<li><div class="bigCategorieslist-name text-center">\u6682\u65e0\u6570\u636e<\/div><\/li>')}).done(function(){$(".productCategories #samllCategorieslist>li").hover(function(){$(this).addClass("showbg");$(this).children(".editbigCategorieslist").addClass("show");$(this).children(".bigCategorieslist-name").addClass("paddright")},function(){$(this).removeClass("showbg");$(this).hasClass("active")||($(this).children(".editbigCategorieslist").removeClass("show"),$(this).children(".bigCategorieslist-name").removeClass("paddright"))})})}$(".productCategories .bigCategorieslist-ul li").hover(function(){$(this).addClass("showbg");$(this).children(".editbigCategorieslist").addClass("show");$(this).children(".bigCategorieslist-name").addClass("paddright")},function(){$(this).removeClass("showbg");$(this).hasClass("active")||($(this).children(".editbigCategorieslist").removeClass("show"),$(this).children(".bigCategorieslist-name").removeClass("paddright"))});$(document).on("click","#bigCategorieslist>li",function(){$(this).addClass("active").siblings("li").removeClass("active");$(this).children(".editbigCategorieslist").addClass("show").parent("li").siblings().children(".editbigCategorieslist").removeClass("show");$(this).children(".bigCategorieslist-name").addClass("paddright").parent("li").siblings().children(".bigCategorieslist-name").removeClass("paddright");var t=$(this).index(),i=$(this).data("productcategory_id");t==0?($(".allbigCategories").fadeIn(0),$(".smallCategories").fadeOut(0)):($(".allbigCategories").fadeOut(0),n(i),$(".smallCategories").fadeIn(0))});$(document).on("click","#samllCategorieslist>li",function(){$(this).addClass("active").siblings("li").removeClass("active");$(this).children(".editbigCategorieslist").addClass("show").parent("li").siblings().children(".editbigCategorieslist").removeClass("show");$(this).children(".bigCategorieslist-name").addClass("paddright").parent("li").siblings().children(".bigCategorieslist-name").removeClass("paddright")})})},getProductFirstCategoryTable:function(){$.get("/AjaxProduct/GetCategoryInit?page=1&count=1000").done(function(n){var t,i,r;n&&n.length>0?(t="",i="",$(n).each(function(r,u){i=u.sv_sort!=null&&u.sv_sort>0?u.sv_sort:parseInt(r)+1;t+='<tr id="sort_'+parseInt(r+1)+'" data-productcategory_id="'+u.productcategory_id+'" data-sv_sort="'+u.sv_sort+'">';t+='<td class="up-down"><span class="number">'+parseInt(r+1)+"<\/span>";r==0?t+='<img src="/skin_N3/images/down.png" data-productcategory_id="'+u.productcategory_id+'" data-sv_sort="'+i+'" class="up downarrow" alt="\u5411\u4e0b"><\/td>':parseInt(r)+1==n.length?t+='<img src="/skin_N3/images/up.png" data-productcategory_id="'+u.productcategory_id+'" data-sv_sort="'+i+'" class="up uparrow" alt="\u5411\u4e0a">':(t+='<img src="/skin_N3/images/up.png" data-productcategory_id="'+u.productcategory_id+'" data-sv_sort="'+i+'" class="up uparrow" alt="\u5411\u4e0a">',t+='<img src="/skin_N3/images/down.png" data-productcategory_id="'+u.productcategory_id+'" data-sv_sort="'+i+'" class="up downarrow" alt="\u5411\u4e0b"><\/td>');t+="<td>"+u.sv_pc_name+"<\/td>";t+="<td>"+u.sv_pt_name+"<\/td>";t+='<td class="switch-padding">';t+='<div class="testswitch">';t+=u.sv_enabled?'<input class="testswitch-checkbox" id="editId_'+u.productcategory_id+'" checked="checked" type="checkbox">  ':'<input class="testswitch-checkbox" id="editId_'+u.productcategory_id+'" type="checkbox">  ';t+=' <label class="testswitch-label productCategoryShowSwitch" data-productcategory_id="'+u.productcategory_id+'" for="editId_'+u.productcategory_id+'">';t+='<span class="testswitch-inner" data-on="\u5f00" data-off="\u5173"><\/span>';t+='<span class="testswitch-switch"><\/span>';t+="<\/label><\/div><\/td>";t+="<\/tr>"}),$("#allbigCategorieslist").html(t)):(r=$("#rowlength").children("th").length,$("#allbigCategorieslist").html('<tr><td class="text-center sad" style="text-align:center !important" colspan="'+r+'"><img src="../skin_N3/images/sad.png" /><i class="padd0">\u6682\u65e0\u6570\u636e<\/i><\/td><\/tr>'))})},operatingProductCategroy:function(){function i(){var t=n(),r,i;if(t!=null&&!(t.length<=0))for(r in t)i=parseInt(r)+1,$("#sort_"+i).attr("data-sv_sort",i)}function n(){return $("#allbigCategorieslist tr").map(function(){return{productcategory_id:$(this).attr("data-productcategory_id"),sv_sort:$(this).attr("data-sv_sort")}}).get()}function r(n){n!=null&&n.length>0&&$.ajax({url:"/AjaxProduct/SaveCategorySort",type:"post",dataType:"json",contentType:"application/json",async:!0,cache:!1,data:JSON.stringify(n)}).done(function(n){n==!0?(readyProductBigCategory.getProductFirstCategory(),readyProductBigCategory.getProductFirstCategoryTable()):n==!1?(layer.msg("\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u540e\u518d\u8bd5\uff01"),readyProductBigCategory.getProductFirstCategory(),readyProductBigCategory.getProductFirstCategoryTable()):n==-2&&layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01")})}function f(){$("#saveProductCategroy").unbind("click").click(function(){var n=$("#productCategroyName").val().replace(/\ +/g,"");n?(disableButtonById("saveProductCategroy"),$.ajax({url:"/AjaxProduct/SaveCategory",type:"post",contentType:"application/json",data:JSON.stringify({productcategory_id:0,sv_pc_name:$("#productCategroyName").val(),producttype_id:$("#selectCategonriesTypes>li.active").data("type")})}).done(function(n){enabledButtonById("saveProductCategroy");n==!0&&(layer.closeAll(),readyProductBigCategory.getProductFirstCategory(),readyProductBigCategory.getProductFirstCategoryTable(),$(".smallCategories").hide(0),$(".allbigCategories").show(0),layer.msg("\u4fdd\u5b58\u6210\u529f",{icon:1,time:2e3},function(n){layer.close(n)}))})):($("#productCategroyName").focus(),layer.msg("\u8bf7\u8f93\u5165\u5206\u7c7b\u7684\u540d\u79f0\uff01"),enabledButtonById("saveProductCategroy"))})}function e(){$(".editbigcategonriesbox").fadeOut(0);$(".addsmallbigcategonries").fadeIn(0);var n=$("#bigCategorieslist>li.active").data("productcategory_id");n>0&&$.get("/ProductCategory/GetFirstCategory").done(function(t){var i,r;if(t&&t.length>0){i="";for(r in t)i+='<option value="'+t[r].productcategory_id+'">'+t[r].sv_pc_name+"<\/option>";$("#selectFirstCategroy").html(i);$("#selectFirstCategroy").find('option[value="'+n+'"]').prop("selected",!0)}});$("#saveProductCategroy").unbind("click").click(function(){var i=$("#secondCategroyName").val().replace(/\ +/g,"");i?(disableButtonById("saveProductCategroy"),$.ajax({url:"/AjaxProduct/SaveCategory",type:"post",contentType:"application/json",data:JSON.stringify({productcategory_id:$("#selectFirstCategroy").val(),sv_pc_name:i,producttype_id:-1})}).done(function(i){enabledButtonById("saveProductCategroy");i==!0&&(layer.closeAll(),t(n),layer.msg("\u4fdd\u5b58\u6210\u529f",{icon:1,time:2e3},function(n){layer.close(n)}))})):($("#secondCategroyName").focus(),layer.msg("\u8bf7\u8f93\u5165\u5206\u7c7b\u7684\u540d\u79f0\uff01"),enabledButtonById("saveProductCategroy"))})}function t(n){$.get("/AjaxProduct/GetCategoryById?cid="+n+"&pange=1&count=1000").done(function(n){if(n&&n.length>0){var t="";$(n).each(function(n,i){t+='<li data-productcategory_id = "'+i.productsubcategory_id+'" data-name="'+i.sv_psc_name+'"><div class="bigCategorieslist-name">';t+='<i class="icon-stop stop-type"><\/i>';t+="<span>"+i.sv_psc_name+"<\/span>";t+="<\/div>";t+='<div class="editbigCategorieslist">';t+='<a data-productcategory_id = "'+i.productsubcategory_id+'" href="javascript:void(0);" class="editSecondCategroy">';t+='<i class="icon-edit"><\/i>';t+="<\/a>";t+='<a data-productcategory_id = "'+i.productsubcategory_id+'" data-categroyType="2" href="javascript:void(0);" class="deletecategories">';t+='<i class="icon-remove"><\/i>';t+="<\/a><\/div><\/li>"});$("#samllCategorieslist").html(t)}else $("#samllCategorieslist").html('<li><div class="bigCategorieslist-name text-center">\u6682\u65e0\u6570\u636e<\/div><\/li>')}).done(function(){$(".productCategories #samllCategorieslist>li").hover(function(){$(this).addClass("showbg");$(this).children(".editbigCategorieslist").addClass("show");$(this).children(".bigCategorieslist-name").addClass("paddright")},function(){$(this).removeClass("showbg");$(this).hasClass("active")||($(this).children(".editbigCategorieslist").removeClass("show"),$(this).children(".bigCategorieslist-name").removeClass("paddright"))})})}function o(){$("#productCategroyName").val($("#bigCategorieslist>li.active").data("name"));var n=$("#bigCategorieslist>li.active").data("producttype_id");n!=0&&$("#selectCategonriesTypes li.select:eq(1)").addClass("active").siblings("li.select").removeClass("active");$("#saveProductCategroy").unbind("click").click(function(){var n=$("#productCategroyName").val().replace(/\ +/g,"");n?(disableButtonById("saveProductCategroy"),$.ajax({url:"/AjaxProduct/SaveCategory",type:"post",contentType:"application/json",data:JSON.stringify({productcategory_id:0,sv_pc_name:$("#productCategroyName").val(),producttype_id:$("#selectCategonriesTypes>li.active").data("type"),productsubcategory_id:$("#bigCategorieslist>li.active").data("productcategory_id")})}).done(function(n){enabledButtonById("saveProductCategroy");n==!0&&(layer.closeAll(),$(".allbigCategories").fadeIn(0),$(".smallCategories").fadeOut(0),readyProductBigCategory.getProductFirstCategory(),readyProductBigCategory.getProductFirstCategoryTable(),layer.msg("\u4fdd\u5b58\u6210\u529f",{icon:1,time:2e3},function(n){layer.close(n)}))})):($("#productCategroyName").focus(),layer.msg("\u8bf7\u8f93\u5165\u5206\u7c7b\u7684\u540d\u79f0\uff01"),enabledButtonById("saveProductCategroy"))})}function s(){$(".editbigcategonriesbox").fadeOut(0);$(".addsmallbigcategonries").fadeIn(0);var n=$("#bigCategorieslist>li.active").data("productcategory_id");$("#secondCategroyName").val($("#samllCategorieslist>li.active").data("name"));n>0&&$.get("/ProductCategory/GetFirstCategory").done(function(t){var i,r;if(t&&t.length>0){i="";for(r in t)i+='<option value="'+t[r].productcategory_id+'">'+t[r].sv_pc_name+"<\/option>";$("#selectFirstCategroy").html(i);$("#selectFirstCategroy").find('option[value="'+n+'"]').prop("selected",!0)}});$("#saveProductCategroy").unbind("click").click(function(){var i=$("#secondCategroyName").val().replace(/\ +/g,"");i?(disableButtonById("saveProductCategroy"),$.ajax({url:"/AjaxProduct/SaveCategory",type:"post",contentType:"application/json",data:JSON.stringify({productcategory_id:$("#selectFirstCategroy").val(),sv_pc_name:i,producttype_id:-1,productsubcategory_id:$("#samllCategorieslist>li.active").data("productcategory_id")})}).then(function(i){enabledButtonById("saveProductCategroy");i==!0&&(layer.closeAll(),t(n),layer.msg("\u4fdd\u5b58\u6210\u529f",{icon:1,time:1500},function(n){layer.close(n)}))})):($("#secondCategroyName").focus(),layer.msg("\u8bf7\u8f93\u5165\u5206\u7c7b\u7684\u540d\u79f0\uff01"),enabledButtonById("saveProductCategroy"))})}function u(n){setTimeout(function(){$("#categonriesLength").text(samllCategorieslistlength)},500);var i=n.categroyType;i==1?$("#confireDeleteCategroy").unbind("click").click(function(){$.ajax({url:"/AjaxProduct/DeleteCategory?id="+n.categroyId+"&type=c",type:"GET",contentType:"text/html",success:function(n){n.succeed==!0?(layer.closeAll(),layer.msg("\u5220\u9664\u7c7b\u522b\u6210\u529f"),readyProductBigCategory.getProductFirstCategory(),readyProductBigCategory.getProductFirstCategoryTable(),$(".allbigCategories").fadeIn(0),$(".smallCategories").fadeOut(0)):layer.msg(n.errmsg)}})}):$("#confireDeletesmallCategroy").unbind("click").click(function(){$.ajax({url:"/AjaxProduct/DeleteCategory?id="+n.categroyId+"&type=subc",type:"GET",contentType:"text/html",success:function(n){n.succeed==!0?(layer.closeAll(),layer.msg("\u5220\u9664\u7c7b\u522b\u6210\u529f"),t($("#bigCategorieslist>li.active").data("productcategory_id"))):layer.msg(n.errmsg)}})})}$("#allbigCategorieslist").delegate(".uparrow","click",function(){var t,u,f;i();t=parseInt($(this).data("sv_sort"));u=parseInt($(this).data("sv_sort"))-1;t>1&&($("#sort_"+t).attr("data-sv_sort",u),$("#sort_"+u).attr("data-sv_sort",t),f=n(),r(f))});$("#allbigCategorieslist").delegate(".downarrow","click",function(){var t,u,f;i();console.log(f);t=parseInt($(this).data("sv_sort"));u=parseInt($(this).data("sv_sort"))+1;t>=1&&($("#sort_"+t).attr("data-sv_sort",u),$("#sort_"+u).attr("data-sv_sort",t),f=n(),r(f))});$("#allbigCategorieslist").delegate(".productCategoryShowSwitch","click",function(){var n=$(this).data("productcategory_id"),t=$("#editId_"+n).prop("checked");$.ajax({url:"/AjaxProduct/SaveCategoryEnabled/",type:"post",dataType:"json",async:!0,cache:!1,data:{categoryId:n,enabled:!t}}).done(function(n){n==!0?layer.msg("\u64cd\u4f5c\u6210\u529f\uff01"):n==!1?(layer.msg("\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u540e\u518d\u8bd5\uff01"),readyProductBigCategory.getProductFirstCategoryTable()):n==-2&&layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01")})});$("#addbigCategories").click(function(){layerpage.Deke_layerpage.show_Url2("1","\u65b0\u589e\u5927\u5206\u7c7b","/ajaxHtml_N3/product/addcategories.html?="+getTimeStamp(),["430px","250px"],f)});$(document).on("click","#selectCategonriesTypes>li.select",function(){$(this).addClass("active").siblings("li").removeClass("active")});$(document).on("click","#addsmallCategories",function(){layerpage.Deke_layerpage.show_Url2("1","\u65b0\u589e\u5c0f\u5206\u7c7b","/ajaxHtml_N3/product/addcategories.html?="+getTimeStamp(),["430px","250px"],e)});$("#bigCategorieslist").delegate(".editFirstCategroy","click",function(){layerpage.Deke_layerpage.show_Url2("1","\u4fee\u6539\u5927\u5206\u7c7b","/ajaxHtml_N3/product/addcategories.html?="+getTimeStamp(),["430px","250px"],o)});$(document).unbind("click","#samllCategorieslist .editSecondCategroy").on("click","#samllCategorieslist .editSecondCategroy",function(){layerpage.Deke_layerpage.show_Url2("1","\u4fee\u6539\u5c0f\u5206\u7c7b","/ajaxHtml_N3/product/addcategories.html?="+getTimeStamp(),["430px","250px"],s)});$(".productCategories").delegate(".deletecategories","click",function(){var t=$(this).attr("data-categroytype"),i=$(this).attr("data-productcategory_id"),n;t==1?(n={categroyType:t,categroyId:i},layerpage.Deke_layerpage.getpage2("1","\u5220\u9664\u5206\u7c7b","/ajaxHtml_N3/product/deletecategonries.html?="+getTimeStamp(),["430px","280px"],u,n)):(n={categroyType:t,categroyId:i},layerpage.Deke_layerpage.getpage2("1","\u5220\u9664\u5206\u7c7b","/ajaxHtml_N3/product/deletesmallcategonries.html?="+getTimeStamp(),["430px","280px"],u,n))})}};