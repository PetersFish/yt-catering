function salesGetShopNameFn(){$.get("/BranchStore/GetStorelist/?type=0",function(n){var t,i;if(n==-2)layer.msg("\u60a8\u6ca1\u6709\u8be5\u6743\u9650\uff01");else if(n==-1)$("#getshopname").hide();else{$("#getshopname").show();t="";for(i in n)t+=n[i];$("#getshopname").html(t)}})}function salesGetOperatorFn(){var n='<option value="">\u64cd\u4f5c\u5458<\/option>';$.getJSON("/Salesclerk/PageList/",{page:1,pagesize:100},function(t){if(t!=null&&t.length>0)for(var i=0;i<t.length;i++)n+=isNullOrWhiteSpace(t[i].sv_employee_name)?'<option value="'+t[i].sp_salesclerkid+'">'+t[i].sv_employee_name+"<\/option>":'<option value=""><\/option>';$("#getoperator").html(n)})}var pagesize=5,pageIndex=1,chosenHtml,rechargeSummary;$(document).ready(function(){salesGetShopNameFn();salesGetOperatorFn();rechargeSummary.getSavingsCountsFn("","",1,"","","","","");rechargeSummary.exportReport()});$(document).unbind("click","#queryday>li").on("click","#queryday>li",function(){var n=$(this).data("queryday");$(this).addClass("active").siblings("li").removeClass("active");n!=3?($(".querydate").css("display","none"),rechargeSummary.shareQueryRechargeInfoFn()):$(".querydate").css("display","block");$("#otherday").unbind("click").click(function(){rechargeSummary.shareQueryRechargeInfoFn()})});$("#begindate").datetimepicker({language:"zh",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,forceParse:0,endDate:new Date,pickerPosition:"bottom-left"}).on("change",function(){var n=$("#begindateval").val();$("#enddate").datetimepicker("setStartDate",n);$("#begindate").datetimepicker("hide")});$("#enddate").datetimepicker({language:"zh",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,forceParse:0,startDate:$("#begindateval").val(),endDate:new Date,pickerPosition:"bottom-left"}).on("change",function(){var n=$("#enddateval").val();$("#begindate").datetimepicker("setReturnDate",n);$("#enddate").datetimepicker("hide")});$("#getshopname,#getoperator").change(function(){rechargeSummary.shareQueryRechargeInfoFn()});chosenHtml="";$(document).on("click","#paystyle>li,#salesstyle>li",function(){var n=$(this).hasClass("on"),t=$(this).hasClass("active");n||(t?($('#chosen>li[data-name="'+$(this).data("name")+'"').remove(),$("#chosen>li").length==1&&$("#chosen").hide(0)):($("#chosen").show(0),$(this).addClass("active").siblings("li").removeClass("active"),$('#chosen>li[data-name="'+$(this).data("name")+'"').remove(),chosenHtml=$(this).clone(!0),chosenHtml.appendTo("#chosen")))});$(document).on("click","#chosen>li.active",function(){$(this).remove();$("[data-name='"+$(this).data("name")+"']").removeClass("active");$("[data-queryid='-1'][data-name='"+$(this).data("name")+"']").addClass("active");$("#chosen>li").length==1&&$("#chosen").hide(0)});$(document).on("click","#btnOrderQuery",function(){rechargeSummary.shareQueryRechargeInfoFn()});$("#savingsList").delegate(".revokedsavings","click",function(){var n=$(this).data("id");layer.confirm("\u60a8\u786e\u8ba4\u8981\u53d6\u6d88\u8be5\u7b14\u5145\u503c\u5417\uff1f",{btn:["\u786e\u8ba4","\u53d6\u6d88"]},function(){$.post("/intelligent/Post_cancelto_up/"+n,function(n){loggin.chklogn(n);n>0?(layer.msg("\u64cd\u4f5c\u6210\u529f\uff01"),rechargeSummary.shareQueryRechargeInfoFn()):n==-3?layer.msg("\u73b0\u5728\u7528\u6237\u7684\u5361\u4f59\u989d\u4e0d\u8db3\u53d6\u6d88\u8be5\u7b14\u8ba2\u5355\uff0c\u6216\u8005\u8bf7\u5148\u53d6\u6d88\u8ba2\u5355\uff01"):n==-5?layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01"):layer.msg("\u64cd\u4f5c\u5931\u8d25\uff01")})})});rechargeSummary={shareQueryRechargeInfoFn:function(){var n="",t="",i=$("#queryday>li.active").data("queryday"),r=$("#salesmemberInfo").val().trim(),u=$("#begindateval").val()||"",f=$("#enddateval").val()||"",e=$("#getshopname").val(),o=$("#getoperator").val();$("#chosen li.active").each(function(){switch($(this).data("name")){case"paystyle":n=$(this).data("queryid");break;case"salesstyle":t=$(this).data("queryid")}});rechargeSummary.getSavingsCountsFn(n,t,i,r,u,f,e,o)},getRechargeSummaryFn:function(n,t,i,r,u,f,e,o){$.getJSON("/intelligent/getSumtop_up",{zhifu:n,jilu:t,day:i,key:r,date:u,date2:f,storeid:e,sv_mrr_operator:o},function(n){var r="",u=3,t,i;if(n)for(t in n)if(t=="list"){if(n.list!=null&&n.list!=""&&n.list.length>0){for(n.list.length<3&&(u=n.list.length),i=0;i<u;i++)r+='<li class="top-list">',r+='<div class="membertopname fl"><i>'+(i+1)+".<\/i><span>"+n[t][i].sv_mr_name+"<\/span><\/div>",r+='<div class="membertopmoney fr"><span class="money">'+parseFloat(n[t][i].sv_mrr_money).toFixed(2)+'<\/span><i class="pad">\u5143<\/i><\/div>',r+="<\/li>";$("#lasticonlist").html(r)}}else $("#"+t).text(parseFloat(n[t]).toFixed(2))})},getSavingsCountsFn:function(n,t,i,r,u,f,e,o){rechargeSummary.getRechargeSummaryFn(n,t,i,r,u,f,e,o);$.get("/intelligent/GetSavingsCount/",{zhifu:n,jilu:t,day:i,key:r,date:u,date2:f,storeid:e,sv_mrr_operator:o},function(s){var h=Math.ceil(s/pagesize);laypage({cont:$("#layerpage"),pages:h,skin:"molv",skip:!0,first:"\u9996\u9875",last:"\u5c3e\u9875",prev:"\u4e0a\u4e00\u9875",next:"\u4e0b\u4e00\u9875",jump:function(s){pageinxe=s.curr;rechargeSummary.getSavingsListFn(s.curr,n,t,i,r,u,f,e,o)}})})},getSavingsListFn:function(n,t,i,r,u,f,e,o,s){$.getJSON("/intelligent/GetSavingsList/"+n,{zhifu:t,jilu:i,day:r,key:u,date:f,date2:e,storeid:o,sv_mrr_operator:s},function(n){var t,r,i,u;if(n&&n.length>0){for(t="",r="",i=0;i<n.length;i++){switch(n[i].sv_mrr_type){case-1:r="\u6263\u8d39\u9000\u6b3e";break;case-2:r="\u50a8\u503c\u9000\u6b3e";break;case 0:r="\u50a8\u503c";break;case 1:r="\u6263\u8d39";break;case 2:r="\u8ba2\u5355\u6d88\u8d39";break;case 4:r="\u5f00\u5361\u5145\u503c"}t+="<tr>";t+="<td><span>"+n[i].sv_mr_cardno+"<\/span><\/td>";t+="<td><span>"+n[i].sv_mr_name+"<\/span><\/td>";t+="<td><span>"+r+"<\/span><\/td>";t+='<td><i class="colorff">\u00a5'+n[i].sv_mrr_money+"<\/i><\/td>";t+="<td><span>\u00a5"+n[i].sv_mrr_present+"<\/span><\/td>";t+='<td><i class="colorff">\u00a5'+n[i].sv_mrr_amountafter+"<\/i><\/td>";t+="<td><span>"+new Date(n[i].sv_mrr_date).Format("yyyy-MM-dd")+"<\/span><\/td>";t+="<td><span>"+n[i].sv_mrr_payment+"<\/span><\/td>";t+="<td><span>"+n[i].consumeusername+"<\/span><\/td>";t+="<td><span>"+n[i].memberuserName+"<\/span><\/td> ";t+='<td class="text-center"><span class="tipss icon-question-sign salestips" data-content="'+n[i].sv_mrr_desc+'"><\/span><\/td>';t+='<td class="shareexecl">';n[i].sv_mrr_type!=2?n[i].sv_mrr_state||n[i].sv_mrr_type==-1||n[i].sv_mrr_type==-2?t+='<a style="width:100%;" class="isonereturnclass" href="javascript:void(0);" >\u5df2\u7ecf\u64a4\u9500 <\/a> ':(t+='<a href="javascript:void(0);" class="revokedsavings" data-id="'+n[i].recharge_id+'">\u64a4\u9500\u5145\u503c <\/a>',t+='<a href="javascript:void(0);" class="savingsprint" data-id="'+n[i].recharge_id+'">\u6253\u5370 <\/a> '):t+="\u8bf7\u79fb\u6b65\u5230\u9500\u552e\u5206\u6790";t+="<\/td>";t+="  <\/tr>"}$("#savingsList").html(t)}else u=$("#rowlength").children("th").length,$("#savingsList").html('<tr><td class="text-center sad" style="" colspan="'+u+'"><img src="../skin_N3/images/sad.png" /><i class="padd0">\u6682\u65e0\u6570\u636e<\/i><\/td><\/tr>')})},exportReport:function(){$("#exportreport").click(function(){disableButtonById("exportReport");var n="",t="";$("#chosen li.active").each(function(){switch($(this).data("name")){case"paystyle":n=$(this).data("queryid");break;case"salesstyle":t=$(this).data("queryid")}});$.getJSON("/intelligent/GetSavingsList/",{zhifu:n,jilu:t,day:$("#queryday>li.active").data("queryday"),key:$("#salesmemberInfo").val().trim(),date:$("#begindateval").val()||"",date2:$("#enddateval").val()||"",storeid:$("#getshopname").val(),isexport:1,sv_mrr_operator:$("#getoperator").val()},function(n){n==-2?(enabledButtonById("exportReport"),layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01")):n!=0?location.href=n:(enabledButtonById("exportReport"),layer.msg("\u6570\u636e\u5bfc\u51fa\u5931\u8d25!"))})})}};$("#salesmemberInfo").keydown(function(n){if(n.keyCode==113){var t=typeof Cef;t!=undefined&&GetICCardEventData($("#salesmemberInfo"),n)}});