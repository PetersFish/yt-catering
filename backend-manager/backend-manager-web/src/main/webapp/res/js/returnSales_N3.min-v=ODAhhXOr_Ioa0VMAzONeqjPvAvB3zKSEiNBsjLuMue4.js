function salesGetShopNameFn(){$.get("/BranchStore/GetStorelist/?type=0",function(n){var t,i;if(n==-2)layer.msg("\u60a8\u6ca1\u6709\u8be5\u6743\u9650\uff01");else if(n==-1)$("#getshopname").hide();else{$("#getshopname").show();t="";for(i in n)t+=n[i];$("#getshopname").html(t)}})}function salesGetOperatorFn(){var n='<option value="">\u64cd\u4f5c\u5458<\/option>';$.getJSON("/Salesclerk/PageList/",{page:1,pagesize:100},function(t){if(t!=null&&t.length>0)for(var i=0;i<t.length;i++)n+=isNullOrWhiteSpace(t[i].sv_employee_name)?'<option value="'+t[i].sp_salesclerkid+'">'+t[i].sv_employee_name+"<\/option>":'<option value=""><\/option>';$("#getoperator").html(n)})}function shareQuerySalesInfoFn(){var n="",t="",i=$("#queryday>li.active").data("queryday"),r=$("#serialnumber").val(),u=$("#memberinfo").val(),f=$("#begindateval").val(),e=$("#enddateval").val(),o=$("#getshopname").val(),s=$("#getoperator").val();$("#chosen li.active").each(function(){switch($(this).data("name")){case"paystyle":var i=$(this).data("queryid");n=i!=-1?i:"";break;case"consumerobject":t=$(this).data("queryid")}});getSalesListFn(n,pageIndex,pagesize,t,i,u,r,f,e,o,s)}function getSalesListFn(n,t,i,r,u,f,e,o,s,h,c){var l='<tr id="rowlength">',a;l+=_g_sv_uit_cache_name=="cache_name_catering"?"<th>\u83dc\u54c1\u540d\u79f0<\/th>":"<th>\u5546\u54c1\u540d\u79f0<\/th>";l+="<th>\u5355\u53f7<\/th>";l+="<th>\u6d88\u8d39\u5bf9\u8c61<\/th>";l+="<th>\u5546\u54c1\u5355\u4ef7<\/th><th>\u6298\u6263\u7c7b\u578b<\/th>";l+="<th>\u9000\u8d27\u6570\u91cf<\/th><th>\u9000\u8d27\u91d1\u989d<\/th>";l+="<th>\u9000\u8d27\u539f\u56e0<\/th><th>\u9000\u8d27\u5e97\u94fa<\/th>";l+="<th>\u6240\u5c5e\u5e97\u94fa<\/th><th>\u9000\u8d27\u65f6\u95f4<\/th>";_g_sv_uit_cache_name=="cache_name_catering"&&(l+="<th>\u53e3\u5473<\/th>");l+='<th class="text-center">\u5907\u6ce8<\/th><\/tr>';$("#salesreporthtml").html(l);a=openLoadingIng();$.getJSON("/intelligent/GetIntelligentReturnSalesList/",{payname:n,type:r,day:u,key:f,liushui:e,date:o,date2:s,storeid:h,seller:c,product:$("#productinfo").val(),page:t,pagesize:i},function(l){var rt,v,p,y,k,b,wt,w,gt,nt,ot,et,ht,ct,d,ft,g,ni;if(commonCloseLoading(a),l)if(rt=[],rt.push(l.rowCount,l.productCount,l.totalAmount),$("#rowcount").text(rt[0]),$("#productcount").text(rt[1]),$("#totalamount").text(rt[2]),pages=Math.ceil(rt[0]/i),laypage({cont:$("#layerpage"),pages:pages,skin:"molv",skip:!0,first:"\u9996\u9875",last:"\u5c3e\u9875",prev:"\u4e0a\u4e00\u9875",next:"\u4e0b\u4e00\u9875",curr:t||1,jump:function(l,a){a||(t=l.curr,getSalesListFn(n,l.curr,i,r,u,f,e,o,s,h,c));pages>1?(addPageSizeFn("#selectpagesize"),$("#pagesize").find("option[value='"+i+"']").attr("selected",!0)):$("#selectpagesize").html("")}}),v=l.orderList,v&&v.length>0){for(p="",y=0;y<v.length;y++){var ti="",bt="",lt="";if(jie+=v[y].order_money+v[y].order_money2,k=parseFloat(v[y].prlist[0].product_discount),b=parseFloat(v[y].order_discount),v[y].prlist!=null&&v[y].prlist!=""&&v[y].prlist.length>1){var ut="",tt=v[y].prlist[0].sv_p_minunitprice,ri=v[y].prlist[0].sv_p_discount,at=v[y].prlist[0].sv_p_mindiscount/10,it=v[y].prlist[0].product_orig_discount,kt=v[y].prlist[0].sv_p_memberprice,dt=v[y].prlist[0].product_discount,ii=v[y].prlist[0].product_unitprice,vt=v[y].prlist[0].product_price,yt=parseFloat(it*vt),et=v[y].prlist[0].product_num,pt=v[y].prlist[0].sv_p_weight,st=0;for(st=v[y].prlist[0].sv_pricing_method==1?parseFloat(tt*pt).toFixed(2):tt*et,nt=v[y].user_cardno!=null&&v[y].user_cardno!=""&&v[y].user_cardno!="0"&&v[y].user_cardno!=0?v[y].user_cardno:"",ut=nt?b>0&&b<1&&k!=0&&k<1?"\u4f1a\u5458\u6298("+k+")\uff0c\u6298\u6263("+b+")":b>0&&b<1?"\u6298\u6263("+b+")":k!=0&&k<1?"\u4f1a\u5458\u6298("+k+")":"\u65e0\u6298\u6263":b>0&&b<1?"\u6298\u6263("+b+")":"\u65e0\u6298\u6263",ti=v[y].order_state>0||v[y].Numcount==0?"isallreturnclass":"",v[y].order_state==2&&(lt="printswitch"),p+='<tr class="moreProudct gesture" data-id="'+v[y].order_id+'"> <td class="gesture">',ot=v[y].prlist[0].sv_p_barcode!=null&&v[y].prlist[0].sv_p_barcode!=""?v[y].prlist[0].sv_p_barcode:"",p+='<img class="img fl" src="'+(v[y].prlist[0].sv_p_images2==null||v[y].prlist[0].sv_p_images2==""?"":_g_res_images_url+v[y].prlist[0].sv_p_images2)+'" onerror="this.src=\'/images/002.png\';">',p+='<div class="shareproductinfo fl"><div class="box1">',p+=' <span class="productnamespan" title="'+v[y].prlist[0].product_name+'">'+v[y].prlist[0].product_name+"<\/span>",p+='<i class="multiplepen">\u591a\u7b14<\/i>',p+="<\/div>",p+='<div class="box1">',p+='<span class="color999">'+ot+"<\/span>",p+="<\/div><\/div>",p+='<div class="showtext"><i class="colorff">\u672c\u6b21\u6d88\u8d39\u6570\u636e\u5408\u8ba1:<\/i>',p+='<i class="bgred">\u591a\u7b14<\/i><i class="icon-chevron-down male5"><\/i>',p+="<\/div>",p+="<\/td>",p+="<td>"+v[y].order_running_id+"<\/td>",p+=v[y].user_cardno!="0"?v[y].sv_mr_name==null?'<td><img src="/images/001.png" /><\/td>':"<td>"+v[y].sv_mr_name+"<\/td>":"<td>\u6563\u5ba2<\/td>",p+="<td><\/td>",p+="<td>"+ut+"<\/td>",p+="<td>"+v[y].numcount+"<\/td>",p+='<td><i class="colorff">'+v[y].order_receivable+"<\/i><\/td>",wt="",v[y].order_payment2!="\u5f85\u6536"&&v[y].order_payment2!="\u5f85\u4ed8"&&(wt="("+v[y].order_money+"),"+v[y].order_payment2+"("+v[y].order_money2+")"),p+="<td><span>"+v[y].order_payment+wt+"<\/span><\/td>",ht=isNullOrWhiteSpace(v[y].consumeusername)==!0?v[y].consumeusername:"",ct=isNullOrWhiteSpace(v[y].memberuserName)==!0?v[y].memberuserName:"",p+="<td><span>"+ht+"<\/span><\/td>",p+="<td><span>"+ct+"<\/span><\/td> ",p+="<td><span>"+new Date(v[y].order_datetime).Format("MM-dd hh:mm:ss")+"<\/span><\/td> ",_g_sv_uit_cache_name=="cache_name_catering"&&(p+="<td><\/td> "),p+=v[y].sv_remarks?'<td><a class="sv_remarks" href="javascript: void(0);" data-sv_remarks="'+v[y].sv_remarks+'">\u8be6\u60c5<\/a><\/td> ':'<td data-sv_remarks=""><\/td> ',p+=" <\/tr>",w=0;w<v[y].prlist.length;w++){var ut="",tt=v[y].prlist[w].sv_p_minunitprice,ri=v[y].prlist[w].sv_p_discount,at=v[y].prlist[w].sv_p_mindiscount/10,it=v[y].prlist[w].product_orig_discount,kt=v[y].prlist[w].sv_p_memberprice,dt=v[y].prlist[w].product_discount,ii=v[y].prlist[w].product_unitprice,vt=v[y].prlist[w].product_price,yt=parseFloat(it*vt),et=v[y].prlist[w].product_num,pt=v[y].prlist[w].sv_p_weight,st=0;if(st=v[y].prlist[w].sv_pricing_method==1?parseFloat(tt*pt).toFixed(2):tt*et,nt=v[y].user_cardno!=null&&v[y].user_cardno!=""&&v[y].user_cardno!="0"&&v[y].user_cardno!=0?v[y].user_cardno:"",ut=isNullOrWhiteSpace(nt)&&kt>0?"\u4f1a\u5458\u4ef7("+kt+".00)":isNullOrWhiteSpace(nt)&&at>0&&it<at?"\u6700\u4f4e\u6298("+at+")":isNullOrWhiteSpace(nt)&&it>0&&dt<=it&&dt!=1&&yt>ii?"\u4f1a\u5458\u6298("+it+")":isNullOrWhiteSpace(nt)&&yt>0&&yt<tt?"\u6700\u4f4e\u4ef7("+st+")":"\u65e0\u6298\u6263",count+=v[y].prlist[w].product_total,bt=v[y].prlist[w].order_stutia>0?"isonereturnclass":"",p+=v[y].prlist[w].order_stutia>0?'<tr class="hideproduct bordertopnone gesture"  data-id= "'+v[y].order_id+'">  ':'<tr class="hideproduct bordertopnone gesture" data-id= "'+v[y].order_id+'">  ',ot=v[y].prlist[0].sv_p_barcode!=null&&v[y].prlist[0].sv_p_barcode!=""?v[y].prlist[0].sv_p_barcode:"",p+='<td class="gesture"><img class="img fl" src="'+(v[y].prlist[0].sv_p_images2==null||v[y].prlist[0].sv_p_images2==""?"":_g_res_images_url+v[y].prlist[0].sv_p_images2)+'" onerror="this.src=\'/images/002.png\';">',p+=' <span class="productnamespan" title="'+v[y].prlist[w].product_name+'">'+v[y].prlist[w].product_name+"<\/span>",p+="<\/td>",p+="<td><\/td>",p+="<td><\/td>",p+="<td>"+v[y].prlist[w].product_price+"<\/td>",p+="<td>"+ut+"<\/td>",gt=v[y].prlist[w].sv_pricing_method==1?v[y].prlist[w].sv_p_weight:v[y].prlist[w].product_num,p+="<td>"+gt+"<\/td>",p+='<td><i class="colorff">'+v[y].prlist[w].product_total+"<\/i><\/td>",p+="<td><\/td>",p+="<td><\/td>",p+="<td><\/td>",p+="<td><\/td>",_g_sv_uit_cache_name=="cache_name_catering"){if(d=eval(v[y].prlist[w].product_taste_money_detail),ft="",d!=null&&d.length>0)for(g=0;g<d.length;g++)ft+=d[g].name+"("+d[g].price+")";p+="<td>"+ft+"<\/td>"}p+="<td><\/td>";p+="<\/tr> "}}else if(v[y].prlist!=null&&v[y].prlist!=""&&v[y].prlist.length>0){var ut="",tt=v[y].prlist[0].sv_p_minunitprice,ri=v[y].prlist[0].sv_p_discount,at=v[y].prlist[0].sv_p_mindiscount/10,it=v[y].prlist[0].product_orig_discount,kt=v[y].prlist[0].sv_p_memberprice,dt=v[y].prlist[0].product_discount,ii=v[y].prlist[0].product_unitprice,vt=v[y].prlist[0].product_price,yt=parseFloat(it*vt),et=v[y].prlist[0].product_num,pt=v[y].prlist[0].sv_p_weight,st=0;if(st=v[y].prlist[0].sv_pricing_method==1?parseFloat(tt*pt).toFixed(2):tt*et,nt=v[y].user_cardno!=null&&v[y].user_cardno!=""&&v[y].user_cardno!="0"&&v[y].user_cardno!=0?v[y].user_cardno:"",ut=nt?b>0&&b<1&&k!=0&&k<1?"\u4f1a\u5458\u6298("+k+")\uff0c\u6298\u6263("+b+")":b>0&&b<1?"\u6298\u6263("+b+")":k!=0&&k<1?"\u4f1a\u5458\u6298("+k+")":"\u65e0\u6298\u6263":b>0&&b<1?"\u6298\u6263("+b+")":"\u65e0\u6298\u6263",v[y].prlist[0].order_stutia>0?(bt="isonereturnclass",lt="printswitch",p+='<tr class="" data-id="'+v[y].order_id+'"> '):(p+='<tr data-id="'+v[y].order_id+'"> ',lt=""),ot=v[y].prlist[0].sv_p_barcode!=null&&v[y].prlist[0].sv_p_barcode!=""?v[y].prlist[0].sv_p_barcode:"",p+='<td class="gesture">',p+='<img class="img fl" src="'+(v[y].prlist[0].sv_p_images2==null||v[y].prlist[0].sv_p_images2==""?"":_g_res_images_url+v[y].prlist[0].sv_p_images2)+'" onerror="this.src=\'/images/002.png\';" alt="" />',p+='<div class="shareproductinfo fl"><div class="box1">',p+='<span class="productnamespan" title="'+v[y].prlist[0].product_name+'">'+v[y].prlist[0].product_name+"<\/span>",p+='<\/div><div class="box1">',p+='<span class="color999">'+ot+"<\/span>",p+="<\/div><\/td>",p+="<td>"+v[y].order_running_id+"<\/td>",p+=v[y].user_cardno!="0"?v[y].sv_mr_name==null?'<td><img src="/images/001.png" /><\/td>':"<td>"+v[y].sv_mr_name+"<\/td>":"<td>\u6563\u5ba2<\/td>",p+="<td>"+v[y].prlist[0].product_price+"<\/td>",p+="<td>"+ut+"<\/td>",et=v[y].prlist[0].sv_pricing_method==1?v[y].prlist[0].sv_p_weight:v[y].prlist[0].product_num,p+="<td>"+et+"<\/td>",p+='<td><i class="colorff">'+v[y].order_receivable+"<\/i><\/td>",p+="<td>"+v[y].order_payment+(v[y].order_payment2!="\u5f85\u6536"&&v[y].order_payment2!="\u5f85\u4ed8"?"("+parseInt(v[y].order_money).toFixed(2)+"),"+v[y].order_payment2+"("+parseInt(v[y].order_money2).toFixed(2)+")":"")+"<\/td>",ht=isNullOrWhiteSpace(v[y].consumeusername)==!0?v[y].consumeusername:"",ct=isNullOrWhiteSpace(v[y].memberuserName)==!0?v[y].memberuserName:"",p+="<td>"+ht+"<\/td>",p+="<td>"+ct+"<\/td> ",p+="<td>"+new Date(v[y].order_datetime).Format("MM-dd hh:mm:ss")+"<\/td> ",_g_sv_uit_cache_name=="cache_name_catering"){if(d=eval(v[y].prlist[0].product_taste_money_detail),ft="",d!=null&&d.length>0)for(g=0;g<d.length;g++)ft+=d[g].name+"("+d[g].price+")";p+="<td>"+ft+"<\/td> "}p+=v[y].sv_remarks?'<td class="text-center"><span class="tipss salestips icon-question-sign" data-content="'+v[y].sv_remarks+'"><\/span><\/td> ':'<td data-sv_remarks=""><\/td> ';p+="<\/tr>";count+=v[y].prlist[0].product_total}}$("#saleslisthtml").html(p)}else ni=$("#rowlength").children("th").length,$("#saleslisthtml").html('<tr><td class="text-center sad" style="" colspan="'+ni+'"><img src="../skin_N3/images/sad.png" /><i class="padd0">\u6682\u65e0\u6570\u636e<\/i><\/td><\/tr>')})}var pagesize=5,pageIndex=1,chosenHtml,jie;$(document).ready(function(){salesGetShopNameFn();salesGetOperatorFn();getSalesListFn(null,1,pagesize,null,1,null,null,null,null,null,null)});$(document).unbind("click","#queryday>li").on("click","#queryday>li",function(){var n=$(this).data("queryday");$(this).addClass("active").siblings("li").removeClass("active");n!=3?($(".querydate").css("display","none"),shareQuerySalesInfoFn()):$(".querydate").css("display","block");$("#otherday").unbind("click").click(function(){var n=$("#begindateval").val(),t=$("#enddateval").val();shareQuerySalesInfoFn()})});$("#begindate").datetimepicker({language:"zh",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,forceParse:0,endDate:new Date,pickerPosition:"bottom-left"}).on("change",function(){var n=$("#begindateval").val();$("#enddate").datetimepicker("setStartDate",n);$("#begindate").datetimepicker("hide")});$("#enddate").datetimepicker({language:"zh",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,forceParse:0,startDate:$("#begindateval").val(),endDate:new Date,pickerPosition:"bottom-left"}).on("change",function(){var n=$("#enddateval").val();$("#begindate").datetimepicker("setReturnDate",n);$("#enddate").datetimepicker("hide")});$("#getshopname,#getoperator").change(function(){shareQuerySalesInfoFn()});$(document).on("change","#pagesize",function(){pagesize=$(this).val();shareQuerySalesInfoFn()});chosenHtml="";$(document).on("click","#paystyle>li,#consumerobject>li",function(){var n=$(this).hasClass("on"),t=$(this).hasClass("active");n||(t?($('#chosen>li[data-name="'+$(this).data("name")+'"').remove(),$("#chosen>li").length==1&&$("#chosen").hide(0)):($("#chosen").show(0),$(this).addClass("active").siblings("li").removeClass("active"),$('#chosen>li[data-name="'+$(this).data("name")+'"').remove(),chosenHtml=$(this).clone(!0),chosenHtml.appendTo("#chosen")))});$(document).on("click","#chosen>li.active",function(){$(this).remove();$("[data-name='"+$(this).data("name")+"']").removeClass("active");$("[data-queryid='-1'][data-name='"+$(this).data("name")+"']").addClass("active");$("#chosen>li").length==1&&$("#chosen").hide(0)});$(document).on("click","#btnOrderQuery",function(){shareQuerySalesInfoFn()});$("#btnOrderQuery").keyup(function(n){n.keyCode==13&&shareQuerySalesInfoFn()});$("#memberinfo").keydown(function(n){if(n.keyCode==113){var t=typeof Cef;t!=undefined&&GetICCardEventData($("#memberinfo"),n)}});$("#exportsalesreport").click(function(){var i;disableButtonById("agreereturn");var r=layer.load(0,{shade:[.3,"#393D49"]}),n="",t="";$("#chosen li.active").each(function(){switch($(this).data("name")){case"paystyle":var i=$(this).data("queryid");n=i!=-1?i:"";break;case"consumerobject":t=$(this).data("queryid")}});i={payname:n,type:t,day:$("#queryday>li.active").data("queryday"),key:$("#memberinfo").val(),liushui:$("#serialnumber").val(),date:$("#begindateval").val(),date2:$("#enddateval").val(),storeid:$("#getshopname").val(),isexport:1,product:$("#productinfo").val()};$.getJSON("/intelligent/GetIntelligentReturnSalesList/",i,function(n){if(layer.closeAll(),enabledButtonById("agreereturn"),n!=null)if(n==-2)layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01");else if(n!=0)if(typeof Cef!="undefined")Cef.Download(n);else if(decerpbrowser&&decerpbrowser.versions&&decerpbrowser.versions.android)try{cordova.plugins.barcodeScanner.dwonloadexcel(function(){},function(n){alert("\u6570\u636e\u5bfc\u51fa\u5931\u8d25: "+n)},{myPrintImg:n})}catch(t){alert("\u6570\u636e\u5bfc\u51fa\u5931\u8d25: "+t.message)}else location.href=n;else layer.msg("\u6570\u636e\u5bfc\u51fa\u5931\u8d25!");else layer.msg("\u5bfc\u51fa\u6570\u636e\u4e3a\u7a7a")})});$(document).unbind("click",".sv_remarks").on("click",".sv_remarks",function(){layer.open({content:$(this).data("sv_remarks"),title:null,btn:null,shift:5,shadeClose:!0,area:["420px",""]})});jie=0;$(document).unbind("click",".moreProudct>td:first-child").on("click",".moreProudct>td:first-child",function(){var n=$(this).parent().attr("data-id");$(this).parent().hasClass("open")?($(this).parent().removeClass("open"),$(this).children(".shareproductinfo").show(0),$(this).children(".showtext").hide(0),$('.hideproduct[data-id="'+n+'"]').css("display","none")):($(this).parent().addClass("open"),$(this).children(".shareproductinfo").hide(0),$(this).children(".showtext").show(0),$('.hideproduct[data-id="'+n+'"]').css("display","table-row"))});