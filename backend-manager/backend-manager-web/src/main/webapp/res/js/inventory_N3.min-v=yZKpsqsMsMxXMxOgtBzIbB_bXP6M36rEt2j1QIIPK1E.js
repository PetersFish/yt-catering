$(document).ready(function(){inventory.getProductInventory(1);inventory.operating()});var pageSize=10,thisPageIndex=1,inventory={getProductInventory:function(n){var r=0,u=$("#txtNameSearch").val(),t=-1,i=0;$("#chosen>li.active").each(function(){var u=$(this).data("name"),n=$(this).data("id");switch(u){case"productCategory":r=n;break;case"productStorage":i=n;break;case"displayNoneDate":t=n}});n=thisPageIndex>1?thisPageIndex:1;$.getJSON("/AjaxProduct/GetProductList?producttype_id=0",{status:"0",category:r,storage:i,adddate:"",name:u,pageIndex:n||1,pageSize:pageSize,tianshu:t},function(r){var u=r.list,e,f,o;if(u&&u.length>0){for(e="",f=0;f<u.length;f++)o=u[f].sv_pricing_method==1?u[f].sv_p_total_weight:u[f].sv_p_storage,e+='<tr data-sv_p_storage="'+o+'" data-id="'+u[f].product_id+'" data-pricingmethod="'+u[f].sv_pricing_method+'">',e+="<td>"+(u[f].sv_p_barcode==null?"":u[f].sv_p_barcode)+"<\/td> ",e+='<td class="amountcolor2">'+(u[f].sv_p_name==null?"":u[f].sv_p_name)+'<\/td><td class="minhide">'+(u[f].sv_pc_name==null?"":u[f].sv_pc_name)+"<\/td>",e+='<td class="minhide">'+(u[f].sv_p_unit==null?"":u[f].sv_p_unit)+"<\/td>",e+='<td class="colorff">'+o+"<\/td>",e+="<td>"+new Date(u[f].sv_p_adddate).Format("yyyy-MM-dd")+"<\/td>",e+="<td>"+(u[f].sv_cheprod_datetime==null?"--":new Date(u[f].sv_cheprod_datetime).Format("yyyy-MM-dd"))+"<\/td>",e+="<td>"+(u[f].sv_p_specs==null?"":u[f].sv_p_specs)+"<\/td>",e+='<td class="minhide">\u7ba1\u7406\u5458<\/td>',e+='<td class="inventory">',e+='<a class="confirmQuantity" data-type="0" href="javascript: void(0);">\u6570\u91cf\u786e\u8ba4<\/a>',e+='<a class="confirmQuantity" data-type="1" href="javascript: void(0);">\u6570\u91cf\u8c03\u6574<\/a>',e+='<a class="inventoryRecording" href="javascript: void(0);" data-product_id="'+u[f].product_id+'">\u76d8\u70b9\u8bb0\u5f55<\/a>',e+="<\/td><\/tr>";$("#productInventorylist").html(e);laypage({cont:"pageGro",pages:r.total,curr:n||1,skin:"molv",skip:!0,first:"\u9996\u9875",last:"\u5c3e\u9875",prev:"\u4e0a\u4e00\u9875",next:"\u4e0b\u4e00\u9875",jump:function(n,r){thisPageIndex=n.curr;r||inventory.getProductInventory(n.curr,t,i)}})}else $("#productInventorylist").html('<tr><td class="text-center sad" style="text-align:center !important;" colspan="10"><img src="../skin_N3/images/sad.png" /><i class="padd0">\u6682\u65e0\u91c7\u8d2d\u6570\u636e<\/i><\/td><\/tr>')})},operating:function(){function i(){$.ajax({url:"/ProductCategory/GetFirstCategory?type=0",method:"get",contentType:"text/html",async:!1,success:function(n){if(n.length>0)for(var t in n)$("#productCategory").append('<li class="select" data-id="'+n[t].productcategory_id+'" data-name="productCategory">'+n[t].sv_pc_name+"<\/li>")}})}function r(n){$("#product_id").val(n.product_id);$("#product_name").val(n.product_name);$("#pricing_method").val(n.pricing_method);$("#sv_cheprod_existing").val(n.sv_cheprod_existing)}function t(n){$.post("/supplier/UpdateCheke",{product_id:n.product_id,sv_cheprod_existing:n.sv_cheprod_existing,sv_cheprod_cbem:n.sv_cheprod_cbem,sv_cheprod_operator:"\u7ba1\u7406\u5458",sv_cheprod__noe:n.sv_cheprod__noe,pricing_method:n.pricing_method},function(n){loggin.chklogn(n);n==!0?(layer.closeAll(),layer.msg("\u64cd\u4f5c\u6210\u529f"),inventory.getProductInventory(1)):n==-2?layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650"):layer.msg("\u64cd\u4f5c\u5931\u8d25")})}function u(n){$(".layui-layer-close1").hide();$.getJSON("/supplier/getCheke?logid="+n,function(n){var i,t,r,u;if(n&&n.length>0){for(i="",t=0;t<n.length;t++)r=n[t].sv_pricing_method==1?n[t].sv_weight_cheprod_existing:n[t].sv_cheprod_existing,u=n[t].sv_pricing_method==1?n[t].sv_weight_cheprod_cbem:n[t].sv_cheprod_cbem,i+="<tr><td><span>"+(t+1)+'<\/span><\/td> <td class="text-center"><span class="amountcolor2">'+r+'<\/span><\/td> <td class="text-center"><span class="colorff">'+u+'<\/span><\/td><td class="text-center"><span>'+n[t].sv_cheprod_operator+'<\/span><\/td> <td class="text-center"><span>'+new Date(n[t].sv_cheprod_datetime).Format("yyyy-MM-dd hh:mm:ss")+"<\/span><\/td><\/tr>";$("#productintolist").html(i)}else $("#productintolist").html('<tr><td class="text-center sad" style="" colspan="5"><img src="../skin_N3/images/sad.png" /><i class="padd0">\u6682\u65e0\u76d8\u70b9\u8bb0\u5f55<\/i><\/td><\/tr>')})}i();var n="";$(document).unbind("click","#productCategory>li,#productStorage>li,#displayNoneDate>li").on("click","#productCategory>li,#productStorage>li,#displayNoneDate>li",function(){var i=$(this).hasClass("on"),r=$(this).hasClass("active"),u=$(this).hasClass("cl"),f=$(this).find("input").length,t;i||(r?$(this).data("id")!=-1&&($(this).removeClass("active"),$('#chosen>li[data-name="'+$(this).data("name")+'"').remove(),$("[data-id='0'][data-name='"+$(this).data("name")+"']").addClass("active")):($("#chosen").show(0),$(this).addClass("active").siblings("li").removeClass("active"),f==0&&(u&&(t=$(this).data("id"),readyInfo.secondCategory(t)),$(this).data("name")=="storageFilter"&&($("#minStorage").val(""),$("#maxStorage").val("")),$(this).data("name")=="adddateFilter"&&($("#startDate").val(""),$("#endDate").val("")),$('#chosen>li[data-name="'+$(this).data("name")+'"').remove(),n=$(this).clone(!0),n.appendTo("#chosen"))))});$("#filterOrther_date").keyup(function(){$("#displayNoneDate li").removeClass("active");var n=parseInt($(this).val()||0);n!=""&&n>0?($("#chosen").find("[data-name='displayNoneDate']").remove(),$("#chosen").append('<li class="active" data-id="'+n+'" data-name="displayNoneDate">\u9690\u85cf\u76d8\u70b9\u8ddd\u79bb\u73b0'+n+"\u5929<\/li>")):n==""&&($("#displayNoneDate").find('li[data-id="-1"]').addClass("active"),$("#chosen").find("[data-name='displayNoneDate']").remove(),$("#chosen").append('<li class="active" data-id="-1" data-name="displayNoneDate">\u5168\u90e8<\/li>'))});$(document).on("click","#chosen>li.active",function(){$(this).remove();$("[data-name='"+$(this).data("name")+"']").removeClass("active");$("[data-name='"+$(this).data("name")+"']").eq(0).addClass("active");$("#chosen>li").length==1&&$("#chosen").hide(0)});$("#query_inventory,#txtNameSearchBtn").click(function(){inventory.getProductInventory(1)});$("#txtNameSearch").keypress(function(n){n.keyCode==13&&inventory.getProductInventory(1)});$(document).unbind("click","#productInventorylist .confirmQuantity").on("click","#productInventorylist .confirmQuantity",function(){var f=$(this).data("type"),n=$(this).parent().parent(),i={product_id:n.data("id"),sv_cheprod_existing:n.data("sv_p_storage"),sv_cheprod_cbem:n.data("sv_p_storage"),pricing_method:n.data("pricingmethod"),sv_cheprod__noe:"\u786e\u8ba4\u6570\u91cf",product_name:n.children().eq(1).text()},u;f==0?(u='<div class="determinebox">\u60a8\u5df2\u7ecf\u786e\u5b9a\u4ed3\u5e93\u6570\u636e\u4e00\u81f4\u4e86\u5417?<\/div><footer class="determinebtn-closebtn"><div class="btnbox fr"><button type="button" class="btn btn-success" id="confirmQuantityNumberBtn">\u786e\u5b9a<\/button><button type="button" class="btn btn-default closepage"  onclick="layer.closeAll();">\u53d6\u6d88<\/button><\/div><\/footer>',layer.open({type:1,title:"\u786e\u5b9a\u76d8\u70b9\u6570\u91cf",shade:.6,moveType:1,shift:5,area:["360px","230px"],closeBtn:1,content:u,scrollbar:!1,shadeClose:!0,success:function(){$("#confirmQuantityNumberBtn").delegate("click").click(function(){t(i)})}})):layerpage.Deke_layerpage.getpage2("1","\u4e3a\u300a"+i.product_name+"\u300b\u5546\u54c1\u76d8\u70b9","/ajaxHtml_N3/stock/quantityAdjustment.html?="+getTimeStamp(),["400px","360px"],r,i)});$(document).unbind("click","#determineEditInventoryBtn").on("click","#determineEditInventoryBtn",function(){var n=$("#sv_cheprod_cbem"),i;n.val()?(i={product_id:$("#product_id").val(),sv_cheprod_existing:$("#sv_cheprod_existing").val(),sv_cheprod_cbem:$("#sv_cheprod_cbem").val(),pricing_method:$("#pricing_method").val(),sv_cheprod__noe:$("#sv_cheprod__noe").val()},t(i)):(n.focus(),layer.msg("\u8f93\u5165\u9700\u8981\u4fee\u6539\u7684\u6570\u91cf\uff01"))});$(document).unbind("click","#productInventorylist .inventoryRecording").on("click","#productInventorylist .inventoryRecording",function(){var n=$(this).data("product_id");layerpage.Deke_layerpage.getpage2("1","\u76d8\u70b9\u8bb0\u5f55","/ajaxHtml_N3/stock/inventoryRecording.html?="+getTimeStamp(),["740px","520px"],u,n)});$("#exportsalesreport").click(function(){var n=0,r=$("#txtNameSearch").val(),t=-1,i=0;$("#chosen>li.active").each(function(){var u=$(this).data("name"),r=$(this).data("id");switch(u){case"productCategory":n=r;break;case"productStorage":i=r;break;case"displayNoneDate":t=r}});$.getJSON("/repertory/ExportData",{isZero:i,hideTime:t,key:r,categoryFlag:n},function(n){if(n==-2)layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01");else if(n!=0)if(typeof Cef!="undefined")Cef.Download(n);else if(decerpbrowser&&decerpbrowser.versions&&decerpbrowser.versions.android)try{cordova.plugins.barcodeScanner.dwonloadexcel(function(){},function(n){alert("\u6570\u636e\u5bfc\u51fa\u5931\u8d25: "+n)},{myPrintImg:n})}catch(t){alert("\u6570\u636e\u5bfc\u51fa\u5931\u8d25: "+t.message)}else location.href=n;else layer.msg("\u6570\u636e\u5bfc\u51fa\u5931\u8d25!")})})}};