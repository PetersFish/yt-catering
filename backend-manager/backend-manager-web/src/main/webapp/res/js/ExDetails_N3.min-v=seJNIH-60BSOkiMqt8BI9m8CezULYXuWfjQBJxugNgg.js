var pagesize=5,exDetails,expenditure;$(document).ready(function(){exDetails.shareEventFn();expenditure.shareOperatingFn()});exDetails={shareEventFn:function(){var n=function(){var n=new Date,i=n.getFullYear(),r=n.getMonth()+1,n=n.getDate(),t=i+"-"+r+"-"+n;$("#begindate2").val(t);$("#enddate2").val(t);exDetails.getExpenditureCountFn(t,t)};n();$("#querydate>li").click(function(){$(this).addClass("active").siblings("li").removeClass("active");var t=$(this).data("datetype"),i="",r="";t==1||t==2?$.getJSON("/expenditure/GetDate?type="+t,function(n){$("#begindate2").val(n.date);$("#enddate2").val(n.date2);i=n.date;r=n.date2;exDetails.getExpenditureCountFn(i,r);$(".querydate").css("display","none")}):t==9?$(".querydate").css("display","block"):(n(),$(".querydate").css("display","none"))});$("#otherday").unbind("click").click(function(){var n=$("#begindateval").val(),t=$("#enddateval").val();exDetails.getExpenditureCountFn(n,t)});$(document).on("change","#pagesize",function(){pagesize=$("#pagesize").val();var t=$("#querydate>li.active").data("datetype");t==1||t==2?exDetails.getExpenditureCountFn($("#begindate2").val(),$("#enddate2").val()):t==9?exDetails.getExpenditureCountFn($("#begindateval").val(),$("#enddateval").val()):n()});$("#begindate").datetimepicker({language:"zh",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:2,forceParse:0,endDate:new Date,pickerPosition:"bottom-left",format:"yyyy-mm-dd"}).on("change",function(){var n=$("#begindateval").val();$("#begindateval2").val(n);$("#enddate").datetimepicker("setStartDate",n);$("#begindate").datetimepicker("hide")});$("#enddate").datetimepicker({language:"zh",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:2,forceParse:0,startDate:$("#begindateval").val(),endDate:new Date,pickerPosition:"bottom-left",format:"yyyy-mm-dd"}).on("change",function(){var n=$("#enddateval").val();$("#enddateval2").val(n);$("#begindate").datetimepicker("setReturnDate",n);$("#enddate").datetimepicker("hide")})},getExpenditureCountFn:function(n,t){$.get("/expenditure/GetexpenditureCount/",{date:n,date2:t},function(i){$("#counts").text(i[0]);$("#moery").text("\u00a5 "+parseFloat(i[1]).toFixed(2));var r=Math.ceil(i[0]/pagesize);laypage({cont:$("#layerpage"),pages:r,skip:!0,skin:"molv",first:"\u9996\u9875",last:"\u5c3e\u9875",prev:"\u4e0a\u4e00\u9875",next:"\u4e0b\u4e00\u9875",jump:function(i){pageinxe=i.curr;exDetails.getExpenditureListFn(i.curr,n,t,pagesize);r>1?(addPageSizeFn("#selectpagesize"),$("#pagesize").find("option[value='"+pagesize+"']").attr("selected",!0)):$("#selectpagesize").html("")}})})},getExpenditureListFn:function(n,t,i){$.getJSON("/expenditure/GetexpenditureList/"+n,{date:t,date2:i,pageSize:pagesize},function(n){var t,i,r;if(n!=null&&n.length>0){for(t="",i=0;i<n.length;i++)t+="<tr>",t+="<td>"+n[i].e_expenditurename+"<\/td>",t+='<td class="colorff">\u00a5'+parseFloat(n[i].e_expenditure_money).toFixed(2)+"<\/td>",t+="<td>"+new Date(n[i].e_expendituredate).Format("yyyy-MM-dd hh:mm:ss")+"<\/td>",t+="<td>"+n[i].e_expenditure_operation+"<\/td>",t+="<td>"+n[i].e_expenditure_node+"<\/td>",t+='<td class="operatinglist" style="width: 120px;">',t+='<a class="fl changeExpenditure" href="javascript: void(0);" data-e_expenditureclass="'+n[i].e_expenditureclass+'" data-parentid="'+n[i].parentid+'" data-id="'+n[i].e_expenditureid+'">\u4fee\u6539<\/a>',t+='<a class="fl deleteThis" href="javascript: void(0);" data-id="'+n[i].e_expenditureid+'">\u5220\u9664<\/a>',t+="<\/td>",t+="<\/tr>";$("#expenditureDetailsList").html(t)}else r=$("#rowlength").children("th").length,$("#expenditureDetailsList").html('<tr><td class="text-center sad" style="text-align:center !important;" colspan="'+r+'"><img src="../skin_N3/images/sad.png" /><i class="padd0">\u6682\u65e0\u6570\u636e<\/i><\/td><\/tr>')})}};expenditure={getExpenditureBigClassification:function(n,t,i){$.getJSON("/expenditure/GetCategory?types="+n,function(n){var r;if(n&&n.length>0){expenditureData=n;var u="",f=[],e=[];for(r=0;r<n.length;r++)n[r].ecategorylive==0&&(u+='<option value="'+n[r].ecategoryid+'">'+n[r].ecategoryname+"<\/option>",f.push(n[r].ecategoryid),e.push(n[r].ecategoryname));$("#getExpenditureBigClassification").html(u);$("#getExpenditureBigClassification").find("option[value="+t+"]").prop("selected",!0);expenditure.loopSmallExpenditureFn(expenditureData,t,i)}})},loopSmallExpenditureFn:function(n,t,i){var u="",f=$("#getExpenditureBigClassification").find("option:selected").text(),r;if(n&&n.length>0){for(u+='<li id="editexpenditure" data-id="'+t+'">',u+='<i class="selectclassification"><\/i>',u+='<p class="customize">\u5f55\u5165\u652f\u51fa<\/p>',u+="<\/li>",r=0;r<n.length;r++)n[r].superiorecategoryid==t&&(u+=n[r].ecategoryid==i?'<li class="ex active" data-id="'+n[r].ecategoryid+'" data-name="'+f+"-"+n[r].ecategoryname+'">':'<li class="ex" data-id="'+n[r].ecategoryid+'" data-name="'+f+"-"+n[r].ecategoryname+'">',u+='<i class="selectclassification1"><\/i>',u+='<p class="customize">'+n[r].ecategoryname+"<\/p>",u+="<\/li>");$("#expenditureClassification").html(u)}},shareOperatingFn:function(){function n(n,t,i){var r="",u="";$.getJSON("/expenditure/GetexpenditureNoe/"+n,function(n){for(var f in n)f=="e_expendituredate"?$("#"+f).val(new Date(n[f]).Format("yyyy-MM-dd hh:mm:ss")):f=="e_expenditureid"?(u=n[f],$("#e_expenditureid").val(n[f])):f=="e_expenditureclass"?r=n[f]:$("#"+f).val(n[f]);expenditure.getExpenditureBigClassification("",t,i)})}$("#getExpenditureBigClassification").change(function(){var n=$(this).val();expenditure.loopSmallExpenditureFn(expenditureData,n)});$(document).delegate("#expenditureClassification li.ex","click",function(){$(this).addClass("active").siblings("li.ex").removeClass("active")});$("#selectDate").datetimepicker({language:"zh",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,forceParse:0,endDate:new Date,pickerPosition:"top-left"});$(document).unbind("click","#expenditureDetailsList .changeExpenditure").on("click","#expenditureDetailsList .changeExpenditure",function(){var t=$(this).data("id"),i=$(this).data("parentid"),r=$(this).data("e_expenditureclass");n(t,i,r);$("#changeexpenditure").animate({right:0},400)});$("#changeexpenditure-return").click(function(){$("#changeexpenditure").animate({right:-400},400)});$("#determinesave").click(function(){var t=$("#expenditureClassification li.active").data("name"),i=$("#expenditureClassification li.active").data("id"),n=parseFloat($("#e_expenditure_money").val()||0),u=$("#e_expendituredate").val(),f=$("#e_expenditure_node").val(),r;if(t==null&&i==null){layer.msg("\u8bf7\u9009\u62e9\u652f\u51fa\u5206\u7c7b\uff01");return}if(!n&&n<=0){layer.msg("\u8bf7\u8f93\u5165\u652f\u51fa\u91d1\u989d");$("#e_expenditure_money").focus();return}r={e_expenditurename:t,e_expenditure_money:n,e_expendituredate:u,e_expenditureclass:i,e_expenditureid:$("#e_expenditureid").val(),e_expenditure_node:f};disableButtonById("determinesave");$.post("/expenditure/Ppostexpenditure",r,function(n){n>0?($("#inputtext").find("input").val(""),layer.msg("\u64cd\u4f5c\u6210\u529f\uff01"),enabledButtonById("determinesave"),exDetails.getExpenditureCountFn($("#begindate2").val(),$("#enddate2").val())):n==-2&&(enabledButtonById("determinesave"),layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01"))})});$(document).unbind("click","#expenditureDetailsList .deleteThis").on("click","#expenditureDetailsList .deleteThis",function(){$.post("/expenditure/deleteexpenditureNo/"+$(this).data("id"),function(n){n>0?(layer.msg("\u5220\u9664\u6210\u529f"),exDetails.getExpenditureCountFn($("#begindate2").val(),$("#enddate2").val())):n==-2?layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650"):layer.msg("\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01")})});$(document).unbind("click","#exportreport").on("click","#exportreport",function(){var n=commonOpenLoading();$.getJSON("/expenditure/ExportData",{date:$("#begindate2").val(),date2:$("#enddate2").val()},function(t){if(commonCloseLoading(n),t==-2)layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01");else if(t!=0)if(typeof Cef!="undefined")Cef.Download(t);else if(decerpbrowser&&decerpbrowser.versions&&decerpbrowser.versions.android)try{cordova.plugins.barcodeScanner.dwonloadexcel(function(){},function(n){alert("\u6570\u636e\u5bfc\u51fa\u5931\u8d25: "+n)},{myPrintImg:t})}catch(i){alert("\u6570\u636e\u5bfc\u51fa\u5931\u8d25: "+i.message)}else location.href=t;else layer.msg("\u6570\u636e\u5bfc\u51fa\u5931\u8d25!")})})}};