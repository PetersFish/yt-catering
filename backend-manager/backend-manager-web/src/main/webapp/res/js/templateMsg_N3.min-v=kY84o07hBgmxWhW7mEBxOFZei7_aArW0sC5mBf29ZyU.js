function getWechatTpReceiverList(){$.getAsyncJson("/WeiXin/GetWechatTpReceiverList",null,function(n){var r,u,f,t,e,i;if($("#wechatuserlist").html(""),r="",u=n.dataList,u&&u.length>0){for(f=0;f<u.length;f++){if(t=u[f].permissions,r+='<li class="listbox" id='+u[f].sv_wechat_receiver_id+">",r+='<div class="memberavatar fl">',r+='<img src="'+u[f].sv_headimgurl+'" class="avatarphoto"/>',r+="<\/div>",r+='<div class="memberlistrightbox"><div class="centerbox">',r+='<p class="membername"><span>\u6635\u79f0:<\/span><span>'+u[f].sv_nick_name+"<\/span><\/p>",r+="<p><span>\u7ed1\u5b9a:<\/span><span>"+new Date(u[f].sv_creation_date).Format("yyyy-MM-dd")+"<\/span><\/p>",r+='<p><button class="btn account">\u8425<\/button>',t!=null&&t!="")for(t=JSON.parse(t),e=[],e[2]='<button class="btn" data-sv_permissions_id="@id" data-sv_systpmsg_id="@sv_systpmsg_id" data-sv_wechat_receiver_id="@sv_wechat_receiver_id" data-sv_enabled="@sv_enabled">\u8d26<\/button>',e[3]='<button class="btn" data-sv_permissions_id="@id" data-sv_systpmsg_id="@sv_systpmsg_id" data-sv_wechat_receiver_id="@sv_wechat_receiver_id" data-sv_enabled="@sv_enabled">\u8ba2<\/button>',e[4]='<button class="btn" data-sv_permissions_id="@id" data-sv_systpmsg_id="@sv_systpmsg_id" data-sv_wechat_receiver_id="@sv_wechat_receiver_id" data-sv_enabled="@sv_enabled">\u9000<\/button>',i=0;i<t.length;i++)(t[i].sv_systpmsg_id==2||t[i].sv_systpmsg_id==3||t[i].sv_systpmsg_id==4)&&(t[i].sv_enabled&&t[i].sv_systpmsg_id==2&&(e[2]='<button class="btn camp" data-sv_permissions_id="'+t[i].sv_permissions_id+'" data-sv_systpmsg_id="'+t[i].sv_systpmsg_id+'" data-sv_wechat_receiver_id="'+t[i].sv_wechat_receiver_id+'"data-sv_enabled="'+t[i].sv_enabled+'">\u8d26<\/button>'),t[i].sv_enabled&&t[i].sv_systpmsg_id==3&&(e[3]='<button class="btn set" data-sv_permissions_id="'+t[i].sv_permissions_id+'" data-sv_systpmsg_id="'+t[i].sv_systpmsg_id+'" data-sv_wechat_receiver_id="'+t[i].sv_wechat_receiver_id+'"data-sv_enabled="'+t[i].sv_enabled+'">\u8ba2<\/button>'),t[i].sv_enabled&&t[i].sv_systpmsg_id==4&&(e[4]='<button class="btn retreat" data-sv_permissions_id="'+t[i].sv_permissions_id+'"  data-sv_systpmsg_id="'+t[i].sv_systpmsg_id+'" data-sv_wechat_receiver_id="'+t[i].sv_wechat_receiver_id+'"data-sv_enabled="'+t[i].sv_enabled+'">\u9000<\/button>'),r+=e[t[i].sv_systpmsg_id].replace("@id",t[i].sv_permissions_id).replace("@sv_wechat_receiver_id",t[i].sv_wechat_receiver_id).replace("@sv_systpmsg_id",t[i].sv_systpmsg_id).replace("@sv_enable",t[i].sv_enabled));r+="<\/p>";r+="<\/div><\/div>";r+='<i class="selectgift icon-ok"><\/i><\/li>'}$("#wechatuserlist").append(r)}else $("#wechatuserlist").html('<li style="width: 100%;line-height:110px;text-align:center;"><img src="../skin_N3/images/sad.png" /><i class="padd0">\u6682\u65e0\u7ed1\u5b9a\u6570\u636e<\/i><\/li>')})}function getLoaduserProduct(){$.postAsyncJson("/WeiXin/GenerateBindCode",{systpmsgId:1},function(n){n&&$("#loaduserproduct").attr("src",n)})}$(document).ready(function(){getWechatTpReceiverList()});$(document).unbind("click","button[data-sv_permissions_id]").on("click","button[data-sv_permissions_id]",function(){var n=$(this).attr("data-sv_wechat_receiver_id"),t=$(this).attr("data-sv_systpmsg_id"),i=$(this).attr("data-sv_enabled"),r=$(this).attr("data-sv_permissions_id");return $.postAsyncJson("/WeiXin/SetTpReceiverPermissions",{receiverId:n,systpmsgId:t,enabled:i,psid:r},function(n){n==!0?getWechatTpReceiverList():layer.msg("\u64cd\u4f5c\u5931\u8d25",{icon:1,time:1e3},function(){layer.closeAll()})}),!1});$(document).on("click","#wechatuserlist>li",function(){$(this).toggleClass("active").siblings("li").removeClass("active")});$(document).on("click","#addwechatuser",function(){layerpage.Deke_layerpage.show_Url2("1","\u65b0\u589e\u6d88\u606f\u63a5\u6536\u4eba","/ajaxHtml_N3/wechat/addWechatUser.html?="+getTimeStamp(),["740px","500px"],getLoaduserProduct)});$(document).unbind("click","#binduserwechatbtn").on("click","#binduserwechatbtn",function(){layer.closeAll();getWechatTpReceiverList()});$(document).on("click","#removewechatuser",function(){var n=$("#wechatuserlist li.active").attr("id");$("#wechatuserlist li.active").length==1?$.postAsyncJson("/WeiXin/DeleteTpReceiver",{sendeeId:n},function(n){n==!0?getWechatTpReceiverList():layer.msg("\u64cd\u4f5c\u5931\u8d25",{icon:1,time:1e3},function(){layer.closeAll()})}):layer.msg("\u8bf7\u9009\u62e9\u8981\u5220\u9664\u7684\u6d88\u606f\u7ed1\u5b9a\u4eba\uff0c\u81f3\u591a\u53ea\u80fd\u9009\u62e9\u4e00\u4e2a")});