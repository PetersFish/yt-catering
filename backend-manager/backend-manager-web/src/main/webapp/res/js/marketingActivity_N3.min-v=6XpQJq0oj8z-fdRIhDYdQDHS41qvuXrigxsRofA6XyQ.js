function clearNoNum(n){n.value=parseFloat(n.value||0);n.value=n.value.replace(/[^\d]/g,"");n.value=n.value.replace(/[^\d]/g,"")}function validation(n,t){var r=0,i=n.value,u;return t!=0&&$(".detali_proportionalue_"+t).each(function(){$(this).val()==n.value&&r++;i<$(this).val()&&(i=$(this).val())}),r>=2?(u=$(n).prev().text()=="\u5145:"?"\u5145\u6b21:":$(n).prev().text(),layer.msg("\u540c\u7b49\u7ea7\uff0c"+u+"\u8303\u56f4\u4e0d\u80fd\u51fa\u73b0\u4e00\u6837\u7684\u914d\u7f6e\u503c,\u8bf7\u91cd\u65b0\u8f93\u5165"),n.value=parseFloat(parseFloat(i)+1),!1):void 0}$(document).ready(function(){marketing.getMarketingList();marketing.saveConfigdetailOperate()});var bindingOptions=[],marketing={getMarketingList:function(){function t(){if(bindingOptions!=null&&bindingOptions.length>0)for(var n=0;n<bindingOptions.length;n++)bindingOptions[n].sv_user_givingtype==1?$(".LevelType_"+bindingOptions[n].sv_user_config_id+"_-1").hide():$(".LevelType_"+bindingOptions[n].sv_user_config_id+"_-1").show(),$("#recharge_"+bindingOptions[n].sv_user_config_id+"_"+bindingOptions[n].sv_user_givingtype).prop("checked",!0),$(".LevelType_"+bindingOptions[n].sv_user_config_id+"_"+bindingOptions[n].sv_user_leveltype_id).prop("checked",!0)}var n="";$.getJSON("/UserModuleConfig/GetUserModuleConfigList",{module_code:$("#sv_user_module_code").val()},function(i){var u,r,f,o,s,e,h;if(i!=null&&i!=undefined&&i!="")for(u in i)if(n=i.getUserLevel,u=="sv_user_module_name")$("#"+u).text(i[u]),$(".content").show();else if(u=="sv_user_module_id")$("#"+u).val(i[u]);else if(u=="childInfolist"&&i[u]){for(r="",f=0;f<i[u].length;f++){for(r+='<div class="configcontent" id="configid_ '+i[u][f].sv_user_config_id+'">',r+='<ul class="configcontent-ul">',r+='<li id="recharge_title">',i[u][f].sv_user_config_name.indexOf("\u5145\u503c")>=0&&(r+='<div class="configcontent-title">',r+='<a href="javascript:void(0);">'+i[u][f].sv_user_config_name+"<\/a>",r+="<span>",r+='<label onclick="marketing.chooseTypeOperate(this,'+i[u][f].sv_user_config_id+')" data-name="\u9001\u79ef\u5206" data-val="1" class="chooseType'+i[u][f].sv_user_config_id+'"><input type="radio" class="checkinput" name="selectype_1" id="recharge_1_1" value="" />\u8d60\u9001\u79ef\u5206<\/label>',r+="<\/span>",r+="<span>",r+='<label onclick="marketing.chooseTypeOperate(this,'+i[u][f].sv_user_config_id+')" data-name="\u8d60\u9001" data-val="2" class="chooseType'+i[u][f].sv_user_config_id+'"><input type="radio" class="checkinput" name="selectype_1" id="recharge_1_2" value="" />\u8d60\u9001\u91d1\u989d<\/label>',r+='<i class="tips icon-question-sign tipss" data-content="\u8d60\u9001\u73b0\u91d1\uff1a\u5145\u503c\u6ee1\u4e00\u5b9a\u91d1\u989d\uff0c\u8d60\u9001\u5145\u503c\u91d1\u989d\uff0c \u4f8b\u5982\uff1a\u5145\u503c\u4e00\u6b21\u6ee1100\u5143\uff0c\u8d60\u900110\u5143\uff0c\u5e94\u6536100\u5143\uff0c\u5408\u8ba1\u5145\u503c110\u5143"><\/i>',r+="<\/span><\/div>"),i[u][f].sv_user_config_name.indexOf("\u5145\u6b21")>=0&&(r+='<div class="configcontent-title">',r+='<a href="javascript:void(0);">'+i[u][f].sv_user_config_name+"<\/a>",r+="<span>",r+='<label onclick="marketing.chooseTypeOperate(this,'+i[u][f].sv_user_config_id+')" data-name="\u9001\u6b21" data-val="1" class="chooseType'+i[u][f].sv_user_config_id+'"><input type="radio" class="checkinput" name="selectype_2" id="recharge_2_1" value="" />\u8d60\u9001\u6b21\u6570<\/label>',r+='<i class="tips icon-question-sign tipss" data-content="\u7acb\u51cf\u5145\u6b21\uff1a\u4f1a\u5458\u4e00\u6b21\u6027\u5145\u6b21\u6ee1\u4e00\u5b9a\u6b21\u6570\uff0c\u8d60\u9001\u6b21\u6570\uff0c \u4f8b\u5982\uff1a\u4e00\u6b21\u6027\u5145\u6ee110\u6b21\u51731\u6b21\uff0c\u7d2f\u8ba1\u5145\u6b2111\u6b21\u3002"><\/i>',r+="<\/span>",r+="<span>",r+='<label onclick="marketing.chooseTypeOperate(this,'+i[u][f].sv_user_config_id+')" data-name="\u7acb\u51cf\u73b0\u91d1" data-val="2" class="chooseType'+i[u][f].sv_user_config_id+'"><input type="radio" class="checkinput" name="selectype_2" id="recharge_2_2" value="" />\u7acb\u51cf\u73b0\u91d1<\/label>',r+='<i class="tips icon-question-sign tipss" data-content="\u7acb\u51cf\u73b0\u91d1\uff1a\u4f1a\u5458\u4e00\u6b21\u6027\u5145\u6b21\u6ee1\u4e00\u5b9a\u6b21\u6570\uff0c\u7acb\u5373\u51cf\u91d1\u989d\uff0c \u4f8b\u5982\uff1a20\u5143/\u6b21\uff0c\u5145\u6b21\u6ee110\u6b21\uff08\u5408\u8ba1200\u5143\uff09\uff0c\u7acb\u51cf10\u5143\u3002"><\/i>',r+="<\/span><\/div>"),i[u][f].sv_user_config_name.indexOf("\u6d88\u8d39")>=0&&(r+='<div class="configcontent-title">',r+='<a href="javascript:void(0);">'+i[u][f].sv_user_config_name+"<\/a>",r+="<span>",r+='<label onclick="marketing.chooseTypeOperate(this,'+i[u][f].sv_user_config_id+')" data-name="\u9001\u79ef\u5206" data-val="1" class="chooseType'+i[u][f].sv_user_config_id+'"><input type="radio" class="checkinput" name="selectype_3" id="recharge_3_1" value="" />\u8d60\u9001\u79ef\u5206<\/label>',r+='<i class="tips icon-question-sign tipss" data-content="\u8d60\u9001\u79ef\u5206\uff1a\u53ea\u5bf9\u4f1a\u5458\uff0c\u4e00\u6b21\u6027\u6d88\u8d39\u6ee11000\u5143\uff0c\u900115\u79ef\u5206\uff0c\u4f8b\u5982\uff1a\u5e97\u94fa\u79ef\u5206\u89c4\u5219\u4e3a100\u5143/\u79ef\u5206\uff0c\u4f1a\u5458\u5e94\u5f97\u79ef\u5206\u4e3a15+\uff081000/100\u5143\uff09*1\u79ef\u5206\u3002"><\/i>',r+="<\/span>",r+="<span>",r+='<label onclick="marketing.chooseTypeOperate(this,'+i[u][f].sv_user_config_id+')" data-name="\u7acb\u51cf\u73b0\u91d1" data-val="2" class="chooseType'+i[u][f].sv_user_config_id+'"><input type="radio" class="checkinput" name="selectype_3" id="recharge_3_2" value="" />\u7acb\u51cf\u73b0\u91d1<\/label>',r+='<i class="tips icon-question-sign tipss" data-content="\u7acb\u51cf\u73b0\u91d1\uff1a\u4f1a\u5458\u3001\u6563\u5ba2\u6d88\u8d39\u6ee1\u4e00\u5b9a\u91d1\u989d\uff0c\u7acb\u5373\u51cf\u91d1\u989d\uff0c \u4f8b\u5982\uff1a\u6d88\u8d39\u6ee1100\u5143\uff0c\u7acb\u51cf10\u5143\u3002"><\/i>',r+="<\/span><\/div>"),r+='<\/li><li class="recharge_grade">',r+='<div class="configcontent-title">',o=0;o<n.length;o++)r+="<span>",r+='<label><input data-val="'+n[o].memberlevel_id+'" data-id="'+n[o].memberlevel_id+'" onclick="marketing.levelTypeOperate(this,'+i[u][f].sv_user_config_id+",'"+i[u][f].sv_user_config_name+'\',0)" data-memberlevel_id="'+n[o].memberlevel_id+'" data-name="'+n[o].sv_ml_name+'" type="checkbox" class="checkinput LevelType_'+i[u][f].sv_user_config_id+"_"+n[o].memberlevel_id+'" name="selectype" id="" value="" />'+n[o].sv_ml_name+"<\/label>",r+="<\/span>";if(i[u][f].sv_user_config_name.indexOf("\u6d88\u8d39")>=0&&(r+="<span>",r+='<label><input data-id="-1" data-val="-1" onclick="marketing.levelTypeOperate(this,'+i[u][f].sv_user_config_id+",'"+i[u][f].sv_user_config_name+'\',0)" data-memberlevel_id="-1" data-name="\u6563\u5ba2" type="checkbox" class="checkinput LevelType_3_-1" name="selectype" id="integral" value="" />\u6563\u5ba2<\/label>',r+="<\/span>"),r+="<\/div><\/li>",r+='<li class="pad0">',r+='<ul class="edit-ul" id="configid_append_'+i[u][f].sv_user_config_id+'">',i[u][f].childDetailList!=null&&i[u][f].childDetailList.length>0)for(ChildDetail=i[u][f].childDetailList,$("#is_deleteall").val(ChildDetail.length),s="",e=0;e<ChildDetail.length;e++)h={sv_user_leveltype_id:ChildDetail[e].sv_user_leveltype_id,sv_user_config_id:i[u][f].sv_user_config_id,sv_user_givingtype:ChildDetail[e].sv_user_givingtype},bindingOptions.push(h),r+='<li data-name="'+i[u][f].sv_user_config_name+'" class="configdetailinfo level_'+ChildDetail[e].sv_user_leveltype_id+"_"+ChildDetail[e].sv_user_config_id+'"" data-id='+ChildDetail[e].sv_user_config_id+" data-sv_user_configdetail_id="+ChildDetail[e].sv_user_configdetail_id+">",r+='<div class="fl marketinginfo">',r+='<input type="text" name="sv_user_leveltype_id"  readonly="readonly"  data-sv_user_leveltype_id="'+ChildDetail[e].sv_user_leveltype_id+'" id="sv_user_leveltype_id"  value="'+ChildDetail[e].levelName+'" class="form-control sv_user_leveltype_id_'+ChildDetail[e].sv_user_config_id+"_"+ChildDetail[e].sv_user_leveltype_id+'">',r+=i[u][f].sv_user_config_name.indexOf("\u5145\u6b21")>=0?'<span class="recharge" name="sv_user_configdetail_name" data-sv_user_configdetail_name="'+ChildDetail[e].sv_user_configdetail_name.substr(0,1)+'">'+ChildDetail[e].sv_user_configdetail_name.substr(0,1)+"<\/span>":'<span class="recharge" name="sv_user_configdetail_name" data-sv_user_configdetail_name="'+ChildDetail[e].sv_user_configdetail_name.substr(0,2)+'">'+ChildDetail[e].sv_user_configdetail_name.substr(0,2)+"<\/span>",r+="<input onblur=\"validation(this,'"+ChildDetail[e].sv_user_leveltype_id+"_"+i[u][f].sv_user_config_id+'\')" onkeyup="clearNoNum(this,0)" onafterpaste="clearNoNum(this,0)" type="text" data-id='+ChildDetail[e].sv_user_leveltype_id+' name="sv_detali_proportionalue" value='+ChildDetail[e].sv_detali_proportionalue+' class="form-control proportionalue_'+i[u][f].sv_user_config_id+" detali_proportionalue_"+ChildDetail[e].sv_user_leveltype_id+"_"+i[u][f].sv_user_config_id+'" >',r+=i[u][f].sv_user_config_name.indexOf("\u5145\u6b21")>=0?'<span class="recharge chooseType_'+i[u][f].sv_user_config_id+'" data-sv_user_givingtype='+ChildDetail[e].sv_user_givingtype+'   name="sv_user_givingtype"  class="ChooseType_'+i[u][f].sv_user_config_id+'">'+ChildDetail[e].sv_user_configdetail_name.substr(1,5)+"<\/span>":'<span class="recharge chooseType_'+i[u][f].sv_user_config_id+'" data-sv_user_givingtype='+ChildDetail[e].sv_user_givingtype+'   name="sv_user_givingtype"  class="ChooseType_'+i[u][f].sv_user_config_id+'">'+ChildDetail[e].sv_user_configdetail_name.substr(2,5)+"<\/span>",r+='<input onkeyup="clearNoNum(this,0)" onafterpaste="clearNoNum(this,0)" name="sv_detail_value" value='+ChildDetail[e].sv_detail_value+' type="text" class="form-control">',r+='<select class="form-control selectType_'+i[u][f].sv_user_config_id+'" name="sv_p_commissiontype" style="width: 60px; margin-left:10px;'+(i[u][f].sv_user_config_id==2||ChildDetail[e].sv_user_givingtype!=1?"":"display:none;")+'"> <option value="0" >'+(i[u][f].sv_user_config_name.indexOf("\u5145\u6b21")>=0&&ChildDetail[e].sv_user_givingtype==1?"\u6b21":"\u5143")+'<\/option><option value="1" '+(ChildDetail[e].sv_p_commissiontype==1?"selected":"")+" >%<\/option><\/select>",r+='<button title="\u5220\u9664" class="deletemarking deletemarking-active btn" onclick="marketing.deleteConfigDetailinfo(this,'+ChildDetail[e].sv_user_leveltype_id+","+ChildDetail[e].sv_user_config_id+')"><i class="icon-minus-sign"><\/i><\/button>',s!=ChildDetail[e].sv_user_leveltype_id+ChildDetail[e].sv_user_config_id&&(s=ChildDetail[e].sv_user_leveltype_id+ChildDetail[e].sv_user_config_id,r+='<button title="\u6dfb\u52a0" class="btn deletemarking addmarking" name="add_btn_'+ChildDetail[e].sv_user_leveltype_id+"_"+i[u][f].sv_user_config_id+'" onclick="marketing.levelTypeOperate(\''+ChildDetail[e].sv_user_config_id+"_"+ChildDetail[e].sv_user_leveltype_id+"',"+i[u][f].sv_user_config_id+",'"+i[u][f].sv_user_config_name+'\',2)"><i class="icon-plus-sign"><\/i><\/button>'),r+="<\/div>",r+='<div class="testswitch">',r+=ChildDetail[e].sv_detail_is_enable?'<input class="testswitch-checkbox" checked="checked" data-id="'+ChildDetail[e].sv_user_configdetail_id+'" id="configdetail_id_'+ChildDetail[e].sv_user_configdetail_id+'" type="checkbox">':'<input class="testswitch-checkbox" data-id="'+ChildDetail[e].sv_user_configdetail_id+'" id="configdetail_id_'+ChildDetail[e].sv_user_configdetail_id+'" type="checkbox">',r+='<label class="testswitch-label" data-id="'+ChildDetail[e].sv_user_configdetail_id+'" for="configdetail_id_'+ChildDetail[e].sv_user_configdetail_id+'">',r+='<span class="testswitch-inner" data-on="\u5f00\u542f" data-off="\u5173\u95ed"><\/span>',r+='<span class="testswitch-switch"><\/span>',r+="<\/label><\/div>",r+="<\/li>";r+="<\/ul><\/li>";r+='<li><button type="button" id="sv_user_config_id_'+i[u][f].sv_user_config_id+'" class="btn save">\u4fdd\u5b58<\/button><\/li>';r+="<\/ul><\/div>"}$("#marketingConfigcontent").html(r);t()}});$(document).unbind("click","#marketingConfigcontent .testswitch-label").on("click","#marketingConfigcontent .testswitch-label",function(){var n=$(this).data("id"),t=$("#configdetail_id_"+n).is(":checked");n!=0?$.post("/UserModuleConfig/ConfigdetailOperate",{id:n,valu:!t},function(n){n?layer.msg("\u4fdd\u5b58\u6210\u529f"):layer.msg("\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01")}):layer.msg("\u8bf7\u4fdd\u5b58\u5728\u6267\u884c\u6b64\u64cd\u4f5c")})},levelTypeOperate:function(n,t,i,r){var h,u,c,l;r==2&&(n=$(".LevelType_"+n));var f="",o=0,e="",s=(new Date).Format("yyyyMMddhhmmssS");$(".chooseType"+t).each(function(){var n=$(this).find("input").is(":checked");n&&(f=$(this).data("name"),i.indexOf("\u5145\u6b21")>=0?(e=i.substr(0,1),f=f.indexOf("\u6b21")>=0?"\u6b21"+f:"\u5143"+f):(f="\u5143"+f,e=i.substr(0,2)),o=$(this).data("val"))});isNullOrWhiteSpace(f)?(h=$(n).is(":checked"),h?(u="",u+='<li class="configdetailinfo level_'+$(n).data("val")+"_"+t+'" data-id='+t+' data-sv_user_configdetail_id="0">',u+='<div class="fl marketinginfo">',u+='<input type="text"  readonly="readonly" name="sv_user_leveltype_id"  data-sv_user_leveltype_id="'+$(n).data("val")+'" value="'+$(n).data("name")+'" class="form-control sv_user_leveltype_id_'+t+"_"+$(n).data("val")+'">',u+='<span class="recharge" name="sv_user_configdetail_name" data-sv_user_configdetail_name="'+e+'">'+e+"<\/span>",u+="<input onblur=\"validation(this,'"+$(n).data("val")+"_"+t+'\')" onkeyup="clearNoNum(this)" onafterpaste="clearNoNum(this)" type="text" data-id='+$(n).data("val")+' name="sv_detali_proportionalue"  value="0" class="form-control proportionalue_'+t+" detali_proportionalue_"+$(n).data("val")+"_"+t+'">',u+='<span class="recharge" data-sv_user_givingtype="'+o+'" name="sv_user_givingtype" class="chooseType_'+t+'">'+f+"<\/span>",u+='<input onkeyup="clearNoNum(this,0)" onafterpaste="clearNoNum(this,0)" class="form-control" name="sv_detail_value" value="0" type="text">',u+='<select class="form-control selectType_'+t+'" id="sv_p_commissiontype" name="sv_p_commissiontype" style="width: 60px;margin-left:10px;'+(t==2||o!=1?"":"display:none;")+'"> <option value="0">'+(f.indexOf("\u6b21")>=0?"\u6b21":"\u5143")+'<\/option><option value="1">%<\/option><\/select>',u+='<button title="\u5220\u9664" class="deletemarking deletemarking-active btn" onclick="marketing.deleteConfigDetailinfo(this,'+$(n).data("val")+","+t+')"><i class="icon-minus-sign"><\/i><\/button>',r!=2&&(u+='<button title="\u6dfb\u52a0" class="btn deletemarking addmarking" name="add_btn_'+$(n).data("val")+"_"+t+'" onclick="marketing.levelTypeOperate(\''+t+"_"+$(n).data("val")+"',"+t+",'"+i+'\',2)"><i class="icon-plus-sign"><\/i><\/button>'),u+="<\/div>",u+='<div class="testswitch">',u+='<input class="testswitch-checkbox" checked="checked" data-id="0" id="configdetail_id_'+s+'" type="checkbox">',u+='<label class="testswitch-label" data-id="0" for="configdetail_id_'+s+'">',u+='<span class="testswitch-inner" data-on="\u5f00\u542f" data-off="\u5173\u95ed"><\/span>',u+='<span class="testswitch-switch"><\/span>',u+="<\/label><\/div>",u+="<\/li>",r==2?(c=$(".level_"+$(n).data("val")+"_"+t).length-1,$(".level_"+$(n).data("val")+"_"+t).eq(c).after(u)):$("#configid_append_"+t).append(u)):$(".level_"+$(n).data("val")+"_"+t).remove()):(l=$(n).data("id"),$(n).prop("checked",!1),layer.msg("\u8bf7\u60a8\u9009\u62e9\u60a8\u8981\u8d60\u9001\u7684\u7c7b\u578b\uff01"))},chooseTypeOperate:function(n,t){var f=$(n).is(":checked"),u,r,i;if(!f){if(u=$(n).data("name"),u&&u.indexOf("\u6b21")>=0)for($(".chooseType_"+t).text("\u6b21"+$(n).data("name")),r=$(".selectType_"+t).find("option"),i=0;i<r.length;i++)$(r[i]).val()=="0"&&$(r[i]).text("\u6b21");else for($(".chooseType_"+t).text("\u5143"+$(n).data("name")),r=$(".selectType_"+t).find("option"),i=0;i<r.length;i++)$(r[i]).val()=="0"&&$(r[i]).text("\u5143");u&&u.indexOf("\u9001")>=0&&$(n).data("val")==1?($(".LevelType_"+t+"_-1").hide(),$(".level_-1_"+t).remove(),$(".LevelType_"+t+"_-1").prop("checked",!1),u&&u.indexOf("\u6b21")<0&&$(".selectType_"+t).hide()):($(".LevelType_"+t+"_-1").show(),$(".selectType_"+t).show())}},deleteConfigDetailinfo:function(n,t,i){var r="",u=$('.deletemarking[name="add_btn_'+t+"_"+i+'"]');$(n.nextElementSibling).text().indexOf("\u6dfb\u52a0")>=0&&(r=n.nextElementSibling);$(n).parent().parent().remove();$(".level_"+t+"_"+i).length<=0&&$(".LevelType_"+i+"_"+t).prop("checked",!1);u.length<=0},saveConfigdetailOperate:function(){$(document).unbind("click","#sv_user_config_id_1,#sv_user_config_id_2,#sv_user_config_id_3").on("click","#sv_user_config_id_1,#sv_user_config_id_2,#sv_user_config_id_3",function(){var i=[],n=0,t=0;if($(".configdetailinfo").each(function(){t!=$(this).data("id")&&(t=$(this).data("id"),$(".chooseType"+$(this).data("id")).each(function(){var t=$(this).find("input").is(":checked");t&&(n=$(this).data("val"))}));var r={sv_user_configdetail_id:$(this).data("sv_user_configdetail_id"),sv_user_configdetail_name:$(this).find("span[name=sv_user_configdetail_name]").data("sv_user_configdetail_name")+$(this).find("span[name=sv_user_givingtype]").text(),sv_user_givingtype:n,sv_user_leveltype_id:$(this).find("input[name=sv_user_leveltype_id]").data("sv_user_leveltype_id"),sv_detail_value:$(this).find("input[name=sv_detail_value]").val(),sv_p_commissiontype:n==1&&t!=2?0:$(this).find("select[name=sv_p_commissiontype]").val(),sv_detali_proportionalue:$(this).find("input[name=sv_detali_proportionalue]").val(),sv_user_config_id:$(this).data("id"),sv_user_module_id:$("#sv_user_module_id").val(),sv_detail_is_enable:$(this).find("input.testswitch-checkbox").is(":checked"),sv_remark:$(this).find("input[name=sv_user_leveltype_id]").val()+":"+$(this).find("span[name=sv_user_configdetail_name]").data("sv_user_configdetail_name")+""+$(this).find("input[name=sv_detali_proportionalue]").val()+""+$(this).find("span[name=sv_user_givingtype]").text()+""+$(this).find("input[name=sv_detail_value]").val()};i.push(r)}),n==0&&(n=$("#is_deleteall").val()),n>0)$.ajax({url:"/UserModuleConfig/SaveConfigdetailList?moduleCode="+$("#sv_user_module_code").val()+"&is_deleteall="+$("#is_deleteall").val(),type:"post",contentType:"application/json",data:JSON.stringify(i),async:!1,success:function(n){n==1?(layer.msg("\u4fdd\u5b58\u6210\u529f"),marketing.getMarketingList()):n==-2?layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01"):layer.msg("\u4fdd\u5b58\u5931\u8d25")}});else return layer.msg("\u8bf7\u60a8\u9009\u62e9\u60a8\u8981\u8d60\u9001\u7684\u7c7b\u578b\uff01"),!1})}};