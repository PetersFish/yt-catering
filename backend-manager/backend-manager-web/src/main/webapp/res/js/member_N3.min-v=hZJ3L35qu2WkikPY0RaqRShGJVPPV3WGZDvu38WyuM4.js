function InputValidationClose(){clearTimeout(disableInputvalidationInterval1);clearTimeout(disableInputvalidationInterval2)}function disableInputvalidation(n,t){if(_g_DisableManualInput){t==null&&(t=!0);_g_disableInputobj=n;_g_disableInputautoClose=t;var i="";_g_disableInputobj!=null&&(disableInputvalidationInterval1=setInterval(function(){var t,n;if(i!=$(_g_disableInputobj).val()&&(i=$(_g_disableInputobj).val(),InputValidationarrs[InputValidationarrs.length]=disableInputcount),t=0,InputValidationarrs!=null&&InputValidationarrs.length>=2)if(t=InputValidationarrs[1]-InputValidationarrs[0],t>10)$(_g_disableInputobj).val(""),i="",InputValidationarrs=[];else for(n=1;n<InputValidationarrs.length-1;n++)InputValidationarrs[n+1]-InputValidationarrs[n]+10>t&&InputValidationarrs[n+1]-InputValidationarrs[n]-10<t?_g_disableInputautoClose&&InputValidationClose():($(_g_disableInputobj).val(""),i="",InputValidationarrs=[])},"1"),disableInputvalidationInterval2=setInterval(function(){disableInputcount++},"1"))}}function getAutoId(n,t,i){var e,r,u,f;if(PreferentialTopUpGivingConfigList(t,i),Preferential_TopUpGiving_ConfigList!=null&&Preferential_TopUpGiving_ConfigList.length>0)if((g_memberAutoIdstr==null||g_memberAutoIdstr=="")&&(g_memberAutoIdstr=Preferential_TopUpGiving_ConfigList[0].sv_detail_value),g_memberAutoIdstr==null||g_memberAutoIdstr.trim()=="")$(n).val("000001"),g_memberAutoIdstrOld="000002";else if($(n).val(g_memberAutoIdstr),e=parseInt(g_memberAutoIdstr)+1,g_memberAutoIdstrOld=e.toString(),r=6-g_memberAutoIdstrOld.length,r>0){for(u="",f=1;f<=r;f++)u+="0";g_memberAutoIdstrOld=u+g_memberAutoIdstrOld}}function setAutoIdplusOne(n,t,i){g_memberAutoIdstrOld!=null&&g_memberAutoIdstrOld!=""&&(setMemberidAuto(g_memberAutoIdstrOld,n,t,i),g_memberAutoIdstr=g_memberAutoIdstrOld)}function manualSettingsId(n){var u,t,i,r;if(n=DeleteChar(n),u=parseInt(n)+1,g_memberAutoIdstrOld=u.toString(),t=6-g_memberAutoIdstrOld.length,t>0){for(i="",r=1;r<=t;r++)i+="0";g_memberAutoIdstrOld=i+g_memberAutoIdstrOld}}function setMemberidAuto(n,t,i,r){var o,s,u,f,e,h;n=DeleteChar(n);s=n;PreferentialTopUpGivingConfigList(i,r);Preferential_TopUpGiving_ConfigList!=null&&Preferential_TopUpGiving_ConfigList.length>0&&(u=Preferential_TopUpGiving_ConfigList[0].sv_user_config_id,f=Preferential_TopUpGiving_ConfigList[0].sv_user_module_id,o=Preferential_TopUpGiving_ConfigList[0].sv_user_configdetail_id);sv_user_module_config!=null&&(u=sv_user_module_config.sv_user_config_id,f=sv_user_module_config.sv_user_module_id);e=[];h={sv_user_configdetail_id:o,sv_detail_value:s,sv_user_config_id:u,sv_user_module_id:f,sv_detail_is_enable:!0,sv_user_configdetail_name:t,sv_remark:t};e.push(h);$.postAsyncContentJson("/UserModuleConfig/SaveConfigdetailList?moduleCode=AutomaticallyGenerateMemberId",e,function(n){n&&(n==1||(n==-2?layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01"):layer.msg("\u4fdd\u5b58\u5931\u8d25")))})}function DeleteChar(n){var i="",t;if(n)for(t=0;t<n.length;t++)(n[t]=="0"||n[t]=="1"||n[t]=="2"||n[t]=="3"||n[t]=="4"||n[t]=="5"||n[t]=="6"||n[t]=="7"||n[t]=="8"||n[t]=="9")&&(i+=n[t]);return i}function inspectCommitRepeatedlyGetDeleteId(n){for(var t=0;t<g_SubmitIdList.length;t++)if(n==g_SubmitIdList[t])return g_SubmitIdList[t]="",!0;return!1}function inspectCommitRepeatedlyFindIfItExists(n){for(var t=0;t<g_SubmitIdList.length;t++)if(n==g_SubmitIdList[t])return!0;return g_SubmitIdList[g_SubmitIdList.length]=n,!1}function getEmployessInfoFn(){$.getJSON("/Employee/GetEmployeePageList/",null,function(n){var i,t;if(n!=null&&n.length>0){for(i="",t=0;t<n.length;t++)i+=t%2==0?$("#sv_commissionemployes").val().indexOf(n[t].sv_employee_id)>=0&&$("#sv_mrr_operator").val().indexOf(n[t].sv_employee_name)>=0?'<li class="active" data-employee_id="'+n[t].sv_employee_id+'" data-configtype="'+n[t].sv_configtype+'" data-employee_name="'+n[t].sv_employee_name+'">':'<li data-employee_id="'+n[t].sv_employee_id+'" data-configtype="'+n[t].sv_configtype+'" data-employee_name="'+n[t].sv_employee_name+'">':$("#sv_commissionemployes").val().indexOf(n[t].sv_employee_id)>=0&&$("#sv_mrr_operator").val().indexOf(n[t].sv_employee_name)>=0?'<li class="active" data-employee_id="'+n[t].sv_employee_id+'" data-configtype="'+n[t].sv_configtype+'" data-employee_name="'+n[t].sv_employee_name+'">':'<li data-employee_id="'+n[t].sv_employee_id+'" data-configtype="'+n[t].sv_configtype+'" data-employee_name="'+n[t].sv_employee_name+'">',i+='<div class="imgbox"><img src="/images/001.png"  onerror="javascript:this.src ="/images/001.png";"/><\/div>',i+="<p>"+n[t].sv_employee_name+"<\/p>",i+='<i class="signactive icon-ok-sign"><\/i>';$("#employessHtml").html(i)}})}function calculateGiving(){var f=parseFloat($("#sv_mrr_money").val()||0),n,u,e;$("#storedRemark").text("");var t=0,r=0,i=0,o="";if(configleveldata!=""&&configleveldata.length>0)for(n=0;n<configleveldata.length;n++)configleveldata[n].sv_detail_is_enable&&(u=configleveldata[n].sv_detali_proportionalue,u<=f&&(r=parseInt(configleveldata[n].sv_detail_value),i=configleveldata[n].sv_user_givingtype,t=r,$("#sv_user_givingtype").val(i),$("#sv_detali_proportionalue").val(u),$("#sv_detail_value").val(r),t>0&&(o=layer.tips('"\u6d3b\u52a8\u5145\u503c\u6ee1'+u+"\u5143\u8d60\u9001 "+t+(i==1?"\u79ef\u5206":"\u5143\u50a8\u503c\u73b0\u91d1")+"","#sv_mrr_money",{tips:[1,"#393D49"],time:2e3,shift:-1}))));else $("#sv_user_givingtype").val(0),$("#sv_detali_proportionalue").val(0),$("#sv_detail_value").val(0);t<=0&&r<=0&&i<=0&&($("#sv_user_givingtype").val(0),$("#sv_detali_proportionalue").val(0),$("#sv_detail_value").val(0),$("#sv_mrr_present").val(0));i==2&&$("#sv_mrr_present").val(t);e=$("#sv_mrr_present").val()||0;$("#huoji").text(parseFloat(e)+parseFloat(f))}function getConfigdataBylevel(n){var i,t;if(configleveldata=[],Preferential_TopUpGiving_ConfigList!=null)for(i=Preferential_TopUpGiving_ConfigList,t=0;t<i.length;t++)i[t].sv_user_leveltype_id==n&&configleveldata.push(i[t])}function WriteICCardInfo(n){var r,i,t;if(_g_is_ic_flag&&n)try{if(n){if(_g_is_ic_type==1)return(n=n.length>9?n.length+n:"0"+n.length+n,layer.msg("\u53d1\u5361\u5361\u53f7\uff1a"+n),i=Cef.WriteICCardNoWithPwd(n,_g_is_ic_pwd),t=JSON.parse(i),t)?t.Success||t.Success=="true"||t.Success=="True"?(layer.msg("\u53d1\u5361\u6210\u529f"),!0):(layer.msg("\u53d1\u5361\u5931\u8d25\uff1a"+t.Message),!1):!1;if(_g_is_ic_type==0){if(n=n.length>9?n.length+n:"0"+n.length+n,layer.msg("\u53d1\u5361\u5361\u53f7\uff1a"+n),n.length<32)for(r=0;r<32-n.length;r++)n+="0";return(i=Cef.URFWriteICCardNoWithPwd(n,_g_is_ic_pwd),t=JSON.parse(i),t)?t.Success||t.Success=="true"||t.Success=="True"?(layer.msg("\u53d1\u5361\u6210\u529f"),!0):(layer.msg("\u53d1\u5361\u5931\u8d25\uff1a"+t.Message),!1):!1}}}catch(u){return layer.msg(u.message),!1}else return!0}function membersTemplete(n){location.href=n;var t=typeof Cef;t!=="undefined"&&Cef.Download(n)}function shareRechargeOrTimesFn(n,t,i,r){var e=Is_open_commission==!1?0:1,u,f;r=r||$("#userid").val();n=n||$(".sv_mr_cardno").text();u=typeof receptionPtNum=="undefined"?1:receptionPtNum;f=typeof receptionPtNum=="undefined"?"":receptionPtName;layer.open({type:2,title:"\u4f1a\u5458\u5145\u6b21",shadeClose:!0,shade:.8,area:["80%","90%"],content:"/member/acharge/?x=1#"+n+"@"+t+"@"+i+"@"+e+"@"+r+"@"+u+"@"+f})}function editCrossShopMemberControl(n,t){return _g_user_config.isStore&&_g_user_config.sv_branchrelation<=1&&t!=_g_user_config.user_id?!1:!0}var InputValidationarrs=[],disableInputcount=0,_g_disableInputobj,_g_disableInputautoClose,_g_DisableManualInput=!1,disableInputvalidationInterval1,disableInputvalidationInterval2,chosenHtml;typeof g_DisableManualInput=="undefined"||(_g_DisableManualInput=g_DisableManualInput);typeof g_memberAutoIdstr=="undefined"&&(g_memberAutoIdstr=!1);var pageSize=5,StrEmployeelId="",memberlevel_id="",configleveldata=[],Preferential_TopUpGiving_ConfigList="",getUserdata=null,issupplement_falg=!1,thisUrlNumber=1,member={getStatisticsInfo:function(){$.getJSON("/Ajaxdata/GetUser_Coutnt",function(n){var t,i,r,u,f;if(n)for(t in n)if(t=="usercount")$("#memberCount").html(n[t]),$("#usercount2").text(n[t]),$("#usercount").text(n[t]);else if(t=="mbircount")$("#memberBirthday").html(n[t]),$("#mbircount").text(n[t]);else if(t=="topUser"){if(n.topUser!=null){for(i="",r=0;r<n[t].length;r++)i+='<li class="top-list">',i+='<div class="membertopname fl"><i>'+(r+1)+".<\/i><span>"+n[t][r].sv_mr_name+"<\/span><\/div>",i+='<div class="membertopmoney fr"><span class="money">'+n[t][r].sv_mw_sumamount+'<\/span><i class="pad">\u5143<\/i><\/div>',i+="<\/li>";$("#topList").html(i)}}else if(t=="storelist"){for(f in n.storelist)u+=n.storelist[f];u&&$("#StoreMember").append(u)}else $("#"+t).text(n[t])})},getShareInfo:function(){function n(){$.getJSON("/Salesclerk/PageList/",{page:1,pagesize:100},function(n){var i,t;if(n!=null)for(i='<option value="">\u64cd\u4f5c\u5458<\/option>',t=0;t<n.length;t++)i+=isNullOrWhiteSpace(n[t].sv_employee_name)?'<option value="'+n[t].sp_salesclerkid+'">'+n[t].sv_employee_name+"<\/option>":'<option value=""><\/option>';$("#sellerlist").html(i)})}function t(){$.get("/Ajaxdata/GetUserconfig",function(n){var i,r,u,t;if(n!=null){if(n.GetUserLevel||(n.GetUserLevel=n.getUserLevel),n.GetMembergroup||(n.GetMembergroup=n.getMembergroup),n.GetSv_membertag||(n.GetSv_membertag=n.getSv_membertag),i='<li class="on">\u4f1a\u5458\u7b49\u7ea7<\/li><li class="active" data-id="0" data-name="filtermembergrade">\u5168\u90e8<\/li>',n.GetUserLevel!=undefined){for(t=0;t<n.GetUserLevel.length;t++)i+='<li data-id="'+n.GetUserLevel[t].memberlevel_id+'" data-name="filtermembergrade">'+n.GetUserLevel[t].sv_ml_name+"<\/li>";$("#filtermembergrade").html(i)}if(r='<li class="on">\u4f1a\u5458\u5206\u7ec4<\/li><li class="active" data-id="0" data-name="filtermembergrouping">\u5168\u90e8<\/li>',n.GetMembergroup!=undefined){for(t=0;t<n.GetMembergroup.length;t++)r+='<li data-id="'+n.GetMembergroup[t].membergroup_id+'"  data-name="filtermembergrouping">'+n.GetMembergroup[t].sv_mg_name+"<\/li>",$("#filtermembergrouping2").append('<li data-operatingType="3" data-id="'+n.GetMembergroup[t].membergroup_id+'"  data-name="filtermembergrouping">'+n.GetMembergroup[t].sv_mg_name+"<\/li>");$("#filtermembergrouping").html(r)}if(u='<li class="on">\u4f1a\u5458\u6807\u7b7e<\/li><li class="active" data-id="0" data-name="filtermemberlabel">\u5168\u90e8<\/li>',n.GetSv_membertag!=undefined){for(t=0;t<n.GetSv_membertag.length;t++)u+='<li data-id="'+n.GetSv_membertag[t].membertag_id+'" data-name="filtermemberlabel">'+n.GetSv_membertag[t].sv_mt_name+"<\/li>",$("#filtermemberlabel2").append('<li data-operatingType="2" data-id="'+n.GetSv_membertag[t].membertag_id+'" data-name="filtermemberlabel">'+n.GetSv_membertag[t].sv_mt_name+"<\/li>");$("#filtermemberlabel").html(u)}}})}n();t()},getMemberListPage:function(n,t,i){var r=0,u=0,f=0,e="",o="",s="",c,l,a,h,v,y;$("#chosen li.active").each(function(){switch($(this).data("name")){case"filtermembergrade":$(this).data("id")==0?o="":r=$(this).data("id");break;case"filtermembergrouping":$(this).data("id")==0?s="":u=$(this).data("id");break;case"filtermemberlabel":e+=$(this).data("id")+",";break;case"filtermemberlost":f=$(this).data("id")}});thisUrlNumber>1?(c=$("#memberlist .deleteThisMember.active").length,l=$(".selectcheckbox[name='memberchecked']").length,i=l-c>0?thisUrlNumber:thisUrlNumber-1,member.getMemberList(i,r,u,f,n,e,t,o,s)):member.getMemberList(1,r,u,f,n,e,t,o,s);a=openLoadingIng();h="";_g_user_config.isStore?h=$("#StoreMember").val()||user_id:(v=_g_user_config.user_id,y=$("#StoreMember").val(),h=y!=v?$("#StoreMember").val()||user_id:"");$.get("/ajaxdata/GetUserListCount/",{dengji:r,fenzhu:u,liusi:f,key:n||$("#indexquery_like").val(),biaoqian:e,memberBirthday:t,levelname:o,groupname:s,store:h,creator:$("#sellerlist").val(),reg_source:$("#sv_reg_source").val(),reg_start_date:$("#startDate").val(),reg_end_date:$("#endDate").val()},function(h){commonCloseLoading(a);$("#page_member_row_count").html(h);var c=Math.ceil(h/pageSize);laypage({cont:$("#pageGro"),pages:c,skin:"molv",curr:i||1,first:"\u9996\u9875",last:"\u5c3e\u9875",prev:!1,next:!1,jump:function(i,h){h||(thisUrlNumber=i.curr,member.getMemberList(i.curr,r,u,f,n,e,t,o,s));c>1?(addPageSizeFn("#selectpagesize"),$("#pagesize").find("option[value='"+pageSize+"']").attr("selected",!0)):$("#selectpagesize").html("")}})})},getMemberList:function(n,t,i,r,u,f,e,o,s){var h="",c,l;_g_user_config.isStore?h=$("#StoreMember").val()||user_id:(c=_g_user_config.user_id,l=$("#StoreMember").val(),h=l!=c?$("#StoreMember").val()||user_id:"");$.get("/ajaxdata/GetUserList/"+n,{dengji:t,fenzhu:i,liusi:r,key:u||$("#indexquery_like").val(),biaoqian:f,memberBirthday:e,levelname:o,groupname:s,store:h,creator:$("#sellerlist").val(),reg_source:$("#sv_reg_source").val(),reg_start_date:$("#startDate").val(),reg_end_date:$("#endDate").val(),pageSize:pageSize},function(n){var i,r,t,f,u,e,o;if(n&&n.length>0){for(i="",r="",t=0;t<n.length;t++){if(i+='<tr  data-id="'+n[t].member_id+'">',i+="<td>",i+='<input type="checkbox" class="checkinput selectcheckbox" data-user_id="'+n[t].user_id+'" id="'+n[t].sv_mr_status+'" value="'+n[t].member_id+'" name="memberchecked">',i+="<\/td>",i+=n[t].isOverdue?'<td class="amountcolor2">'+n[t].sv_mr_cardno+'<i class="colorff pad">(\u5df2\u8fc7\u671f)<\/i><\/td>':n[t].sv_mr_status==1?'<td class="amountcolor2">'+n[t].sv_mr_cardno+'<i class="colorff pad">(\u5df2\u6302\u5931)<\/i><\/td>':'<td class="amountcolor2">'+n[t].sv_mr_cardno+"<\/td>",i+=isNullOrWhiteSpace(n[t].sv_mr_nick)?'<td class="memberdetailedinfo" data-user_id="'+n[t].user_id+'" data-member_id="'+n[t].member_id+'">'+n[t].sv_mr_name+"("+n[t].sv_mr_nick+")<\/td>":'<td class="memberdetailedinfo" data-user_id="'+n[t].user_id+'" data-member_id="'+n[t].member_id+'">'+n[t].sv_mr_name+"<\/td>",i+='<td class="memberlabelbox minhide">',i+='<div class="memberlabellist">',n[t].membertag)for(f=JSON.parse(n[t].membertag),u=0;u<f.length;u++)i+='<i class="crice" style="background-color:'+f[u].clord+';"><\/i>',i+='<div class="fl showbox"  style="background-color:'+f[u].clord+';">',i+='<img src="/images/tag-cover.png" class="">',i+='<span class="tagInfo">'+f[u].name+"<\/span>",i+='<img src="/images/tag-delete.png" height="12" class="del-tags"  data-uid="'+n[t].member_id+'"  data-id="'+f[u].tab+'" data-userid="'+n[t].user_id+'">',i+="<\/div>";i+="<\/div>";i+="<\/td>";i+="<td>"+n[t].sv_mr_mobile+"<\/td>";i+=isNullOrWhiteSpace(n[t].sv_mg_name)?'<td class="minhide">'+n[t].sv_mg_name+"<\/td>":'<td class="minhide"><\/td>';i+=isNullOrWhiteSpace(n[t].sv_ml_name)?"<td>"+n[t].sv_ml_name+"<\/td>":"<td><\/td>";i+="<td>"+n[t].sv_mw_availablepoint+"<\/td>";i+='<td><i class="colorff">\u00a5'+parseFloat(n[t].sv_mw_availableamount).toFixed(2)+"<\/i><\/td>";i+=isNullOrWhiteSpace(n[t].sv_mr_address)?'<td class="minhide">'+n[t].sv_mr_address+"<\/td>":'<td class="minhide"><\/td>';i+="<td>"+n[t].userName+"<\/td>";e=n[t].sv_registration==1?"\u5fae\u4fe1":"\u7ebf\u4e0b";i+="<td>"+e+"<\/td>";n[t].sv_mr_status==1?i+="<td><\/td>":(i+='<td class="operatinglist">',i+='<a data-id="'+n[t].member_id+'" data-sv_mr_status="'+n[t].sv_mr_status+'" class="fl editThisMember" href="javascript: void(0);">\u4fee\u6539<\/a>',i+='<a data-id="'+n[t].member_id+'" data-sv_mr_status="'+n[t].sv_mr_status+'" class="fl deleteThisMember" href="javascript: void(0);">\u5220\u9664<\/a>',i+="<\/td>");i+="<\/tr>";r+='<li class="listbox" data-user_id="'+n[t].user_id+'" id="'+n[t].sv_mr_status+'" data-member_id="'+n[t].member_id+'">';r+='<div class="memberavatar fl">';r+='<img src="'+(n[t].sv_mr_headimg==null||n[t].sv_mr_headimg==""?"":_g_res_images_url+n[t].sv_mr_headimg)+'"  onerror="this.src=\'/images/001.png\';" class="avatarphoto memberdetailedinfo"/>';r+="<\/div>";r+='<div class="memberlistrightbox"><div class="centerbox">';r+='<p class="membername"><span>\u4f1a\u5458:<\/span><span>'+n[t].sv_mr_name+"<\/span><\/p>";r+=isNullOrWhiteSpace(n[t].sv_ml_name)?"<p><span>\u7b49\u7ea7:<\/span><span><\/span><\/p>":"<p><span>\u7b49\u7ea7:<\/span><span>"+n[t].sv_ml_name+"<\/span><\/p>";r+='<p><span>\u4f59\u989d:<\/span><span class="membermoney">\u00a5'+n[t].sv_mw_availableamount+"<\/span><\/p>";r+="<p><span>\u751f\u65e5:<\/span><span>"+new Date(n[t].sv_mr_birthday).Format("MM-dd")+"<\/span><\/p>";r+="<\/div><\/div>";r+='<i class="selectgift icon-ok"><\/i><\/li>'}$("#memberlist").html(i);$("#memberlist2").html(r);$(".memberlabellist").hover(function(){$(this).find(".showbox").fadeIn(0).siblings(".crice").fadeOut(0)},function(){$(this).find(".crice").fadeIn(0).siblings(".showbox").fadeOut(0)})}else o=$("#rowlength").children("th").length,$("#memberlist").html('<tr><td class="text-center sad" style="text-align:center !important" colspan="'+o+'"><img src="../skin_N3/images/sad.png" /><i class="padd0">\u6682\u65e0\u6570\u636e<\/i><\/td><\/tr>'),$("#memberlist2").html('<li style="width:100%;line-height:100px;" class="text-center"><img src="../skin_N3/images/sad.png" /><i class="padd0">\u6682\u65e0\u6570\u636e<\/i><\/li>')})},shareOperating:function(){function n(n){$.post("/ajaxdata/Update_dan",{type:n.type,name:n.name,id:n.id,color:n.color,u_id:n.u_id,userid:n.userid},function(n){loggin.chklogn(n);n==!0?(layer.msg("\u8bbe\u7f6e\u6210\u529f"),member.getMemberListPage()):n==-2?layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01"):layer.msg("\u8bbe\u7f6e\u5931\u8d25")})}function t(){var n=$("#memberlist").find('.checkinput[name="memberchecked"]:checked').val(),t={name:"sv_mr_status",value:parseInt($("#the_lossvalue").val())};$.ajax({url:"/Ajaxdata/updateUser_Noe?id="+n+"&userid="+$("#userid").val(),data:JSON.stringify(t),type:"POST",contentType:"application/json",success:function(n){loggin.chklogn(n);n==!0?(layer.closeAll(),member.getMemberListPage(),layer.msg("\u64cd\u4f5c\u6210\u529f\uff01")):n==-2?(layer.closeAll(),layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01")):n==-3?layer.msg("\u5f53\u524d\u4f1a\u5458\u4e0d\u652f\u6301\u8de8\u5e97\u64cd\u4f5c"):(layer.closeAll(),layer.msg("\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5"))}})}$(document).unbind("click","#filtermemberlabel2 li,#filtermembergrouping2 li").on("click","#filtermemberlabel2 li,#filtermembergrouping2 li",function(){var f=$("#memberlist").find('.checkinput[name="memberchecked"]:checked'),e=$("#memberlist2>li.active"),t="",i=$(this).text(),r=$(this).data("id"),u=$(this).attr("data-operatingType");$(".memberlistactive:eq(0)").css("display")=="block"?f.length==1?(t={type:u,name:i,id:r,color:"",u_id:$("#memberlist").find('.checkinput[name="memberchecked"]:checked').val(),userid:$("#memberlist").find('.checkinput[name="memberchecked"]:checked').data("user_id")},t!=null&&t!=undefined&&t!=""?n(t):layer.msg("\u8bf7\u5237\u65b0\u9875\u9762\u5728\u6267\u884c\u64cd\u4f5c\uff01")):layer.msg("\u6700\u591a\u53ea\u80fd\u9009\u62e91\u4e2a\u4f1a\u5458\u5728\u6267\u884c\u64cd\u4f5c"):e.length==1?t={type:u,name:i,id:r,color:"",u_id:$("#memberlist2>li.active").data("member_id"),userid:$("#memberlist2>li.active").data("user_id")}:layer.msg("\u6700\u591a\u53ea\u80fd\u9009\u62e91\u4e2a\u4f1a\u5458\u5728\u6267\u884c\u64cd\u4f5c")});$(document).unbind("click","#memberlist .del-tags").on("click","#memberlist .del-tags",function(){$.post("/ajaxdata/Update_dan",{type:1,name:$(this).text(),id:$(this).data("id"),color:"",u_id:$(this).data("uid"),userid:$(this).data("userid")},function(n){loggin.chklogn(n);n==!0?(layer.msg("\u4f1a\u5458\u6807\u7b7e\u8bbe\u7f6e\u6210\u529f"),member.getMemberListPage()):n==-2?layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01"):layer.msg("\u4f1a\u5458\u6807\u7b7e\u8bbe\u7f6e\u5931\u8d25")})});$("#reportedLossbox .reportedLoss").click(function(){var r=$("#memberlist").find('.checkinput[name="memberchecked"]:checked'),t=$("#memberlist").find('.checkinput[name="memberchecked"]:checked').attr("id"),u,n,i;if(!editCrossShopMemberControl(r.parent().parent().find(".memberdetailedinfo").data("member_id"),r.parent().parent().find(".memberdetailedinfo").data("user_id"))){layer.msg("\u7981\u6b62\u8de8\u5e97\u64cd\u4f5c");return}u=$(this).text();n=$(this).attr("data-type");r.length==1?t!=1&&n==0?($("#the_lossvalue").val(1),i='<div class="determinebox">\u60a8\u786e\u5b9a\u8981'+u+'\u8be5\u4f1a\u5458\u5417?<\/div><footer class="determinebtn-closebtn"><div class="btnbox fr"><button type="button" class="btn btn-success" id="reportedLossBtn">\u786e\u5b9a<\/button><button type="button" class="btn btn-default closepage">\u53d6\u6d88<\/button><\/div><\/footer>',shareOpenSmallPageFn(1," ",null,i,null)):t==1&&n==1?($("#the_lossvalue").val(0),i='<div class="determinebox">\u60a8\u786e\u5b9a\u8981'+u+'\u8be5\u4f1a\u5458\u5417?<\/div><footer class="determinebtn-closebtn"><div class="btnbox fr"><button type="button" class="btn btn-success" id="reportedLossBtn">\u786e\u5b9a<\/button><button type="button" class="btn btn-default closepage">\u53d6\u6d88<\/button><\/div><\/footer>',shareOpenSmallPageFn(1," ",null,i,null)):t==1&&n==0?($("#the_lossvalue").val(""),layer.msg("\u8be5\u4f1a\u5458\u5df2\u7ecf\u6302\u5931\uff0c\u4e0d\u80fd\u91cd\u590d\u6302\u5931\u64cd\u4f5c")):t==0&&n==1&&layer.msg("\u8bf7\u5148\u6302\u5931\u5728\u8fdb\u884c\u53d6\u6d88\u6302\u5931\u64cd\u4f5c"):layer.msg("\u8bf7\u5148\u62e9\u60a8\u8981\u6302\u5931\u7684\u4f1a\u5458\uff0c\u53ea\u80fd\u9009\u62e91\u4e2a\uff01")});$(document).unbind("click","#reportedLossBtn").on("click","#reportedLossBtn",function(){$("#the_lossvalue").val()&&t()});$("#resetPassword").click(function(){var n=$("#memberlist").find('.checkinput[name="memberchecked"]:checked'),t=$("#memberlist").find('.checkinput[name="memberchecked"]:checked').val(),i;if(!editCrossShopMemberControl(t,n.parent().parent().find(".memberdetailedinfo").data("user_id"))){layer.msg("\u7981\u6b62\u8de8\u5e97\u64cd\u4f5c");return}i={name:"sv_mr_pwd",value:""};n.length==1?$.ajax({url:"/Ajaxdata/updateUser_Noe?id="+t+"&userid="+$("#userid").val(),data:JSON.stringify(i),type:"POST",contentType:"application/json",success:function(n){loggin.chklogn(n);n==!0?layer.msg("\u64cd\u4f5c\u6210\u529f\uff01"):n==-2?layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01"):n==-3?layer.msg("\u5f53\u524d\u4f1a\u5458\u4e0d\u652f\u6301\u8de8\u5e97\u64cd\u4f5c"):layer.msg("\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5")}}):layer.msg("\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u9009\u62e9\u4f1a\u5458\u5728\u6267\u884c\u64cd\u4f5c\uff0c\u6700\u591a\u9009\u62e9\u4e00\u4e2a\u4f1a\u5458")});$("#changepassword").click(function(){var n=$("#memberlist").find('.checkinput[name="memberchecked"]:checked'),t;if(!editCrossShopMemberControl(n.val(),n.parent().parent().find(".memberdetailedinfo").data("user_id"))){layer.msg("\u7981\u6b62\u8de8\u5e97\u64cd\u4f5c");return}n.length==1?(t='<div class="changepassword"><ul><li><span class="col-xs-3">\u539f\u5bc6\u7801<\/span><input type="password" class="col-xs-9" placeholder="\u8f93\u5165\u539f\u5bc6\u7801" name="oldPassword" id="oldPassword"><\/li><li><span class="col-xs-3">\u65b0\u5bc6\u7801<\/span><input type="password" class="col-xs-9" placeholder="\u8f93\u5165\u65b0\u5bc6\u7801" name="newPassword" id="newPassword"><\/li><li><span class="col-xs-3">\u786e\u8ba4\u5bc6\u7801<\/span><input id="confirmPassword" name="confirmPassword" type="password" class="col-xs-9" placeholder="\u8f93\u5165\u65b0\u5bc6\u7801"><\/li><\/ul><\/div><footer class="determinebtn-closebtn"><div class="btnbox fr"><button type="button" class="btn btn-success" id="btnSaveChangePwd">\u786e\u5b9a<\/button><button type="button" class="btn btn-default closepage">\u53d6\u6d88<\/button><\/div><\/footer>',shareOpenSmallPageFn("1"," ",["430px","280px"],t)):layer.msg("\u8bf7\u5148\u62e9\u60a8\u8981\u4fee\u6539\u5bc6\u7801\u7684\u4f1a\u5458\uff0c\u6700\u591a\u53ea\u80fd\u9009\u62e91\u4e2a\u4f1a\u5458\uff01")});$(document).unbind("click","#btnSaveChangePwd").on("click","#btnSaveChangePwd",function(){var r=$("#memberlist").find('.checkinput[name="memberchecked"]:checked').val(),t=$("#oldPassword").val()||"",n=$("#newPassword").val(),i=$("#confirmPassword").val();isNullOrWhiteSpace(n)?n==t?(layer.msg("\u65b0\u5bc6\u7801\u4e0d\u80fd\u548c\u65e7\u5bc6\u7801\u76f8\u540c\uff01"),$("#newPassword").focus()):isNullOrWhiteSpace(i)?n!=i?(layer.msg("\u4e24\u6b21\u8f93\u5165\u7684\u65b0\u5bc6\u7801\u4e0d\u4e00\u81f4\uff01"),$("#confirmPassword").focus()):$.post("/Ajaxdata/updateUserPassword",{oldPassword:t,newPassword:n,userid:$("#userid").val(),menberid:r},function(n){n==1?(layer.closeAll(),layer.msg("\u5bc6\u7801\u4fee\u6539\u6210\u529f\uff01")):n==-5?($("#oldPassword").focus(),layer.msg("\u539f\u5bc6\u7801\u8f93\u5165\u9519\u8bef\uff01")):n==-3?(layer.closeAll(),layer.msg("\u5f53\u524d\u4f1a\u5458\u4e0d\u652f\u6301\u8de8\u5e97\u64cd\u4f5c")):n==-2?(layer.closeAll(),layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01")):(layer.closeAll(),layer.msg("\u5bc6\u7801\u4fee\u6539\u5931\u8d25,\u8bf7\u5237\u65b0\u540e\u518d\u91cd\u8bd5\uff01"))}):(layer.msg("\u786e\u8ba4\u65b0\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a"),$("#confirmPassword").focus()):(layer.msg("\u65b0\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff01"),$("#newPassword").focus())});$(document).unbind("click","#memberlist .deleteThisMember").on("click","#memberlist .deleteThisMember",function(){var t=$(this).data("sv_mr_status"),n=$(this).data("id");if($("#memberlist .deleteThisMember").removeClass("active"),!editCrossShopMemberControl(n,$(this).parent().parent().find(".memberdetailedinfo").data("user_id"))){layer.msg("\u7981\u6b62\u8de8\u5e97\u5220\u9664");return}$(this).addClass("active");t!=1?layer.confirm("\u60a8\u786e\u8ba4\u8981\u5220\u9664\u8be5\u4f1a\u5458\u5417\uff1f",{btn:["\u786e\u8ba4\u5220\u9664","\u5173\u95ed"]},function(){$.post("/ajaxdata/DeleteUserl?id="+n+"&userid="+$("#userid").val(),function(n){loggin.chklogn(n);n==!0?(layer.msg("\u5220\u9664\u4f1a\u5458\u6210\u529f"),member.getStatisticsInfo(),member.getMemberListPage()):n==-2?layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01"):n==-3?layer.msg("\u5f53\u524d\u4f1a\u5458\u4e0d\u652f\u6301\u8de8\u5e97\u64cd\u4f5c\uff01"):layer.msg("\u5220\u9664\u4f1a\u5458\u5931\u8d25")})}):layer.msg("\u8be5\u4f1a\u5458\u5df2\u6302\u5931\uff0c\u4e0d\u80fd\u8fdb\u884c\u5220\u9664\u64cd\u4f5c\uff01")})},addNewMemberClick:function(){function f(){moduleConfigList&&PreferentialTopUpGivingConfigList("Preferential","TopUpGiving");r();Is_open_commission||$(".CommissionOperator").hide();n("");selectBirthdayOrOrtherTime("sv_mr_birthday");selectexpirationdateTime("sv_mr_deadline");selectDateReminderTime("dateReminder");$("#sv_mr_birthday").val(nowDateTime())}function r(){var n,i;if(t=="")$.get("/Ajaxdata/GetUserconfig",function(n){var i;if(n!=null){if(t=n,$("#sv_mr_nick,#memberlevel_id,#membergroup_id").empty(),n.GetUserLevel||(n.GetUserLevel=n.getUserLevel),n.GetMembergroup||(n.GetMembergroup=n.getMembergroup),n.sv_uc_callnameList!=undefined)for(i=0;i<n.sv_uc_callnameList.length;i++)$("#sv_mr_nick").append("<option value='"+n.sv_uc_callnameList[i]+"'>"+n.sv_uc_callnameList[i]+"<\/option>");if(n.GetUserLevel!=undefined)for(i=0;i<n.GetUserLevel.length;i++)$("#memberlevel_id").append("<option value='"+n.GetUserLevel[i].memberlevel_id+"'>"+n.GetUserLevel[i].sv_ml_name+"<\/option>");if(n.GetMembergroup)for(i=0;i<n.GetMembergroup.length;i++)$("#membergroup_id").append("<option value='"+n.GetMembergroup[i].membergroup_id+"'>"+n.GetMembergroup[i].sv_mg_name+"<\/option>")}});else{if(n=t,$("#sv_mr_nick,#memberlevel_id,#membergroup_id").empty(),n.GetUserLevel||(n.GetUserLevel=n.getUserLevel),n.GetMembergroup||(n.GetMembergroup=n.getMembergroup),n.sv_uc_callnameList!=undefined)for(i=0;i<n.sv_uc_callnameList.length;i++)$("#sv_mr_nick").append("<option value='"+n.sv_uc_callnameList[i]+"'>"+n.sv_uc_callnameList[i]+"<\/option>");if(n.GetUserLevel)for(i=0;i<n.GetUserLevel.length;i++)$("#memberlevel_id").append("<option value='"+n.GetUserLevel[i].memberlevel_id+"'>"+n.GetUserLevel[i].sv_ml_name+"<\/option>");if(n.GetMembergroup)for(i=0;i<n.GetMembergroup.length;i++)$("#membergroup_id").append("<option value='"+n.GetMembergroup[i].membergroup_id+"'>"+n.GetMembergroup[i].sv_mg_name+"<\/option>")}}function e(){i();$("#recoveryCommonItems").click(function(){i()});$(document).on("click","#commonItemsHtml li",function(){$(this).children().children("span").length==0&&$(this).children("a").append("<span data-id='"+$(this).data("id")+"' class='icon-remove deletememberproject'><\/span>");$("#notCommonItemsHtml").append($(this));setTimeout(function(){$(this).remove()},200)});$(document).on("click","#notCommonItemsHtml li",function(){$(this).children("a").children("span").remove();$("#commonItemsHtml").append($(this));setTimeout(function(){$(this).remove()},200)});$("#saveCommonItems").click(function(){var i=$("#commonItemsHtml li"),t="";i.length==1?t=$("#commonItemsHtml li").data("id"):i.length>1&&($("#commonItemsHtml li").each(function(){t+=$(this).data("id")+","}),t=t.substring(0,t.length-1));$.postAsyncJson("/Ajaxdata/SaveCommonItems",{ids:t},function(t){t==!0?(n(""),layer.close($("#layerCloseIndex").val()),layer.msg("\u4fdd\u5b58\u8bbe\u7f6e\u6210\u529f\uff01")):t==-1?layer.msg("\u60a8\u5f53\u524d\u8fd8\u672a\u6dfb\u52a0\u81ea\u5b9a\u4e49\u5b57\u6bb5\uff01"):layer.msg("\u4fdd\u5b58\u8bbe\u7f6e\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01")})})}function i(){$("#commonItemsHtml").empty();$("#notCommonItemsHtml").empty();var n="",t="";$.get("/Ajaxdata/GetMemberCustomList",null,function(i){if(i!=null&&i!=""){for(var r=0;r<i.length;r++)i[r].sv_enabled==!0?n+=' <li class="active" id="'+i[r].sv_field_id+'"  data-id="'+i[r].sv_field_id+'"><a href="javascript:void(0);">'+i[r].sv_field_name+"<\/a><\/li>":t+='<li data-id="'+i[r].sv_field_id+'"><a href="javascript:void(0);">'+i[r].sv_field_name+'<span data-id="'+i[r].sv_field_id+'" class="icon-remove deletememberproject"><\/span><\/a> <\/li>';$("#commonItemsHtml").html(n);$("#notCommonItemsHtml").html(t)}})}function n(n){$("#customFieldHtml").empty();$.ajax({url:"/Ajaxdata/GetMemberCustomInfo",type:"get",dataType:"json",async:!1,cache:!0,data:{memberId:n}}).success(function(n){var i,t,u,r;if(n!=null&&n.length>0){for(i="",t=0;t<n.length;t++)u=n[t].sv_field_value!=null&&n[t].sv_field_value!=""?n[t].sv_field_value:"",i+=" <li>",i+=n[t].sv_field_name.length>=4?'<label class="labelinfo">'+n[t].sv_field_name+"<\/label>":'<label class="labelinfo">'+n[t].sv_field_name+strPlaceholder(4-n[t].sv_field_name.length)+"<\/label>",n[t].sv_is_remind_time?(r="",n[t].sv_field_value&&(r=n[t].sv_field_value),i+='<input note="'+n[t].sv_remark+'" class="form-control width70 dateReminder"  data-relationid="'+n[t].sv_relation_id+'" readonly="" value="'+r+'" type="text" id="'+n[t].sv_field_id+'" data-id="'+n[t].sv_field_id+'" name="memberCustom" maxlength="100" placeholder="\u9009\u62e9\u65e5\u671f"/>',i+='<input type="button" class="width25 btn button btn-info editmsm" id="" value="\u7f16\u8f91">',parseInt(n[t].sv_field_id||0)>parseInt($("#shijiantixinid").val()||0)&&$("#shijiantixinid").val(n[t].sv_field_id)):i+='<input type="text" class="form-control" value="'+u+'" data-relationid="'+n[t].sv_relation_id+'" id="" data-id="'+n[t].sv_field_id+'" name="memberCustom" maxlength="100" placeholder="'+n[t].sv_field_name+'"/>',i+=" <\/li>";$("#customFieldHtml").html(i)}})}function o(n){var t=layer.index;$.get("/ajaxdata/GetMemberList/1",{key:n,pageSize:30},function(n){for(var r="",i=0;i<n.length;i++)r+='<tr data-user_id="'+n[i].user_id+'"  data-sv_mr_cardno="'+n[i].sv_mr_cardno+'" data-id="'+n[i].member_id+'" data-name="'+n[i].sv_mr_name+'" data-isoverdue="'+n[i].isOverdue+'">',r+="<td><span>"+n[i].sv_mr_cardno+"<\/span><\/td>",r+='<td><span class="amountcolor2">'+n[i].sv_mr_name+"<\/span><\/td>",r+="<td><span>"+n[i].sv_mr_mobile+"<\/span><\/td>",r+='<td><i class="colorff">\u00a5'+parseFloat(n[i].sv_mw_availableamount).toFixed(2)+"<\/i><\/td>",n[i]!=null&&n[i].sv_mw_credit!=null?(r+="<td><i>\u00a5"+n[i].sv_mw_credit+"<\/i><\/td>",parseFloat(n[i].sv_mw_credit||0)<=0&&$("#collection").text("\u6536\u6b3e\u8bb0\u5f55")):(r+="<td><i>\u00a50.00<\/i><\/td>",$("#collection").text("\u6536\u6b3e\u8bb0\u5f55")),r+=isNullOrWhiteSpace(n[i].sv_ml_name)?"<td><span>"+n[i].sv_ml_name+"<\/span><\/td>":"<td><span><\/span><\/td>",r+="<td><span>"+n[i].sv_mw_availablepoint+"<\/span><\/td>",r+='<td class="changeproduct3" id="'+n[i].sv_mr_status+'"><button type="button" class="xianzhehuiyan serviceProductSelect btn editproductinfo" id="'+n[i].sv_mr_status+'" data-isoverdue="'+n[i].isOverdue+'">\u9009\u62e9<\/button><\/td>',r+="<\/tr>";$("#memberListLength").html(n.length);$("#memberReferrals").html(r);$("#memberReferrals").on("click",".xianzhehuiyan",function(){$(this).data("isoverdue")?layer.msg("\u6b64\u5361\u5df2\u8fc7\u671f"):this.id==1?layer.msg("\u6b64\u5361\u5df2\u6302\u5931"):($("#sv_recommended_peopleid").val($(this).parent().parent().data("id")),$("#sv_recommended_peoplename").val($(this).parent().parent().data("name")),layer.close(t))});$("#memberReferrals").on("dblclick","tr",function(){$(this).data("isoverdue")?layer.msg("\u6b64\u5361\u5df2\u8fc7\u671f"):$(this).find("td").eq(6).attr("id")==1?layer.msg("\u6b64\u5361\u5df2\u6302\u5931"):($("#sv_recommended_peopleid").val($(this).data("id")),$("#sv_recommended_peoplename").val($(this).data("name")),layer.close(t))});$("#cleanRecommendpersonBtn").click(function(){$("#sv_recommended_peopleid").val("");$("#sv_recommended_peoplename").val("")})})}function u(t){r();n(t);selectexpirationdateTime("sv_mr_birthday");selectexpirationdateTime("sv_mr_deadline");selectDateReminderTime("dateReminder");$("#sv_mr_birthday").val(nowDateTime());s(t);issupplement_falg&&$("#sv_mr_cardno").removeAttr("disabled")}function s(n){$.get("/Ajaxdata/GetUserModel?id="+n,function(n){var t,i;if(n){for(t in n)t=="sv_mr_cardno"&&($("."+t).val(n[t]),$("#"+t).val(n[t])),t=="sv_mr_birthday"||t=="sv_mr_deadline"?(i="",isNullOrWhiteSpace(n[t])&&(i=n[t].substr(0,4),i=i==1||i==9999?"":new Date(n[t]).Format("yyyy-MM-dd")),$("#"+t).val(i)):t=="sv_mr_headimg"?(n[t]&&($(".addmemberphoto2").hide(),$("#newmemberphoto").show().attr("src",_g_res_images_url+n[t])),$("#"+t).val(n[t])):t!="issupplement_id"&&($("#"+t).val(n[t]),t=="sv_mw_availableamount"&&$("#sv_mrr_money").val(n[t]));getUserdata=n}})}var t="";$("#addNewMember").click(function(){layerpage.Deke_layerpage.show_Url2("1","\u65b0\u589e\u4f1a\u5458","/member/_PartialMemberOperate_N3?buttonCode=btn_add_member_code",["790px","520px"],f)});$(document).unbind("click","#settingproject").on("click","#settingproject",function(){layerpage.Deke_layerpage.show_Url2("2",'\u8bbe\u7f6e\u5e38\u7528\u9879<input type="hidden" id="layerCloseIndex" value="'+(layer.index+1)+'" />',"/ajaxHtml_N3/product/setproject.html?="+getTimeStamp(),["470px","450px"],e)});$(document).unbind("click","#notCommonItemsHtml .deletememberproject").on("click","#notCommonItemsHtml .deletememberproject",function(){var t=$(this).data("id");return $.post("/AjaxProduct/UpdateCustomFieldCommonItems?id="+t,function(t){t==!0?(layer.msg("\u5220\u9664\u6210\u529f"),i(),n("")):t==-2?layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650"):layer.msg("\u5220\u9664\u5931\u8d25")}),!1});$(document).on("click",".more-infolist-btn",function(){$(this).parent().hide();$("#morenewmemberinfo_ul").find(".morenewmemberinfo_li").addClass("lishow")});$(document).on("click",".addfield",function(){var n=$(this).data("type");n==0?$("#colosememtype").val(0):$("#colosememtype").val(1);$(this).addClass("active").siblings("a.addfield").removeClass("active");$(".addfieldbox").slideDown(200);$(".centercontent").addClass("padbom50")});$(document).unbind("click","#addmemberproject").on("click","#addmemberproject",function(){$("#projectinputbox").children("input").length>5?layer.msg("\u4e00\u6b21\u6027\u6700\u591a\u6dfb\u52a06\u4e2a"):$("#projectinputbox").append('<input type="text" value="" name="custom" placeholder="\u5b57\u6bb5\u540d\u79f0">')});$(document).on("click",".closesetprojectpage",function(){layer.close($("#layerCloseIndex").val())});$(document).on("click","#colosememberproject",function(){$(".addfieldbox").hide();$("#projectinputbox").html("");$(".centercontent").removeClass("padbom50")});$(document).unbind("click","#confirmaddproject").on("click","#confirmaddproject",function(){var t=$("#projectinputbox input"),n=!1,r=$("#colosememtype").val(),i;t.length<=0?layer.msg("\u6dfb\u52a0\u7684\u81ea\u5b9a\u4e49\u9879\u76ee\u4e0d\u80fd\u4e3a\u7a7a\uff01"):(i=t.map(function(t,i){if(i.value!=null&&i.value!=undefined&&i.value!=""){var u="false";if(i.value.length>10)layer.msg("\u5b57\u7b26\u7684\u957f\u5ea6\u6700\u957f\u4e3a10"),n=!1;else return n=!0,r==1&&(u="true"),{sv_field_name:$(this).val(),sv_is_remind_time:u}}else n=!1,layer.msg("\u6709\u81ea\u5b9a\u4e49\u8fd8\u6ca1\u6709\u8f93\u5165\uff01")}).get(),n&&$.ajax({url:"/Ajaxdata/AddMemberCustomField",data:JSON.stringify(i),type:"POST",contentType:"application/json"}).success(function(n){var t,i,u,r;if(n!=!1){for(t=0;t<n.length;t++)i="",u=n[t].sv_field_value!=null&&n[t].sv_field_value!=""?n[t].sv_field_value:"",i+=" <li>",i+=n[t].sv_field_name.length>=4?'<label class="labelinfo">'+n[t].sv_field_name+"<\/label>":'<label class="labelinfo">'+n[t].sv_field_name+strPlaceholder(4-n[t].sv_field_name.length)+"<\/label>",n[t].sv_is_remind_time?(r="",n[t].sv_field_value&&(r=n[t].sv_field_value),i+='<input note="'+n[t].sv_remark+'" class="form-control width70 dateReminder"  data-relationid="'+n[t].sv_relation_id+'" readonly="" value="'+r+'" type="text" id="'+n[t].sv_field_id+'" data-id="'+n[t].sv_field_id+'" name="memberCustom" maxlength="100" placeholder="\u9009\u62e9\u65e5\u671f"/>',i+='<input type="button" class="width25 btn editmsm button btn-info" id="" value="\u7f16\u8f91">',parseInt(n[t].sv_field_id||0)>parseInt($("#shijiantixinid").val()||0)&&$("#shijiantixinid").val(n[t].sv_field_id)):i+='<input type="text" class="form-control" value="'+u+'" data-relationid="'+n[t].sv_relation_id+'" id="" data-id="'+n[t].sv_field_id+'" name="memberCustom" maxlength="100" placeholder="'+n[t].sv_field_name+'"/>',i+="<\/li>",$("#customFieldHtml").append(i);$(".addfieldbox").css("display","none");$("#projectinputbox").html("");selectDateReminderTime("dateReminder")}else n==-1?(layer.msg("\u81ea\u5b9a\u4e49\u5b57\u6bb5\u6700\u591a\u53ea\u80fd\u6dfb\u52a0\u5341\u4e2a\uff01"),$(".addfieldbox").css("display","none"),$("#projectinputbox").html("")):layer.msg("\u6dfb\u52a0\u5931\u8d25\uff01")}))});$(document).unbind("click","#sv_recommended_peoplename").on("click","#sv_recommended_peoplename",function(){layerpage.Deke_layerpage.show_Url2("2","\u9009\u62e9\u63a8\u8350\u4eba","/ajaxHtml_N3/member/selectReferrals.html?="+getTimeStamp(),["790px","520px"],o)});$(document).unbind("click","#saveNewMemberBtn").on("click","#saveNewMemberBtn",function(){member.addNewMember("Single")});$(document).unbind("click","#saveNewMemberOrAddBtn").on("click","#saveNewMemberOrAddBtn",function(){member.addNewMember("more")});$(document).unbind("click","#customFieldHtml .editmsm").on("click","#customFieldHtml .editmsm",function(){$("#customFieldHtml .editmsm").removeClass("active");$(this).addClass("active");var n=$(this).prev("input").attr("id"),t=$(this).prev("input").attr("note");$("#ziduanid").val(n);layerpage.Deke_layerpage.show_Url2("1",'\u6d88\u606f\u5185\u5bb9<input type="hidden" id="gduanxinneirong" value="'+t+'" />',"/html/Member/editmsm.html?v="+getTimeStamp(),["400px","310px"],null)});$(document).on("change",".fileToUpload",function(){$.commonUploadImg("fileToUpload","Member","true",function(n){if(n){$(".addmemberphoto2").hide(0);$("#newmemberphoto").show(0).attr("src",_g_res_images_url+n);var t=$("#sv_mr_headimg");t.val(n)}})});$(document).unbind("click","#memberlist .editThisMember").on("click","#memberlist .editThisMember",function(){var t=$(this).data("sv_mr_status"),n=$(this).data("id");if(!editCrossShopMemberControl(n,$(this).parent().parent().find(".memberdetailedinfo").data("user_id"))){layer.msg("\u7981\u6b62\u8de8\u5e97\u7f16\u8f91");return}layerpage.Deke_layerpage.getpage2("1","\u4fee\u6539\u4f1a\u5458\u8d44\u6599","/member/_PartialEditMemberOperate_N3?buttonCode=btn_add_member_code",["790px","520px"],u,n)});$("#supplement").click(function(){var n=$("#memberlist").find('.checkinput[name="memberchecked"]:checked'),i=n.attr("id"),t=n.val();if(!editCrossShopMemberControl(t,n.parent().parent().find(".memberdetailedinfo").data("user_id"))){layer.msg("\u7981\u6b62\u8de8\u5e97\u64cd\u4f5c");return}n.length==1?i==1?(issupplement_falg=!0,layerpage.Deke_layerpage.getpage2("1","\u4f1a\u5458\u8865\u5361\u4fe1\u606f","/member/_PartialEditMemberOperate_N3?buttonCode=btn_add_member_code",["790px","520px"],u,t)):layer.msg("\u8be5\u4f1a\u5458\u8981\u6302\u5931\u5728\u8fdb\u884c\u8865\u5361\u64cd\u4f5c"):layer.msg("\u8bf7\u5148\u62e9\u60a8\u8981\u8865\u5361\u7684\u4f1a\u5458\uff0c\u4e0d\u80fd\u9009\u62e9\u591a\u4e2a\uff01")})},addNewMember:function(){var i=$("#sv_mr_cardno"),t=$("#sv_mr_mobile"),o=$("#sv_mr_name"),r,h,s,c,e,u,f,l,a,n;if(isNullOrWhiteSpace($(".sv_mr_cardno").val())||$(".sv_mr_cardno").attr("disabled","disabled"),isNullOrEmpty(i.val())){if(i.val().length>20)return layer.msg("\u4f1a\u5458\u5361\u53f7\u957f\u5ea6\u5fc5\u987b\u5c0f\u4e8e20\u4f4d\uff01"),i.focus(),!1;if($("#member_id").val()==""){if(!WriteICCardInfo(i.val()))return layer.msg("\u53d1\u5361\u5931\u8d25\uff01"),!1;if(r=!1,$.ajax({url:"/Ajaxdata/Issv_mr_cardno",data:{sv_mr_cardno:i.val()},method:"POST",async:!1,success:function(n){r=n}}),!r)return layer.msg("\u8be5\u5361\u53f7\u5df2\u7ecf\u6ce8\u518c\u8fc7\u4f1a\u5458\uff0c\u8bf7\u67e5\u6b63\u518d\u8f93\u5165\uff01"),$("#sv_mr_cardno").focus(),r}else if(getUserdata.sv_mr_cardno!=i.val()&&(r=!1,$.ajax({url:"/Ajaxdata/Issv_mr_cardno",data:{sv_mr_cardno:i.val()},method:"POST",async:!1,success:function(n){r=n}}),!r))return layer.msg("\u8be5\u5361\u53f7\u5df2\u7ecf\u6ce8\u518c\u8fc7\u4f1a\u5458\uff0c\u8bf7\u67e5\u6b63\u518d\u8f93\u5165\uff01"),$("#sv_mr_cardno").focus(),r}else return layer.msg("\u4f1a\u5458\u5361\u53f7\u8fd8\u6ca1\u6709\u8f93\u5165\uff01"),i.focus(),!1;if(o.val()=="")return layer.msg("\u8fd8\u6ca1\u6709\u8f93\u4f1a\u5458\u59d3\u540d\uff01"),o.focus(),!1;if(o.val().length>15)return layer.msg("\u4f1a\u5458\u59d3\u540d\u957f\u5ea6\u5fc5\u987b\u5c0f\u4e8e15\u4f4d\uff01"),o.focus(),!1;if(t.val()=="")return layer.msg("\u8bf7\u8f93\u5165\u4f1a\u5458\u624b\u673a\u53f7\u7801\uff01"),t.focus(),!1;if($("#member_id").val()=="")if(s=/^1[3|4|5|6|7|8|9]\d{9}$/,s.test(t.val())){if(h=!1,$.ajax({url:"/Ajaxdata/IsUserMoble",data:{mobile:t.val()},method:"POST",async:!1,success:function(n){h=n}}),!h)return layer.msg("\u8be5\u624b\u673a\u53f7\u7801\u5df2\u7ecf\u6ce8\u518c\u8fc7\u4f1a\u5458\uff01"),$("#sv_ul_mobile").focus(),h}else return layer.msg("\u8bf7\u8f93\u5165\u6b63\u786e\u624b\u673a\u53f7\u7801\uff01~"),t.focus(),!1;else if(getUserdata.sv_mr_mobile!=t.val())if(s=/^1[3|4|5|7|8]\d{9}$/,s.test(t.val())){if(c=!1,$.ajax({url:"/Ajaxdata/IsUserMoble",data:{mobile:t.val()},method:"POST",async:!1,success:function(n){c=n}}),!c)return layer.msg("\u8be5\u624b\u673a\u53f7\u7801\u5df2\u7ecf\u6ce8\u518c\u8fc7\u4f1a\u5458\uff01"),$("#sv_ul_mobile").focus(),c}else return layer.msg("\u8bf7\u8f93\u5165\u6b63\u786e\u624b\u673a\u53f7\u7801\uff01~"),t.focus(),!1;if(e=[],u=$("#customFieldHtml").find('input[name="memberCustom"]'),u.length>0)for(f=0;f<u.length;f++)l={sv_field_id:$(u[f]).data("id"),sv_field_value:$(u[f]).val(),sv_relation_id:$(u[f]).data("relationid")},e.push(l);$("#sv_mr_cardno").val($("#sv_mr_cardno").val().replace(/(^\s*)|(\s*$)/g,""));a=$("#Adduserform").serializeArray();n='{"CustomFieldList":"",';$.each(a,function(t,i){n+='"'+i.name+'":"'+i.value+'",'});n=n.substring(0,n.length-1)+"}";n=JSON.parse(n);e=JSON.stringify(e);n.CustomFieldList=JSON.parse(e);n.sv_mrr_money||(n.sv_mrr_money="0");n.sv_mrr_present||(n.sv_mrr_present="0");n.sv_mrr_payment||(n.sv_mrr_payment="\u73b0\u91d1");n.sv_mr_birthday&&(n.sv_mr_birthday+=" 08:00");issupplement_falg&&(n.issupplement_id=1);disableButtonById("saveNewMemberBtn");disableButtonById("saveNewMemberOrAddBtn");$.ajax({url:"/Ajaxdata/PostAddreg?userid="+$("#userid").val(),data:JSON.stringify(n),type:"POST",contentType:"application/json",success:function(n){issupplement_falg=!1;enabledButtonById("saveNewMemberOrAddBtn");$("#sv_mr_cardno").removeAttr("disabled");n==!0?(g_AutomaticallyGenerateMemberId&&($("#member_id").val()==null||$("#member_id").val()=="")&&setAutoIdplusOne("\u662f\u5426\u81ea\u52a8\u751f\u6210\u4f1a\u5458id","AutomaticallyGenerateMemberId","AutomaticallyGenerateMemberId"),layer.closeAll(),member.getStatisticsInfo(),member.getMemberListPage(),getUserdata=null,layer.msg("\u4fdd\u5b58\u6210\u529f")):n==-2?(layer.closeAll(),layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650")):n==-4?(layer.closeAll(),layer.msg("\u4f1a\u5458\u6570\u5df2\u4e0a\u9650")):n==-3?(layer.closeAll(),layer.msg("\u5f53\u524d\u4f1a\u5458\u4e0d\u652f\u6301\u8de8\u5e97\u64cd\u4f5c")):layer.closeAll()}})},memberDetailedInfo:function(){function r(n){var t=n.member_id;$("#hidden_member_id").val(t);$("#hidden_user_id").val(n.user_id);$.get("/Ajaxdata/GetUserModel?id="+t,function(n){var t,i,r;n&&n.sv_mr_platenumber&&$("#edit")&&_g_sv_uit_cache_name=="cache_name_auto_beauty"&&($(".sv_mr_platenumber").show(),$("#sv_mr_platenumber").val(n.sv_mr_platenumber));n!=null&&n.sv_mw_credit!=null&&($(".sv_mw_credit").text(n.sv_mw_credit),parseFloat(n.sv_mw_credit)<=0&&$("#collection").text("0.00"));for(t in n)t=="sv_mr_birthday"||t=="sv_mr_adddate"||t=="sv_mw_lastcostdate"?(i=new Date(n[t]).Format("yyyy-MM-dd"),i=="1-01-01"&&(i=""),$("."+t).text(i),$("."+t).val(i)):t=="sv_mr_headimg"?n[t]&&$("#sv_mr_headimg,#sv_mr_headimg2").attr("src",_g_res_images_url+n[t]):t=="sv_registration"?(r=n[t]==1?"\u5fae\u4fe1":"\u7ebf\u4e0b",$(".sv_registration").text(r)):t=="sv_mw_lastcostday"?n[t]<=0?$("#consumptionStatistics").html("\u8be5\u4f1a\u5458\u6682\u65f6\u8fd8\u6ca1\u6709\u8d2d\u7269\u8bb0\u5f55\uff01"):$(".sv_mw_lastcostday").html(n[t]):($("#userid").val(n.user_id),$("."+t).text(n[t]),$("."+t).val(n[t]),$("#"+t).text(n[t]))})}function t(n){var t=$("#querydate").find("li.active").data("datetype");t==0&&(t="");$.getJSON("/intelligent/GetIntelligentSalesList/?payname=&day="+t+"&type=1&key="+n+"&liushui=&page=1&pagesize=20&storeid=-1&memberId="+n+"",function(n){var i,f,e,r,s;if(n&&n.orderList){var u=n.orderList,o="",t=" ";if(u.length>0){for(i=0;i<u.length;i++){for(f=n.orderList[i].prlist,e="",t+="<tr>",t+="<td>"+u[i].order_id+"<\/td>",t+='<td class="amountcolor2">',r=0;r<f.length;r++)o=f[r].sv_pricing_method==0?f[r].product_num:f[r].sv_p_weight,e+="<p>"+f[r].product_name+"\u00d7"+o+"<\/p>";t+=""+e+'<\/td><td class="colorff">\u00a5'+(u[i].order_receivable||0).toFixed(2)+"<\/td>";t+="<td>"+new Date(u[i].order_datetime).Format("yyyy-MM-dd")+"<\/td>";t+="<td>"+u[i].consumeusername+"<\/td>";t+="<\/tr>"}$("#salesMoney").text(n.totalAmount);$("#memberconsumptionlist").html(t)}else $("#salesMoney").text(n.totalAmount),s=$("#rowlength2").children("th").length,$("#memberconsumptionlist").html('<tr><td class="text-center sad" style="text-align:center !important" colspan="'+s+'"><img src="../skin_N3/images/sad.png" /><i class="padd0">\u6682\u65e0\u6570\u636e<\/i><\/td><\/tr>')}})}function u(n){$.getJSON("/Ajaxdata/GetSavingsList/"+n+"?page=-1",function(n){var r,u,t,i,f;if(n&&n.length>0){for(r=" ",u=0,t=0;t<n.length;t++)i="",n[t].sv_mrr_type==0||n[t].sv_mrr_type==3||n[t].sv_mrr_type==4?(i="+",u+=parseFloat(n[t].sv_mrr_money)):i="-",r+="<tr><td>"+new Date(n[t].sv_mrr_date).Format("yyyy-MM-dd hh:mm:ss")+'<\/td><td class="colorff">\u00a5'+i+parseFloat(n[t].sv_mrr_money).toFixed(2)+'<\/td> <td class="colorff">\u00a5'+parseFloat(n[t].sv_mrr_present).toFixed(2)+"<\/td> <td>"+n[t].consumeusername+"<\/td><td>"+n[t].memberuserName+"<\/td><\/tr>";$("#memberplaylist").html(r);$(".chongji").text(parseFloat(u).toFixed(2))}else f=$("#rowlength3").children("th").length,$("#memberplaylist").html('<tr><td class="text-center sad" style="text-align:center !important" colspan="'+f+'"><img src="../skin_N3/images/sad.png" /><i class="padd0">\u6682\u65e0\u6570\u636e<\/i><\/td><\/tr>')})}function f(n){$.getJSON("/Ajaxdata/GetChargeList/"+n,{clas:"",page:-1},function(n){var i,r,t,u;if(n&&n.length>0){for(i="",r=0,t=0;t<n.length;t++)i+="<tr>",i+="<td>"+n[t].sv_mcr_productname+"<\/td>",i+="<td>"+n[t].sv_mcr_count+'<i class="icon-info-sign tipss sharetips" data-content="\u5f53\u524d\u5145\u6b21\u540e\u5269\u4f59\u6b21\u6570: '+n[t].sv_mcr_countafter+'"><\/td>',i+="<td>"+new Date(n[t].sv_mcr_date).Format("yy-MM-dd")+"<\/td>",i+="<td>"+n[t].consumeusername+"<\/td>",i+="<td>"+n[t].memberuserName+"<\/td>",i+=" <\/tr>",r+=n[t].sv_mcr_money;$("#sv_mcr_money").text(parseFloat(r).toFixed(2));$("#membertotalmoney").html(i)}else u=$("#rowlength4").children("th").length,$("#membertotalmoney").html('<tr><td class="text-center sad" style="text-align:center !important" colspan="5"><img src="../skin_N3/images/sad.png" /><i class="padd0">\u6682\u65e0\u6570\u636e<\/i><\/td><\/tr>')})}function e(n){$.getJSON("/Ajaxdata/GetCharge/"+n,function(n){var r,i,t;if(n&&n.length>0){for(r=[],i="",t=0;t<n.length;t++)r.push(n[t].sv_p_name+"("+n[t].sv_mcc_sumcount+")\u6b21 "),i+="<tr>",i+="<td>"+n[t].sv_p_name+"<\/td>",i+="<td>"+n[t].sv_mcc_leftcount+"<\/td>",i+="<td>"+new Date(n[t].validity_date).Format("yyyy-MM-dd")+"<\/td>",i+="<td class=\"operatinglist-membertimes\" onClick=\"shareRechargeOrTimesFn($('.sv_mr_cardno').text(),'"+n[t].product_id+"','"+n[t].sv_p_name+'\');" data-timeId="'+n[t].product_id+'" data-memberid="'+$(".sv_mr_cardno").text()+'">\u7eed\u5145<\/td>',i+="<\/tr>";$("#membertotaltimelist").html(i);$("#membertotaltimelistbox").show(0);$("#sv_mcc_sumcount").text(r)}})}function o(n){$.getJSON("/Ajaxdata/GetCreditsLog/"+n,function(n){var i,t,r;if(n){for(i="",t=0;t<n.length;t++)r="",r=n[t].sv_mpr_type==0?"+"+n[t].sv_mpr_pointdif:"-"+n[t].sv_mpr_pointdif,i+="<tr><td>"+r+"<\/td> <td>"+n[t].sv_mpr_reason+"<\/td> <td>"+new Date(n[t].sv_mpr_date).Format("yyyy-MM-dd hh:mm:ss")+"<\/td><td>"+n[t].consumeusername+"<\/td><td>"+n[t].memberuserName+"<\/td><\/tr>";$("#memberintegral").html(i)}})}function s(n){$.getAsyncJson("/member/GetGetSmsSmsTotal",{memberId:n,beginDate:null,endDate:null,state:0},function(t){var i=Math.ceil(t/10);$("#memberSmsTotal").html(t);t>0&&laypage({cont:$("#pageSmsSmsList"),pages:i,skin:"molv",first:"\u9996\u9875",last:"\u5c3e\u9875",prev:"\u4e0a\u4e00\u9875",next:"\u4e0b\u4e00\u9875",curr:location.hash.replace("#!page=",""),hash:"page",jump:function(t){h(n,t.curr)}})})}function h(n,t){$.getAsyncJson("/member/GetSmsSmsList",{memberId:n,pageIndex:t,pageSize:10,beginDate:null,endDate:null,state:0},function(n){var t="",i;if(n!=null)for(i=0;i<n.length;i++)t+="<li>",t+="<p>"+n[i].sms_smslist_text+"<\/p>",t+='<span class="fr">'+new Date(n[i].sms_smslistdate).Format("yyyy-MM-dd hh:mm:ss")+"<\/span>",t+="<\/li>";$("#sendinformation").html(t)})}function n(n,t){var i="";$("#collectionList").empty();t==0?$.get("/Ajaxdata/GetArrearsList?memberid="+n,function(n){n&&n.length>0?($.each(n,function(n,t){i+="<tr>";i+='<td><input data-order_id="'+t.sv_mw_order_id+'" data-money="'+t.order_money2+'" type="checkbox" class="checkinput thischecked" name="membercollection" id="" value="" />';i+='<input type="hidden" id="" value="'+t.order_money2+'" /><\/td>';i+='<td class="amountcolor2">'+t.sv_mw_order_id+"<\/td>";i+="<td>"+t.order_payment+"<\/td>";i+='<td class="colorff">\u00a5'+t.order_money2+"<\/td>";i+='<td class="colorff"><input type="text" data-thismoney="'+t.order_money2+'" class="form-control thismoneyinputtext" name="" id="id_'+t.sv_mw_order_id+'" placeholder="\u8f93\u5165\u6536\u8d26\u91d1\u989d" value="'+t.order_money2+'" /><\/td>';i+="<td><span>\u5f85\u4ed8<\/td>";i+="<td>"+new Date(t.order_datetime).Format("yyyy-MM-dd")+"<\/td>";i+="<\/tr>"}),$("#collectionList").html(i)):$("#collectionList").html('<tr><td class="text-center sad" style="text-align:center !important" colspan="7"><img src="../skin_N3/images/sad.png" /><i class="padd0">\u6682\u65e0\u6570\u636e<\/i><\/td><\/tr>')}):$.get("/Ajaxdata/GetRepaymentList?memberid="+n,function(n){n&&n.length>0?($.each(n,function(n,t){i+="<tr>";i+='<td><input data-sv_pay_record_id="'+t.sv_pay_record_id+'" type="checkbox" class="checkinput thischecked" name="" id="" value="" /><\/td>';i+='<td class="amountcolor2">'+t.sv_order_id+"<\/td>";i+="<td>"+t.sv_payment_method_name+"<\/td>";i+='<td class="colorff">\u00a5'+t.sv_money+"<\/td>";i+="<td><span>\u5df2\u4ed8<\/td>";i+="<td>"+new Date(t.sv_date).Format("yyyy-MM-dd")+"<\/td>";i+="<\/tr>"}),$("#collectionList").html(i)):$("#collectionList").html('<tr><td class="text-center sad" style="text-align:center !important" colspan="7"><img src="../skin_N3/images/sad.png" /><i class="padd0">\u6682\u65e0\u6570\u636e<\/i><\/td><\/tr>')})}function i(){var n=0,t=$('#collectionList .thischecked[name="membercollection"]:checked');$.each(t,function(){return n+=parseFloat($("#id_"+$(this).data("order_id")).val()||0)});$("#ctionListMoney").text(n.toFixed(2))}function c(i){var r=$("#hidden_member_id").val();switch(i){case 2:t(r);break;case 3:u(r);break;case 4:e(r);f(r);break;case 5:o(r);break;case 6:n(r,0);break;case 7:s(r)}}$(document).unbind("click",".memberdetailedinfo").on("click",".memberdetailedinfo",function(){var n=$(this).data("member_id"),t=$(this).data("user_id"),i={member_id:n,user_id:t};layerpage.Deke_layerpage.getpage2("1","\u4f1a\u5458\u8be6\u60c5","/ajaxHtml_N3/member/memberinfo.html?="+getTimeStamp(),["740px","520px"],r,i)});$(document).on("click",".pencil",function(){var i=$(this).hasClass("icon-ok");if($(this).removeClass("icon-pencil").addClass("icon-ok"),$(this).siblings(".input-edit").removeAttr("disabled"),$(this).siblings(".input-edit").select(),i){var r=$(this).data("edittype"),t=$(this).siblings("input").val(),n={name:r,value:t};n&&n.name=="sv_mr_birthday"&&(n.value+=" 08:00");$.ajax({url:"/Ajaxdata/updateUser_Noe?id="+$("#hidden_member_id").val()+"&userid="+$("#hidden_user_id").val(),data:JSON.stringify(n),type:"POST",contentType:"application/json",success:function(n){n==!0?(layer.msg("\u4fee\u6539\u6210\u529f!"),$(this).siblings("input").val(t),member.getMemberListPage()):n==-2?layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650"):layer.msg("\u4fee\u6539\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5")}})}});$(document).on("click","#sv_mr_birthday2",function(){selectexpirationdateTime("sv_mr_birthday2")});$(document).unbind("click","#querydate li").on("click","#querydate li",function(){$(this).addClass("active").siblings("li").removeClass("active");var n=$("#hidden_member_id").val();t(n)});$(document).on("click","#memberCollectionStatus>li",function(){$(this).addClass("active").siblings("li").removeClass("active");var t=$(this).data("type"),i=$("#hidden_member_id").val();n(i,t);t==0?($(".maybehidden,#memberCollectionPayType").css("display","block"),$("#ctionListMoney").text(0)):$(".maybehidden,#memberCollectionPayType").css("display","none")});$(document).on("click","#memberCollectionPayType>li",function(){$(this).addClass("active").siblings("li").removeClass("active")});$(document).unbind("click",'#collectionList .thischecked[name="membercollection"]').on("click",'#collectionList .thischecked[name="membercollection"]',function(){i()});$(document).on("keyup","#collectionList .thismoneyinputtext",function(){var n=$(this).data("thismoney"),t=$(this).val();t>n?($(this).val(n),layer.msg("\u8f93\u5165\u5927\u4e8e0\u7684\u6570\u5b57\u6216\u5c0f\u4e8e"+n+"\u7684\u6570\u5b57")):i()});$(document).unbind("click","#consumptionBtn").on("click","#consumptionBtn",function(){var i=$("#collectionList").find(".thischecked[name='membercollection']:checked"),u=parseFloat($("#ctionListMoney").text().trim()||0),r=$("#hidden_member_id").val(),t;i.length>0&&u>0?(t=i.map(function(){var n=$(this).data("order_id");return{orderId:n,money:$("#id_"+n).val(),memberid:r,sv_payment_method_name:$("#memberCollectionPayType>li.active").text(),sv_note:$("#sv_mark").val(),sv_money:$("#id_"+n).val(),sv_operator:_g_user_config.order_operator,maximum:$(this).data("money")}}).get(),t&&t.length>0&&$.ajax({url:"/Ajaxdata/Repayment",data:JSON.stringify(t),type:"POST",contentType:"application/json",success:function(t){t==!0?(n(r,0),$("#ctionListMoney").text(0),layer.msg("\u8fd8\u6b3e\u6210\u529f\uff01")):$("#memberCollectionPayType>li.active").text().indexOf("\u50a8\u503c\u5361")!=-1?layer.msg("\u8fd8\u6b3e\u5931\u8d25,\u50a8\u503c\u5361\u91d1\u989d\u4e0d\u8db3\uff01"):layer.msg("\u8fd8\u6b3e\u5931\u8d25\uff01")}})):layer.msg("\u8bf7\u9009\u62e9\u6536\u6b3e\u7684\u8ba2\u5355\u5e76\u4e14\u6536\u6b3e\u91d1\u989d\u4e0d\u80fd\u4e3a0")});$(document).unbind("click","#memberinfolistnav>li").on("click","#memberinfolistnav>li",function(){var n,t,i;$(this).addClass("active").siblings().removeClass("active");n=$("#memberinfolistnav li").index(this);$(".memberinfocontent").eq(n).fadeIn(100).siblings().fadeOut(0);t=92.5;i=$(this).index()*t+1;$(".border-bottom").animate({left:i+"px"},300);c(n)})},memberImport:function(){function i(){var i,r,t;if($("#viewmemberpage .layui-layer-setwin").hide(0),i=n,$("#layercloseindex").val(layer.index),i!=undefined&&i.length>0){for(r="",t=0;t<i.length;t++)r+='<tr data-sv_mr_cardno="'+i[t].sv_mr_cardno+'" data-member_id="'+i[t].member_id+t+'" ',r+='data-sv_mr_name="'+i[t].sv_mr_name+'" data-sv_mr_mobile="'+i[t].sv_mr_mobile+'" ',r+='data-sv_mr_nick = "'+i[t].sv_mr_nick+'" data-sv_mg_name="'+i[t].sv_mg_name+'" ',r+='data-sv_mr_qq="'+i[t].sv_mr_qq+'" data-sv_mr_wechat="'+i[t].sv_mr_wechat+'" data-sv_mr_email = "'+i[t].sv_mr_email+'" ',r+='data-sv_mr_address = "'+i[t].sv_mr_address+'" data-sv_mr_birthday="'+i[t].sv_mr_birthday+'" ',r+='data-sv_mr_favorite = "'+i[t].sv_mr_favorite+'" data-sv_mr_remark="'+i[t].sv_mr_remark+'" data-sv_mw_availableamount="'+i[t].sv_mw_availableamount+'" ',r+='data-sv_mw_sumamount="'+i[t].sv_mw_sumamount+'" data-sv_mw_availablepoint = "'+i[t].sv_mw_availablepoint+'" data-sv_mw_sumpoint = "'+i[t].sv_mw_sumpoint+'" ',r+='data-sv_mr_adddate= "'+i[t].sv_mr_adddate+'" data-sv_mr_deadline="'+i[t].sv_mr_adddate+'" ',r+=">",r+='<td id="sv_mr_cardno_'+t+'">'+i[t].sv_mr_cardno+"<\/td>",r+='<td id="sv_mr_name_'+t+'">'+i[t].sv_mr_name+"<\/td>",r+='<td id="sv_mr_mobile_'+t+'">'+i[t].sv_mr_mobile+"<\/td>",r+='<td id="sv_mr_nick_'+t+'">'+i[t].sv_mr_nick+"<\/td>",r+='<td id="sv_ml_name_'+t+'">'+i[t].sv_ml_name+"<\/td>",r+='<td id="sv_mg_name_'+t+'">'+i[t].sv_mg_name+"<\/td>",r+='<td id="sv_mr_qq_'+t+'">'+i[t].sv_mr_qq+"<\/td>",r+='<td id="sv_mr_wechat_'+t+'">'+i[t].sv_mr_wechat+"<\/td>",r+='<td id="sv_mr_email_'+t+'">'+i[t].sv_mr_email+"<\/td>",r+='<td id="sv_mr_address_'+t+'">'+i[t].sv_mr_address+"<\/td>",r+=i[t].sv_mr_birthday==null?'<td id="sv_mr_birthday_'+t+'"><\/td>':'<td id="sv_mr_birthday_'+t+'">'+i[t].sv_mr_birthday.replace(/([\d\-]+)T(\d+:\d+)\:.*/,"$1 $2")+"<\/td>",r+='<td id="sv_mr_favorite_'+t+'" >'+i[t].sv_mr_favorite+"<\/td>",r+='<td id="sv_mr_remark_'+t+'">'+i[t].sv_mr_remark+"<\/td>",r+='<td id="sv_mw_availableamount_'+t+'">'+i[t].sv_mw_availableamount+"<\/td>",r+='<td id="sv_mw_sumamount_'+t+'">'+i[t].sv_mw_sumamount+"<\/td>",r+='<td id="sv_mw_availablepoint_'+t+'">'+i[t].sv_mw_availablepoint+"<\/td>",r+='<td id="sv_mw_sumpoint_'+t+'">'+i[t].sv_mw_sumpoint+"<\/td>",r+=i[t].sv_mr_adddate==null?"    <td><\/td>":"<td>"+i[t].sv_mr_adddate.replace(/([\d\-]+)T(\d+:\d+)\:.*/,"$1 $2")+"<\/td>",r+=i[t].sv_mr_deadline==null||i[t].sv_mr_deadline.substr(0,4)=="9999"||i[t].sv_mr_deadline.substr(0,4)=="0001"?"<td ><\/td>":"<td >"+i[t].sv_mr_deadline.replace(/([\d\-]+)T(\d+:\d+)\:.*/,"$1 $2")+"<\/td>",r+="<\/tr>";$("#memberdownlist").html(r)}}function r(){disableButtonById("saveMemberImportBtm");$("#progressbarbox .progress").show();$.getJSON("/member/SaveMember/",{strPath:t},function(n){n.success?(isNullOrWhiteSpace(n.message)?isNullOrWhiteSpace(n.url)&&n.message!="-4"?(layer.msg("\u4fdd\u5b58\u6210\u529f\uff01\u4f46\u662f\u5b58\u5728\u9519\u8bef\u6570\u636e,\u70b9\u51fb\u4e0b\u65b9\u8fde\u63a5\u67e5\u770b"),$("#errordata").show(),$("#errordata").val(n.url),$("#errordata").attr("href",n.url)):n.message=="-4"?layer.msg("\u4fdd\u5b58\u5931\u8d25\uff0c\u8d85\u51fa\u4f1a\u5458\u4e0a\u9650\uff0c\u8bf7\u5347\u7ea7\u9ad8\u7ea7\u7248\u672c"):layer.msg("\u4fdd\u5b58\u5931\u8d25\uff01\u8bf7\u8054\u7cfb\u8d1f\u8d23\u4eba"):(layer.msg("\u4fdd\u5b58\u6210\u529f\uff01"),member.getMemberListPage(),layer.close($("#layercloseindex").val())),enabledButtonById("saveMemberImportBtm"),$("#progressbarbox .progress").hide()):(isNullOrWhiteSpace(n.message)?isNullOrWhiteSpace(n.url)&&n.message!="-4"?(layer.msg("\u4fdd\u5b58\u5931\u8d25\uff01\u8be6\u60c5\u8bf7\u70b9\u51fb\u4e0b\u65b9\u8fde\u63a5\u67e5\u770b"),$("#errordata").show(),$("#errordata").val(n.url),$("#errordata").attr("href",n.url)):n.message=="-4"?layer.msg("\u4fdd\u5b58\u5931\u8d25\uff0c\u8d85\u51fa\u4f1a\u5458\u4e0a\u9650\uff0c\u8bf7\u5347\u7ea7\u9ad8\u7ea7\u7248\u672c"):layer.msg("\u4fdd\u5b58\u5931\u8d25\uff01\u8bf7\u8054\u7cfb\u8d1f\u8d23\u4eba"):layer.msg("\u4fdd\u5b58\u5931\u8d25\uff01"),enabledButtonById("saveMemberImportBtm"),$("#progressbarbox .progress").hide())})}var n=[],t="";$("#updowmmember").click(function(){layerpage.Deke_layerpage.show_Url2("1","\u5bfc\u5165\u4f1a\u5458","/ajaxHtml_N3/member/updowm.html?="+getTimeStamp(),["740px","500px"])});$(document).unbind("click","#updowmembersTemplete").on("click","#updowmembersTemplete",function(){membersTemplete("http://decerp.cc/Templete/\u4f1a\u5458\u5bfc\u5165\u6a21\u677f.xls")});$(document).on("change","#fileToUpload3",function(){$.commonUploadExelFile("fileToUpload3","/api/Member/ImportExecl",function(r){if(r){if(r.Message=="-2"){layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01");return}if(r.Message=="-3"){layer.msg("\u5bfc\u5165\u5931\u8d25\uff01");return}r.Message=="-5"?layer.msg("\u4e0a\u4f20\u6587\u4ef6\u5931\u8d25\uff0c\u8868\u683c\u5b58\u5728\u76f8\u540c\u5361\u53f7\uff01"):r.Message=="-6"?layer.msg("\u4e0a\u4f20\u6587\u4ef6\u5931\u8d25\uff0c\u8868\u683c\u5b58\u5728\u76f8\u540c\u624b\u673a\u53f7\uff01"):r.Success?r.Message!=""&&r.Message!=null&&r.Message.indexOf("\u8868\u683c\u6570\u636e\u6709\u8bef")>=0?r.Url!=""&&r.Url!=null&&r.Url.indexOf("/")>0?layer.msg(r.Message):layer.msg(r.Message):r.Data!=""&&r.Data!=null?(n=r.Data,layerpage.Deke_layerpage.getpage3("\u5bfc\u5165\u4f1a\u5458\u5217\u8868","/ajaxHtml_N3/member/dowmmemberview.html?v="+getTimeStamp(),i,["85%","520px"],"viewmemberpage"),t=r.Url):(layer.msg("\u4e0a\u4f20\u6587\u4ef6\u5931\u8d25\uff0c\u8868\u683c\u6570\u636e\u6709\u8bef\uff01"),layer.close(index)):r.Message!=""&&r.Message!=null&&r.Message.indexOf("\u4e0d\u5c5e\u4e8e\u8868")>0?(layer.msg("\u4e0a\u4f20\u6587\u4ef6\u5931\u8d25\uff01"+r.Message+"\u8bf7\u4e0b\u8f7d\u6700\u65b0\u4f1a\u5458\u5bfc\u5165\u6a21\u677f"),layer.close(index)):(layer.msg("\u4e0a\u4f20\u6587\u4ef6\u5931\u8d25\uff01"),layer.close(index))}})});$(document).unbind("click","#saveMemberImportBtm").on("click","#saveMemberImportBtm",function(){r()});$("#downmemberlist").click(function(){disableButtonById("downmemberlist");var n=0,t=0,i=0,r="",u="",f="";$("#chosen li.active").each(function(){switch($(this).data("name")){case"filtermembergrade":$(this).data("id")==0?u="":n=$(this).data("id");break;case"filtermembergrouping":$(this).data("id")==0?f="":t=$(this).data("id");break;case"filtermemberlabel":r+=$(this).data("id")+",";break;case"filtermemberlost":i=$(this).data("id")}});$.getJSON("/member/ExportData",{dengji:n,fenzhu:t,liusi:i,key:$("#indexquery_like").val(),biaoqian:r},function(n){if(n==-2)layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01");else if(n!=0)if(typeof Cef!="undefined")Cef.Download(n);else if(decerpbrowser&&decerpbrowser.versions&&decerpbrowser.versions.android)try{cordova.plugins.barcodeScanner.dwonloadexcel(function(){},function(n){alert("\u6570\u636e\u5bfc\u51fa\u5931\u8d25: "+n)},{myPrintImg:n})}catch(t){alert("\u6570\u636e\u5bfc\u51fa\u5931\u8d25: "+t.message)}else location.href=n;else layer.msg("\u6570\u636e\u5bfc\u51fa\u5931\u8d25!")});enabledButtonById("downmemberlist")})}};_g_get_cache_name_def.then(function(){member.getMemberListPage();member.getStatisticsInfo();member.getShareInfo();member.shareOperating();member.addNewMemberClick();member.memberDetailedInfo();shareCheckBoxFn("memberlist");member.memberImport()});chosenHtml="";$(document).unbind("click","#filtermembergrade>li,#filtermembergrouping>li,#filtermemberlabel>li,#filtermemberlost>li,#adddateFilter>li").on("click","#filtermembergrade>li,#filtermembergrouping>li,#filtermemberlabel>li,#filtermemberlost>li,#adddateFilter>li",function(){var t=$(this).hasClass("on"),i=$(this).hasClass("active"),r=$(this).hasClass("cl"),u=$(this).find("input").length,n;t||(i?$(this).data("id")!=-1&&($(this).removeClass("active"),$('#chosen>li[data-name="'+$(this).data("name")+'"').remove(),$("[data-id='0'][data-name='"+$(this).data("name")+"']").addClass("active")):($("#chosen").show(0),$(this).addClass("active").siblings("li").removeClass("active"),u==0&&(r&&(n=$(this).data("id"),readyInfo.secondCategory(n)),$(this).data("name")=="filtermemberlost"&&$("#filtermemberlost_date").val(""),$(this).data("name")=="adddateFilter"&&($("#startDate").val(""),$("#endDate").val("")),$('#chosen>li[data-name="'+$(this).data("name")+'"').remove(),chosenHtml=$(this).clone(!0),$(this).data("id")!=0&&chosenHtml.appendTo("#chosen"))))});$("#maxStorage").keyup(function(){$("#storageFilter li").removeClass("active");$("#chosen").find("[data-name='storageFilter']").remove();$("#minStorage").val()!=""&&$("#maxStorage").val()!=""?$("#chosen").append('<li class="active" data-id="-1" data-name="storageFilter" data-number="'+$("#minStorage").val()+"-"+$("#maxStorage").val()+'">'+$("#minStorage").val()+"-"+$("#maxStorage").val()+"<\/li>"):$("#minStorage").val()==""&&$("#maxStorage").val()!=""?$("#chosen").append('<li class="active" data-id="-1" data-name="storageFilter" data-number="\u4e0d\u9650-'+$("#maxStorage").val()+'">\u4e0d\u9650-'+$("#maxStorage").val()+"<\/li>"):$("#minStorage").val()!=""&&$("#maxStorage").val()==""?$("#chosen").append('<li class="active" data-id="-1" data-name="storageFilter" data-number="'+$("#minStorage").val()+'-\u4e0d\u9650">'+$("#minStorage").val()+"-\u4e0d\u9650<\/li>"):$("#storageFilter").find("[data-id='0']").addClass("active")});$("#minStorage").keyup(function(){$("#storageFilter li").removeClass("active");$("#chosen").find("[data-name='storageFilter']").remove();$("#minStorage").val()!=""&&$("#maxStorage").val()!=""?$("#chosen").append('<li class="active" data-id="-1" data-name="storageFilter" data-number="'+$("#minStorage").val()+"-"+$("#maxStorage").val()+'">'+$("#minStorage").val()+"-"+$("#maxStorage").val()+"<\/li>"):$("#minStorage").val()==""&&$("#maxStorage").val()!=""?$("#chosen").append('<li class="active" data-id="-1" data-name="storageFilter" data-number="\u4e0d\u9650-'+$("#maxStorage").val()+'">\u4e0d\u9650-'+$("#maxStorage").val()+"<\/li>"):$("#minStorage").val()!=""&&$("#maxStorage").val()==""?$("#chosen").append('<li class="active" data-id="-1" data-name="storageFilter" data-number="'+$("#minStorage").val()+'-\u4e0d\u9650">'+$("#minStorage").val()+"-\u4e0d\u9650<\/li>"):$("#storageFilter").find("[data-id='0']").addClass("active")});$("#begindate").datetimepicker({language:"zh",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:2,forceParse:0,endDate:new Date,pickerPosition:"bottom-left",format:"yyyy/mm/dd 00:00:00"}).on("change",function(){var n=$("#startDate").val();$("#enddate").datetimepicker("setStartDate",n);$("#adddateFilter li").removeClass("active");$("#chosen").find("[data-name='adddateFilter']").remove();$("#startDate").val()!=""&&$("#endDate").val()!=""?$("#chosen").append('<li class="select active" data-id="-1" data-name="adddateFilter" data-querydate="'+$("#startDate").val()+"-"+$("#endDate").val()+'">'+$("#startDate").val()+"-"+$("#endDate").val()+"<\/li>"):$("#startDate").val()==""?$("#chosen").append('<li class="select active" data-id="-1" data-name="adddateFilter" data-querydate="\u4e0d\u9650-'+$("#endDate").val()+'">\u4e0d\u9650-'+$("#endDate").val()+"<\/li>"):$("#endDate").val()==""&&$("#chosen").append('<li class="select active" data-id="-1" data-name="adddateFilter" data-querydate="'+$("#startDate").val()+'-\u81f3\u4eca">'+$("#startDate").val()+"-\u81f3\u4eca<\/li>");$("#begindate").datetimepicker("hide")});$("#enddate").datetimepicker({language:"zh",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:2,forceParse:0,startDate:$("#startDate").val(),endDate:new Date,pickerPosition:"bottom-left",format:"yyyy/mm/dd 23:59:59"}).on("change",function(){var n=$("#endDate").val();$("#begindate").datetimepicker("setReturnDate",n);$("#adddateFilter li").removeClass("active");$("#chosen").find("[data-name='adddateFilter']").remove();$("#startDate").val()!=""&&$("#endDate").val()!=""?$("#chosen").append('<li class="active" data-id="-1" data-name="adddateFilter" data-querydate="'+$("#startDate").val()+"-"+$("#endDate").val()+'">'+$("#startDate").val()+"-"+$("#endDate").val()+"<\/li>"):$("#startDate").val()==""?$("#chosen").append('<li class="active" data-id="-1" data-name="adddateFilter" data-querydate="\u4e0d\u9650-'+$("#endDate").val()+'">\u4e0d\u9650-'+$("#endDate").val()+"<\/li>"):$("#endDate").val()==""&&$("#chosen").append('<li class="active" data-id="-1" data-name="adddateFilter" data-querydate="'+$("#startDate").val()+'-\u81f3\u4eca">'+$("#startDate").val()+"-\u81f3\u4eca<\/li>");$("#enddate").datetimepicker("hide")});$("#filtermemberlost_date").keyup(function(){$("#chosen").find("[data-name='filtermemberlost']").remove();var n=parseInt($(this).val()||1);$(this).val(n);$("#chosen").append('<li data-id="'+n+'" data-name="filtermemberlost">'+n+"\u5929\u6ca1\u6709\u8d2d\u4e70<\/li>")});$(document).on("click","#chosen>li.active",function(){$(this).remove();$("[data-name='"+$(this).data("name")+"']").removeClass("active");$("[data-id='0'][data-name='"+$(this).data("name")+"']").addClass("active");$("#chosen>li").length==1&&$("#chosen").hide(0)});$(document).on("change","#pagesize",function(){thisUrlNumber=1;pageSize=$("#pagesize").val();member.getMemberListPage()});$("#searchMemberList").click(function(){member.getMemberListPage()});$(document).on("change","#StoreMember,#sellerlist,#sv_reg_source",function(){member.getMemberListPage()});$(document).unbind("click","#memberlist2>li").on("click","#memberlist2>li",function(){$(this).toggleClass("active").siblings("li").removeClass("active")});$(document).unbind("click","#sv_mrr_operator").on("click","#sv_mrr_operator",function(){layerpage.Deke_layerpage.show_Url2("1","\u9009\u62e9\u5458\u5de5","/ajaxHtml_N3/member/selectEmployee.html?="+getTimeStamp(),["450px","300px"],getEmployessInfoFn)});$(document).unbind("click","#employessHtml li").on("click","#employessHtml li",function(){$(this).toggleClass("active")});$(document).unbind("click","#confirmSelectEmployee").on("click","#confirmSelectEmployee",function(){StrEmployeelId="";var n="";$("#employessHtml li").each(function(){$(this).hasClass("active")&&(StrEmployeelId+=$(this).data("employee_id")+",",n+=$(this).data("employee_name")+" ")});StrEmployeelId!=""&&(StrEmployeelId=StrEmployeelId.replace(/,$/gi,""));$("#sv_commissionemployes").val(StrEmployeelId);$("#sv_mrr_operator").val(n);layer.close(layer.index)});$(document).unbind("keyup","#sv_mrr_money").on("keyup","#sv_mrr_money",function(){shareClearNoNum(this);isNullOrWhiteSpace($("#sv_mrr_money").val())&&parseFloat($("#sv_mrr_money").val())>0&&(memberlevel_id!=$("#memberlevel_id").val()&&(getConfigdataBylevel($("#memberlevel_id").val()),memberlevel_id=$("#memberlevel_id").val()),calculateGiving())});$(document).on("change","#memberlevel_id",function(){memberlevel_id!=$("#memberlevel_id").val()&&(getConfigdataBylevel($("#memberlevel_id").val()),calculateGiving(),memberlevel_id=$("#memberlevel_id").val())});$("#memberBirthdayCount").click(function(){member.getMemberListPage(null,"day")});$("#searchMemberList2").click(function(){thisUrlNumber=1;var n=$("#indexquery_like").val();n?member.getMemberListPage():($("#indexquery_like").focus(),layer.msg("\u8bf7\u8f93\u5165\u4fe1\u606f\u5728\u67e5\u8be2"))});$("#indexquery_like").keydown(function(n){if(thisUrlNumber=1,n.keyCode==13)member.getMemberListPage();else if(n.keyCode==113){var t=typeof Cef;t!=undefined&&(GetICCardEventData($("#indexquery_like"),n),$("#indexquery_like").val()&&member.getMemberListPage())}});