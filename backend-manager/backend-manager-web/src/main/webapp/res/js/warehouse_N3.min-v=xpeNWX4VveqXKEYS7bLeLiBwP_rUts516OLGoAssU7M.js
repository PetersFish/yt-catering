$(document).ready(function(){warehouse.getWarehousePage("");warehouse.operating();warehouse.addwarehouse()});var pageSize=10,warehouse={getWarehousePage:function(n){$.get("/WarehouseInfo/WarehouseCount?SearchCriteria="+n,function(t){loggin.chklogn(t);var i=Math.ceil(t/pageSize);laypage({cont:$("#pageGro"),pages:i,skin:"molv",first:"\u9996\u9875",last:"\u5c3e\u9875",prev:"\u4e0a\u4e00\u9875",next:"\u4e0b\u4e00\u9875",jump:function(t){warehouse.getWarehouseList(t.curr,n)}})})},getWarehouseList:function(n,t){$.getJSON("/WarehouseInfo/Warehouselist?pageIndex="+n+"&pageSize="+pageSize+"&SearchCriteria="+t,function(n){var i="",t;if(n!=null&&n!=""&&n.length>0){for(t=0;t<n.length;t++)i+='<tr  class="danpinlisttt">',i+=isNullOrWhiteSpace(n[t].sv_warehouse_name)?'<td class="cour"><span data-id="'+n[t].sv_warehouse_id+'" class="showinfo" >'+n[t].sv_warehouse_name+"<\/span><\/td>":'<td class="cour"><span data-id="'+n[t].sv_warehouse_id+'" class="showinfo" ><\/span><\/td>',i+=isNullOrWhiteSpace(n[t].sv_warehouse_code)?'<td class="amountcolor2"><span>'+n[t].sv_warehouse_code+"<\/span><\/td>":"<td><\/td>",i+=isNullOrWhiteSpace(n[t].sv_warehouse_managers)?"<td><span>"+n[t].sv_warehouse_managers+"<\/span><\/td>":"<td><\/td>",i+=isNullOrWhiteSpace(n[t].sv_warehouse_phone)?"<td><span>"+n[t].sv_warehouse_phone+"<\/span><\/td>":"<td><\/td>",i+=isNullOrWhiteSpace(n[t].sv_warehouse_address)?'<td><i class="icon-info-sign tipss sharetips" data-content="\u5730\u5740\uff1a'+n[t].sv_warehouse_address+'"><\/i><\/td>':"<td><\/td>",i+="<td ><span>"+new Date(n[t].sv_creation_date).Format("yyyy-MM-dd")+"<\/span><\/td>",i+=isNullOrWhiteSpace(n[t].sv_remark)?'<td class="minhide"><span>'+n[t].sv_remark+"<\/span><\/td>":'<td class="minhide"><\/td>',n[t].sv_is_enable?(i+='<td><div class="testswitch">',i+='<input class="testswitch-checkbox" checked="checked" data-id="'+n[t].sv_warehouse_id+'" id="sate_'+n[t].sv_warehouse_id+'" type="checkbox">',i+='<label class="testswitch-label" data-id="'+n[t].sv_warehouse_id+'" for="sate_'+n[t].sv_warehouse_id+'"><span class="testswitch-inner" data-on="\u542f\u7528" data-off="\u6682\u505c"><\/span>',i+='<span class="testswitch-switch"><\/span><\/label><\/div><\/td>'):(i+='<td><div class="testswitch">',i+='<input class="testswitch-checkbox" data-id="'+n[t].sv_warehouse_id+'" id="sate_'+n[t].sv_warehouse_id+'" type="checkbox">',i+='<label class="testswitch-label" data-id="'+n[t].sv_warehouse_id+'" for="sate_'+n[t].sv_warehouse_id+'"><span class="testswitch-inner" data-on="\u542f\u7528" data-off="\u6682\u505c"><\/span>',i+='<span class="testswitch-switch"><\/span><\/label><\/div><\/td>'),i+='<td class="changeproductbuy"><a class="fl editwarehouse" data-id="'+n[t].sv_warehouse_id+'" href="javascript: void(0);">\u4fee\u6539<\/a><a class="fl deletewarehouse" data-id="'+n[t].sv_warehouse_id+'" href="javascript: void(0);">\u5220\u9664<\/a><a class="fl showWarehouseInfo" data-id="'+n[t].sv_warehouse_id+'" href="javascript: void(0);">\u67e5\u770b\u5e93\u5b58<\/a><\/td>';$("#warehouselist").html(i)}else $("#warehouselist").html('<tr><td class="text-center sad" style="text-align:center !important;" colspan="9"><img src="../skin_N3/images/sad.png" /><i class="padd0">\u6682\u65e0\u6570\u636e<\/i><\/td><\/tr>')})},operating:function(){function t(t){$.getJSON("/WarehouseInfo/GetWarehouseInfo?SearchCriteria=&id="+t,function(i){if(i!=""&&i!=null){for(var r in i)r=="sv_creation_date"?$("#"+r).html(new Date(i[r]).Format("yyyy-MM-dd hh:mm:ss")):$("#"+r).html(i[r]);n(t,"");$("#warehouse_id").val(t)}})}function n(n,t){$.get("/supplier/GetWarehouseProduct?warehouseId="+n+"&key="+t,function(n){var i,t,r;if(n==-2)layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650"),layer.close(index);else if(n&&n.length>0){for(i="",t=0;t<n.length;t++)r=n[t].sv_pricing_method==1?n[t].sv_p_weight:n[t].sv_pc_pnumber,i+="<tr> <td><span>"+(t+1)+"<\/span><\/td><td><span>"+n[t].sv_p_barcode+"<\/span><\/td> <td><span>"+n[t].sv_p_name+"<\/span><\/td> <td><span>"+(n[t].sv_p_unit||"")+"<\/span><\/td> <td><span>"+r+"<\/span><\/td><td class='colorff'><i>\u00a5"+parseFloat(n[t].sv_pc_price).toFixed(2)+"<\/i><\/td> <td class='colorff'><i>\u00a5"+parseFloat(n[t].sv_pc_combined).toFixed(2)+"<\/i><\/td> <\/tr>";$("#warehouseProductList").html(i)}else $("#warehouseProductList").html('<tr><td class="text-center sad" style="text-align:center !important;" colspan="7"><img src="../skin_N3/images/sad.png" /><i class="padd0">\u6682\u65e0\u6570\u636e<\/i><\/td><\/tr>')})}$(document).unbind("click","#warehouselist .testswitch-label").on("click","#warehouselist .testswitch-label",function(){var n=$(this).data("id"),t=$("#sate_"+n).prop("checked"),i=t==!1?"\u542f\u7528":"\u6682\u505c";$.postJson("/WarehouseInfo/EnableWarehouse",{id:n,isenable:t},function(n){n==1?(layer.msg("\u4ed3\u5e93"+i+"\u6210\u529f"),setTimeout(function(){warehouse.getWarehousePage("")},500)):n==-2?layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650"):layer.msg("\u4ed3\u5e93"+i+"\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5")})});$("#query_warehouse_like").keypress(function(n){n.keyCode==13&&warehouse.getWarehousePage($(this).val())});$("#query_warehouse_like_btn").click(function(){warehouse.getWarehousePage($("#query_warehouse_like").val())});$(document).unbind("click","#warehouselist .deletewarehouse").on("click","#warehouselist .deletewarehouse",function(){var n=$(this).data("id");$.get("/supplier/GetWarehouseProduct?warehouseId="+n+"&key=",function(n){if(n&&n.length>0){layer.msg("\u8be5\u4ed3\u5e93\u6709\u5e93\u5b58\uff0c\u4e0d\u5141\u8bb8\u5220\u9664\uff01");return}});layer.confirm("\u60a8\u786e\u5b9a\u8981\u5220\u9664\u8be5\u4ed3\u5e93\u5417\uff1f",{btn:["\u786e\u5b9a\u5220\u9664","\u53d6\u6d88"]},function(){$.postJson("/WarehouseInfo/DeleteWarehouse",{id:n},function(n){n==1?(layer.msg("\u4ed3\u5e93\u5220\u9664\u6210\u529f"),warehouse.getWarehousePage("")):n==-2?layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650"):layer.msg("\u4ed3\u5e93\u5220\u9664\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5")})})});$(document).unbind("click","#warehouselist .showWarehouseInfo").on("click","#warehouselist .showWarehouseInfo",function(){var n=$(this).data("id");layerpage.Deke_layerpage.show_Url2("1","\u67e5\u770b\u5e93\u5b58\u8be6\u60c5","/ajaxHtml_N3/stock/warehouseRecording.html?="+getTimeStamp(),["780px","520px"],t(n))});$(document).on("keypress","#keySearch",function(t){if(t.keyCode==13){var i=$("#warehouse_id").val(),r=$(this).val();n(i,r)}});$(document).unbind("click","#keySearchBtn").on("click","#keySearchBtn",function(){var t=$("#warehouse_id").val(),i=$("#keySearch").val();n(t,i)})},addwarehouse:function(){function n(){var i=$("#sv_warehouse_name").val(),r=$("#sv_warehouse_code").val(),u=$("#sv_warehouse_phone").val(),n=!0,t;if(i==""){layer.msg("\u8f93\u5165\u4ed3\u5e93\u540d\u79f0");$("#sv_warehouse_name").focus();n=!1;return}if(r==""){layer.msg("\u8f93\u5165\u4ed3\u5e93\u7f16\u7801");$("#sv_warehouse_code").focus();n=!1;return}if(u==""){layer.msg("\u8f93\u5165\u7535\u8bdd\u53f7\u7801");$("#sv_warehouse_phone").focus();n=!1;return}n&&(t={sv_warehouse_id:$("#sv_warehouse_id").val(),sv_warehouse_name:$("#sv_warehouse_name").val(),sv_warehouse_code:$("#sv_warehouse_code").val(),sv_warehouse_address:$("#sv_warehouse_address").val(),sv_warehouse_managers:$("#sv_warehouse_managers").val(),sv_warehouse_phone:$("#sv_warehouse_phone").val(),sv_is_enable:$("#sv_is_enable").val(),sv_remark:$("#sv_remark").val()},$.postJson("/WarehouseInfo/OperationWarehouse",t,function(n){n==1?(layer.closeAll(),layer.msg("\u64cd\u4f5c\u6210\u529f"),warehouse.getWarehousePage("")):n==2?(layer.msg("\u4ed3\u5e93\u540d\u5df2\u7ecf\u5b58\u5728\u8bb0\u5f55\u4e2d"),$("#sv_warehouse_name").focus()):n==-2?(layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650"),layer.close(index)):n==-1?(layer.msg("\u4ed3\u5e93\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"),$("#sv_warehouse_name").focus()):(layer.closeAll(),layer.msg("\u4ed3\u5e93\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5"))}))}function t(n){$.getJSON("/WarehouseInfo/GetWarehouseInfo?SearchCriteria=&id="+n,function(n){if(n!=""&&n!=null)for(var t in n)t=="sv_is_enable"?$("#sv_is_enable_"+n[t]).attr("selected","selected"):$("#"+t).val(n[t])})}$("#addwarehouse").click(function(){layerpage.Deke_layerpage.show_Url2("1","\u65b0\u589e\u4ed3\u5e93","/ajaxHtml_N3/stock/addwarehouse.html?="+getTimeStamp(),["430px","450px"],null)});$(document).unbind("click","#saveWarehouseBtn").on("click","#saveWarehouseBtn",function(){n()});$(document).unbind("click","#warehouselist .editwarehouse").on("click","#warehouselist .editwarehouse",function(){var n=$(this).data("id");layerpage.Deke_layerpage.show_Url2("1","\u4fee\u6539\u4ed3\u5e93","/ajaxHtml_N3/stock/addwarehouse.html?="+getTimeStamp(),["430px","450px"],t(n))})}};