function InputValidationClose(){clearTimeout(disableInputvalidationInterval1);clearTimeout(disableInputvalidationInterval2)}function disableInputvalidation(n,t){if(_g_DisableManualInput){t==null&&(t=!0);_g_disableInputobj=n;_g_disableInputautoClose=t;var i="";_g_disableInputobj!=null&&(disableInputvalidationInterval1=setInterval(function(){var t,n;if(i!=$(_g_disableInputobj).val()&&(i=$(_g_disableInputobj).val(),InputValidationarrs[InputValidationarrs.length]=disableInputcount),t=0,InputValidationarrs!=null&&InputValidationarrs.length>=2)if(t=InputValidationarrs[1]-InputValidationarrs[0],t>10)$(_g_disableInputobj).val(""),i="",InputValidationarrs=[];else for(n=1;n<InputValidationarrs.length-1;n++)InputValidationarrs[n+1]-InputValidationarrs[n]+10>t&&InputValidationarrs[n+1]-InputValidationarrs[n]-10<t?_g_disableInputautoClose&&InputValidationClose():($(_g_disableInputobj).val(""),i="",InputValidationarrs=[])},"1"),disableInputvalidationInterval2=setInterval(function(){disableInputcount++},"1"))}}function getAutoId(n,t,i){var e,r,u,f;if(PreferentialTopUpGivingConfigList(t,i),Preferential_TopUpGiving_ConfigList!=null&&Preferential_TopUpGiving_ConfigList.length>0)if((g_memberAutoIdstr==null||g_memberAutoIdstr=="")&&(g_memberAutoIdstr=Preferential_TopUpGiving_ConfigList[0].sv_detail_value),g_memberAutoIdstr==null||g_memberAutoIdstr.trim()=="")$(n).val("000001"),g_memberAutoIdstrOld="000002";else if($(n).val(g_memberAutoIdstr),e=parseInt(g_memberAutoIdstr)+1,g_memberAutoIdstrOld=e.toString(),r=6-g_memberAutoIdstrOld.length,r>0){for(u="",f=1;f<=r;f++)u+="0";g_memberAutoIdstrOld=u+g_memberAutoIdstrOld}}function setAutoIdplusOne(n,t,i){g_memberAutoIdstrOld!=null&&g_memberAutoIdstrOld!=""&&(setMemberidAuto(g_memberAutoIdstrOld,n,t,i),g_memberAutoIdstr=g_memberAutoIdstrOld)}function manualSettingsId(n){var u,t,i,r;if(n=DeleteChar(n),u=parseInt(n)+1,g_memberAutoIdstrOld=u.toString(),t=6-g_memberAutoIdstrOld.length,t>0){for(i="",r=1;r<=t;r++)i+="0";g_memberAutoIdstrOld=i+g_memberAutoIdstrOld}}function setMemberidAuto(n,t,i,r){var o,s,u,f,e,h;n=DeleteChar(n);s=n;PreferentialTopUpGivingConfigList(i,r);Preferential_TopUpGiving_ConfigList!=null&&Preferential_TopUpGiving_ConfigList.length>0&&(u=Preferential_TopUpGiving_ConfigList[0].sv_user_config_id,f=Preferential_TopUpGiving_ConfigList[0].sv_user_module_id,o=Preferential_TopUpGiving_ConfigList[0].sv_user_configdetail_id);sv_user_module_config!=null&&(u=sv_user_module_config.sv_user_config_id,f=sv_user_module_config.sv_user_module_id);e=[];h={sv_user_configdetail_id:o,sv_detail_value:s,sv_user_config_id:u,sv_user_module_id:f,sv_detail_is_enable:!0,sv_user_configdetail_name:t,sv_remark:t};e.push(h);$.postAsyncContentJson("/UserModuleConfig/SaveConfigdetailList?moduleCode=AutomaticallyGenerateMemberId",e,function(n){n&&(n==1||(n==-2?layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01"):layer.msg("\u4fdd\u5b58\u5931\u8d25")))})}function DeleteChar(n){var i="",t;if(n)for(t=0;t<n.length;t++)(n[t]=="0"||n[t]=="1"||n[t]=="2"||n[t]=="3"||n[t]=="4"||n[t]=="5"||n[t]=="6"||n[t]=="7"||n[t]=="8"||n[t]=="9")&&(i+=n[t]);return i}function inspectCommitRepeatedlyGetDeleteId(n){for(var t=0;t<g_SubmitIdList.length;t++)if(n==g_SubmitIdList[t])return g_SubmitIdList[t]="",!0;return!1}function inspectCommitRepeatedlyFindIfItExists(n){for(var t=0;t<g_SubmitIdList.length;t++)if(n==g_SubmitIdList[t])return!0;return g_SubmitIdList[g_SubmitIdList.length]=n,!1}function shareReadyInfoText(n,t){var i,r,f,u;if(t)if(t.isOverdue||t.sv_mr_status==1)layer.msg("\u6b64\u4f1a\u5458\u5361\u5df2\u8fc7\u671f\u6216\u6302\u5931\uff01");else for(i in t)i=="sv_mr_birthday"?(r=new Date(t[i]).Format("yyyy-MM-dd"),r=="1970-01-01"&&(r=""),$("#"+n+i).text(r)):i=="sv_mr_deadline"?(f=new Date(t[i]).Format("yyyy-MM-dd"),f=="1970-01-01"?$("#"+n+i).text(""):$("#"+n+i).text(f)):i=="sv_mw_availableamount"||i=="sv_mw_credit"||i=="sv_mw_sumamount"?$("#"+n+i).text(parseFloat(t[i]).toFixed(2)):i=="sv_mr_headimg"?t[i]?$("#"+n+i).attr("src",_g_res_images_url+t[i]):$("#"+n+i).attr("src","/skin_N3/images/001.png"):i=="isOverdue"?(u=t[i]==!1?"\u5426":"\u662f",$("#"+n+i).text(u)):i=="sv_mr_status"?(u=t[i]==1?"\u662f":"\u5426",$("#"+n+i).text(u)):i=="member_id"?$("#"+n+i).val(t[i]):$("#"+n+i).text(t[i])}var InputValidationarrs=[],disableInputcount=0,_g_disableInputobj,_g_disableInputautoClose,_g_DisableManualInput=!1,disableInputvalidationInterval1,disableInputvalidationInterval2,menberData,integral;typeof g_DisableManualInput=="undefined"||(_g_DisableManualInput=g_DisableManualInput);typeof g_memberAutoIdstr=="undefined"&&(g_memberAutoIdstr=!1);$(document).ready(function(){integral.getMenberList("");integral.getIntegralPage("");integral.shareOperating()});menberData="";integral={getMenberList:function(n){var t=new $.Deferred;menberData="";$.get("/ajaxdata/GetMemberList/1",{key:n,pageSize:30}).success(function(n){t.resolve(n)});t.then(function(n){var t,i,r;if(n&&n.length>0){for(t="",menberData=n,i=0;i<n.length;i++)r=n[i].isOverdue==!1?"1":"0",t+='<li data-memberCardId="'+n[i].sv_mr_cardno+'" data-isoverdue="'+r+'">',t+='<div class="fl miinfo">',t+=n[i].sv_mr_headimg?'<img src="'+_g_res_images_url+n[i].sv_mr_headimg+'" onerror="this.src=\'/images/001.png\';" alt="" class="memberIntegralimg fl" />':'<img src="/skin_N3/images/001.png" alt="" class="memberIntegralimg fl" />',t+='<div class="fl name-money">',t+="<span>"+n[i].sv_mr_name+"<\/span> <span>\u50a8\u503c:<i>\uffe5"+parseFloat(n[i].sv_mw_availableamount).toFixed(2)+"<\/i><\/span>",t+="<\/div>",t+="<\/div>",t+='<div class="fr">',t+='<div class="fr name-money">',t+=isNullOrWhiteSpace(n[i].sv_ml_name)?'<i class="integralgrade diamond">'+n[i].sv_ml_name+"<\/i>":'<i class="integralgrade ordinary"><\/i>',t+='<span class="memberphone">'+n[i].sv_mr_mobile+"<\/span>",t+="<\/div>",t+="<\/div>",t+="<\/li>";$("#memberList").html(t);$("#memberList li").eq(0).addClass("active");shareReadyInfoText("m_",menberData[0])}})},getIntegralPage:function(n){$.get("/Integral/Total/",{seach:n},function(t){var i=Math.ceil(t/10);laypage({cont:$("#pageGro"),pages:i,skin:"molv",skip:!0,first:"\u9996\u9875",last:"\u5c3e\u9875",prev:"\u4e0a\u4e00\u9875",next:"\u4e0b\u4e00\u9875",jump:function(t){integral.getMemberIntegralList(t.curr,n)}})})},getMemberIntegralList:function(n,t){$.getJSON("/Integral/PageList/",{pageIndex:n,seach:t},function(n){var i,t,r;if(n&&n.length>0){for(console.log(n),i="",t=0;t<n.length;t++)i+="<tr>",i+="<td>"+n[t].sv_mr_cardno+"<\/td>",i+='<td class="amountcolor2"><span>'+n[t].sv_mr_name+"<\/span><\/td>",i+=isNullOrWhiteSpace(n[t].sv_ml_name)?"<td>"+n[t].sv_ml_name+"<\/td>":'<td class="minhide"><\/td>',i+=n[t].sv_operatorname!=null?'<td class="minhide"><span>'+n[t].sv_operatorname+"<\/span><\/td> ":"<td><span><\/span><\/td> ",n[t].sv_mpr_type==1?(i+="<td>\u6263\u9664\u79ef\u5206<\/td>",i+='<td class="colorff">-'+n[t].sv_mpr_pointdif+"<\/td>"):n[t].sv_mpr_type==0?(i+="<td>\u589e\u52a0\u79ef\u5206<\/td>",i+='<td class="colorff">+'+n[t].sv_mpr_pointdif+"<\/td>"):i+="<td>"+n[t].sv_mpr_type+"<\/td>",i+=n[t].sv_mpr_date.indexOf("1-01-01")>0?'<td class="minhide"><\/td>':'<td class="minhide">'+n[t].sv_mpr_date.replace(/([\d\-]+)T(\d+:\d+)\:.*/,"$1 $2")+"<\/td>",i+=n[t].sv_mpr_reason==null||n[t].sv_mpr_reason==""?"<td><\/td>":"<td>"+n[t].sv_mpr_reason+"<\/td>",i+="<\/tr>";$("#memberIntegralchange").html(i)}else r=$("#rowlength").children("th").length,$("#memberIntegralchange").html('<tr><td class="text-center sad" style="text-align:center !important;" colspan="'+r+'"><img src="../skin_N3/images/sad.png" /><i class="padd0">\u6682\u65e0\u6570\u636e<\/i><\/td><\/tr>')})},shareOperating:function(){function t(t,u){n=u;$.ajax({url:"/System/VerifyEnable?name="+t+"&userid="+user_id,dataType:"json",async:!1}).success(function(n){if(n==1)return u==1?i(0):r(0),!1;if(n==2)return layer.msg("\u4f1a\u5458\u4fe1\u606f\u9519\u8bef\uff01"),!1;n==3&&layerpage.Deke_layerpage.getpage3("\u8bf7\u8f93\u5165\u4f1a\u5458\u5bc6\u7801","/ajaxHtml_N3/share/memberPassword.html?="+getTimeStamp(),null,["380px","190px"],"memberpassword")})}function i(n){var t=$(".shareIntegral:checked").data("type"),i=parseInt($("#integralnumber").val().replace(/\ +/g,"")),r=$("#m_member_id").val();n==1?$.postAsyncJson("/Integral/UpdateIntegral",{type:t,member_id:r,integral:i,user_id:user_id,rankDemotion:rankDemotion,availableIntegralSwitch:availableIntegralSwitch,isPromote:rankPromotionIsON},function(n){n!=null&&(n==!0?(layer.msg("\u64cd\u4f5c\u6210\u529f\uff01"),$("#integralnumber").val(""),integral.getMenberList($("#m_sv_mr_cardno").text()),integral.getIntegralPage($("#m_sv_mr_cardno").text())):n==-2?layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01"):n==-3?($("#userid").val(""),layer.msg("\u5f53\u524d\u4f1a\u5458\u4e0d\u652f\u6301\u8de8\u5e97\u6d88\u8d39")):layer.msg("\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u540e\u518d\u91cd\u8bd5\uff01"))}):layer.confirm("\u786e\u8ba4\u8981\u64cd\u4f5c\u8be5\u4f1a\u5458\u79ef\u5206\u5417\uff1f",{btn:["\u786e\u8ba4","\u53d6\u6d88"]},function(){inspectCommitRepeatedlyFindIfItExists("Integral variation,Increase or decrease")||$.postAsyncJson("/Integral/UpdateIntegral",{type:t,member_id:r,integral:i,user_id:user_id,rankDemotion:rankDemotion,availableIntegralSwitch:availableIntegralSwitch,isPromote:rankPromotionIsON},function(n){inspectCommitRepeatedlyGetDeleteId("Integral variation,Increase or decrease");n!=null&&(n==!0?(layer.msg("\u64cd\u4f5c\u6210\u529f\uff01"),$("#integralnumber").val(""),integral.getMenberList($("#m_sv_mr_cardno").text()),integral.getIntegralPage($("#m_sv_mr_cardno").text())):n==-2?layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01"):n==-3?($("#userid").val(""),layer.msg("\u5f53\u524d\u4f1a\u5458\u4e0d\u652f\u6301\u8de8\u5e97\u6d88\u8d39")):layer.msg("\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u540e\u518d\u91cd\u8bd5\uff01"))})})}function r(n){var t=$("#m_member_id").val();n==1?$.postAsyncJson("/Integral/UpdateIntegral",{type:2,member_id:t,user_id:user_id,rankDemotion:rankDemotion,availableIntegralSwitch:availableIntegralSwitch,isPromote:rankPromotionIsON},function(n){n==!0?(layer.msg("\u64cd\u4f5c\u6210\u529f\uff01"),integral.getMenberList($("#m_sv_mr_cardno").text()),integral.getIntegralPage($("#m_sv_mr_cardno").text())):n==-2?layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01"):n==-3?layer.msg("\u5f53\u524d\u4f1a\u5458\u4e0d\u652f\u6301\u8de8\u5e97\u6d88\u8d39"):layer.msg("\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u540e\u518d\u91cd\u8bd5\uff01")}):layer.confirm("\u786e\u8ba4\u8981\u6e05\u7a7a\u8be5\u4f1a\u5458\u79ef\u5206\u5417\uff1f",{btn:["\u786e\u8ba4","\u53d6\u6d88"]},function(){if(!inspectCommitRepeatedlyFindIfItExists("Integral variation,empty")){var n=parseInt($("#m_sv_mw_availablepoint").text());$.postAsyncJson("/Integral/UpdateIntegral",{type:2,member_id:t,user_id:user_id,integral:n,rankDemotion:rankDemotion,availableIntegralSwitch:availableIntegralSwitch,isPromote:rankPromotionIsON},function(n){inspectCommitRepeatedlyGetDeleteId("Integral variation,empty");n==!0?(layer.msg("\u64cd\u4f5c\u6210\u529f\uff01"),integral.getMenberList($("#m_sv_mr_cardno").text()),integral.getIntegralPage($("#m_sv_mr_cardno").text())):n==-2?layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01"):n==-3?layer.msg("\u5f53\u524d\u4f1a\u5458\u4e0d\u652f\u6301\u8de8\u5e97\u6d88\u8d39"):layer.msg("\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u540e\u518d\u91cd\u8bd5\uff01")})}})}var n="";$("#query_user").keydown(function(n){var i,t;n.keyCode==13?(t=$(this).val().replace(/\ +/g,""),integral.getMenberList(t),integral.getIntegralPage(t)):n.keyCode==113&&(i=typeof Cef,i!=undefined&&(GetICCardEventData($("#query_user"),n),$("#query_user").val()&&(t=$("#query_user").val().replace(/\ +/g,""),integral.getMenberList(t),integral.getIntegralPage(t))))});$("#query_user_btn").click(function(){var n=$("#query_user").val().replace(/\ +/g,"");integral.getMenberList(n);integral.getIntegralPage(n)});$("#btnSaveIntegral").click(function(){var r=$(".shareIntegral:checked").data("type"),i=parseInt($("#integralnumber").val().replace(/\ +/g,"")),n=$("#m_member_id").val(),u=parseInt($("#m_sv_mw_availablepoint").text());i&&n>0?r==0?i>u?layer.msg("\u4f60\u5f53\u524d\u6263\u9664\u7684\u79ef\u5206\u5fc5\u987b\u5c0f\u4e8e\u6216\u7b49\u4e8e\u8be5\u4f1a\u5458\u79ef\u5206!"):t(n,1):t(n,1):($("#integralnumber").focus(),layer.msg("\u8bf7\u8f93\u5165\u79ef\u5206\u6216\u9009\u62e9\u4f1a\u5458\uff01"))});$("#btnClearIntegral").click(function(){var i=$("#m_member_id").val(),n=parseInt($("#m_sv_mw_availablepoint").text());i>0?n==0||n==""||n==null?layer.msg("\u8be5\u4f1a\u5458\u5f53\u524d\u79ef\u5206\u4e3a0\uff0c\u4e0d\u9700\u8981\u518d\u505a\u6e05\u7a7a\u64cd\u4f5c\uff01"):t(i,2):layer.msg("\u8bf7\u9009\u62e9\u4f1a\u5458\u540e\u518d\u8fdb\u884c\u79ef\u5206\u64cd\u4f5c!")});$(document).unbind("click","#confirmMemberPasswordBtn").on("click","#confirmMemberPasswordBtn",function(){var t=$("#memberpassword_number");t.val()!=""?$.post("/System/VerifyEnable",{name:$("#m_member_id").val(),valu:t.val().trim(),userid:user_id},function(u){if(u==1)return n==1?i(1):r(1),layer.close(layer.index),n="",!1;u==4&&(layer.msg("\u4f1a\u5458\u5bc6\u7801\u8f93\u5165\u6709\u8bef"),t.val(""))}):(t.focus(),layer.msg("\u8bf7\u8f93\u5165\u4f1a\u5458\u7684\u5bc6\u7801\uff01"))});$(document).on("keypress","#memberpassword_number",function(t){var u=$("#memberpassword_number");t.which==13&&(u.val()!=""?$.post("/System/VerifyEnable",{name:$("#m_member_id").val(),valu:u.val().trim(),userid:user_id},function(t){if(t==1)return n==1?i(1):r(1),layer.close(layer.index),n="",!1;t==4&&(layer.msg("\u4f1a\u5458\u5bc6\u7801\u8f93\u5165\u6709\u8bef"),u.val(""))}):(u.focus(),layer.msg("\u8bf7\u8f93\u5165\u4f1a\u5458\u7684\u5bc6\u7801\uff01")))})}};$(document).unbind("click","#memberList li").on("click","#memberList li",function(){var n=$(this).index(),t=$(this).data("isoverdue");shareReadyInfoText("m_",menberData[n]);integral.getIntegralPage($(this).data("membercardid"));$(this).addClass("active").siblings("li").removeClass("active")});