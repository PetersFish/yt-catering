function getUserconfig(){$.getJSON("/Ajaxdata/GetUserconfig",function(n){var i,t;if(n){if(n.getMembergroup&&n.getMembergroup.length>0)for(i=n.getMembergroup,t=0;t<i.length;t++)$("#filtermembergrouping").append('<li data-id="'+i[t].membergroup_id+'" data-name="filtermembergrouping">'+i[t].sv_mg_name+"<\/li>");if(n.getUserLevel&&n.getUserLevel.length>0)for(t=0;t<n.getUserLevel.length;t++)$("#filtermembergrade").append('<li data-id="'+n.getUserLevel[t].memberlevel_id+'" data-name="filtermembergrade">'+n.getUserLevel[t].sv_ml_name+"<\/li>")}})}function getCouponRecordCount(){$.get("/CouponRecord/GetQueryCouponRecordInfo",{IsCount:!0,UsingState:-1,IsQueryRecordTotal:!1,IsQueryPageList:!1,queryDayType:-1},function(n){if(n!=null&&n.countInfo!=null)for(var t in n.countInfo)$("#"+t).text(n.countInfo[t])})}function pageLoadCouponRecord(){var t=-1,u=$("#txtSeachCouponStr").val().trim(),n=-1,i="",r="",f=-1,e=-1,o=15;$("#chosen li.active").each(function(){var o=$(this).data("name"),u;switch(o){case"selectUsingState":t=$(this).data("id");break;case"filtermembergrade":f=$(this).data("id");break;case"filtermembergrouping":e=$(this).data("id");break;case"filterdate":u=$(this).data("id");u!=5?n=u:(n=4,i=$("#startDate").val(),r=$("#endDate").val())}});$.get("/CouponRecord/GetQueryCouponRecordInfo",{IsQueryRecordTotal:!0,seachStr:u,UsingState:t,queryDayType:n,beginDate:i,endDate:r,MemberGroupId:f,MemberLevelId:e},function(f){var e=Math.ceil(f.couponRecordTotal/o);laypage({cont:$("#pageCouponRecordList"),pages:e,skin:"molv",skip:!0,first:"\u9996\u9875",last:"\u5c3e\u9875",prev:"\u4e0a\u4e00\u9875",next:"\u4e0b\u4e00\u9875",hash:"page",jump:function(f){getCouponRecordPageList(f.curr,o,u,t,n,i,r)}})})}function getCouponRecordPageList(n,t,i,r,u,f,e){var o="",s=commonOpenLoading();$.getAsyncJson("/CouponRecord/GetQueryCouponRecordInfo",{pageIndex:n,pageSize:t,seachStr:i,UsingState:r,IsQueryPageList:!0,queryDayType:u,beginDate:f,endDate:e,MemberGroupId:$("#selectMemberGroup").val(),MemberLevelId:$("#selectMemberLevel").val()},function(n){var i,t,f,u,r;if(commonCloseLoading(s),n.recordList&&n.recordList!=null&&n.recordList.length>0){for(i=n.recordList,t=0;t<i.length;t++)f=i[t].sv_enabled==!0?"\u662f":"\u5426",u=new Date(i[t].sv_coupon_bendate).Format("yyyy-MM-dd")+"\u81f3"+new Date(i[t].sv_coupon_enddate).Format("yyyy-MM-dd"),i[t].sv_coupon_termofvalidity_type==1&&(u=i[t].sv_coupon_numday+"\u5929"),r=new Date(i[t].sv_modification_date),r=r.getFullYear()>1990?r.Format("yyyy-MM-dd hh:mm:ss"):"",o+="<tr>",o+="<td>"+i[t].sv_coupon_name+"<\/td>",o+="<td>"+(i[t].sv_coupon_type==0?"\u4ee3\u91d1\u5238":"\u6298\u6263\u5238")+"<\/td>",o+="<td>"+i[t].sv_coupon_money+""+(i[t].sv_coupon_type==0?"\u5143":"%")+"<\/td>",o+="<td>"+i[t].sv_coupon_code+"<\/td>",o+="<td>"+i[t].sv_coupon_use_conditions+"\u5143<\/td>",o+="<td>"+(i[t].sv_coupon_termofvalidity_type==0?"\u65e5\u671f":"\u5929\u6570")+"<\/td>",o+="<td>"+u+"<\/td>",o+="<td>"+(i[t].sv_enabled==!0?"\u5df2\u6838\u9500":"\u5f85\u6838\u9500")+"<\/td>",o+="<td>"+new Date(i[t].sv_creation_date).Format("yyyy-MM-dd hh:mm:ss")+"<\/td>",o+="<td>"+r+"<\/td>",o+="<td>"+(isNullOrWhiteSpace(i[t].sv_mr_name)?i[t].sv_mr_name:"")+"<\/td>",o+="<td><\/td>",o+="<\/tr>";$("#CouponRecordTableListHtml").html(o)}else $("#CouponRecordTableListHtml").html('<tr><td class="text-center sad" style="text-align:center !important;" colspan="11"><img src="../skin_N3/images/sad.png" /><i class="padd0">\u6682\u65e0\u6570\u636e<\/i><\/td><\/tr>')})}$(function(){getCouponRecordCount();pageLoadCouponRecord();getUserconfig()});$("#txtSeachCouponStr").keypress(function(n){var t=$(this).val().replace(/\ +/g,"");n.keyCode==13&&(isNullOrWhiteSpace(t)?pageLoadCouponRecord():layer.msg("\u8bf7\u8f93\u5165\u67e5\u8be2\u4fe1\u606f"))});$("#btnCouponRecordExport").click(function(){$.getAsyncJson("/CouponRecord/GetQueryCouponRecordInfo",{seachStr:null,UsingState:-1,IsQueryPageList:!0,queryDayType:-1,beginDate:null,endDate:null,IsReportExport:!0},function(n){n?(n=n.replace(/"/g,""),n?commonDownloadFile(n):layer.msg("\u5bfc\u51fa\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\uff01")):layer.msg("\u5bfc\u51fa\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\uff01")})});var chosenHtml="";$(document).unbind("click","#filtermembergrade>li,#filtermembergrouping>li,#selectUsingState>li,#filterdate>li").on("click","#filtermembergrade>li,#filtermembergrouping>li,#selectUsingState>li,#filterdate>li",function(){var n=$(this).hasClass("on"),t=$(this).hasClass("active"),i=$(this).find("input").length;n||(t?$(this).data("id")!=-1&&($(this).removeClass("active"),$('#chosen>li[data-name="'+$(this).data("name")+'"').remove(),$("[data-id='0'][data-name='"+$(this).data("name")+"']").addClass("active")):($("#chosen").show(0),$(this).addClass("active").siblings("li").removeClass("active"),i==0&&($(this).data("name")=="adddateFilter"&&($("#startDate").val(""),$("#endDate").val("")),$('#chosen>li[data-name="'+$(this).data("name")+'"').remove(),chosenHtml=$(this).clone(!0),chosenHtml.appendTo("#chosen"))))});$("#begindate").datetimepicker({language:"zh",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:2,forceParse:0,endDate:new Date,pickerPosition:"bottom-left",format:"yyyy/mm/dd"}).on("change",function(){var n=$("#startDate").val();$("#enddate").datetimepicker("setStartDate",n);$("#adddateFilter li").removeClass("active");$("#chosen").find("[data-name='filterdate']").remove();$("#startDate").val()!=""&&$("#endDate").val()!=""?$("#chosen").append('<li class="select active" data-id="4" data-name="filterdate" data-querydate="'+$("#startDate").val()+"-"+$("#endDate").val()+'">'+$("#startDate").val()+"-"+$("#endDate").val()+"<\/li>"):$("#startDate").val()==""?$("#chosen").append('<li class="select active" data-id="4" data-name="filterdate" data-querydate="\u4e0d\u9650-'+$("#endDate").val()+'">\u4e0d\u9650-'+$("#endDate").val()+"<\/li>"):$("#endDate").val()==""&&$("#chosen").append('<li class="select active" data-id="4" data-name="filterdate" data-querydate="'+$("#startDate").val()+'-\u81f3\u4eca">'+$("#startDate").val()+"-\u81f3\u4eca<\/li>");$("#begindate").datetimepicker("hide")});$("#enddate").datetimepicker({language:"zh",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:2,forceParse:0,startDate:$("#startDate").val(),endDate:new Date,pickerPosition:"bottom-left",format:"yyyy/mm/dd"}).on("change",function(){var n=$("#endDate").val();$("#begindate").datetimepicker("setReturnDate",n);$("#adddateFilter li").removeClass("active");$("#chosen").find("[data-name='filterdate']").remove();$("#startDate").val()!=""&&$("#endDate").val()!=""?$("#chosen").append('<li class="active" data-id="4" data-name="filterdate" data-querydate="'+$("#startDate").val()+"-"+$("#endDate").val()+'">'+$("#startDate").val()+"-"+$("#endDate").val()+"<\/li>"):$("#startDate").val()==""?$("#chosen").append('<li class="active" data-id="4" data-name="filterdate" data-querydate="\u4e0d\u9650-'+$("#endDate").val()+'">\u4e0d\u9650-'+$("#endDate").val()+"<\/li>"):$("#endDate").val()==""&&$("#chosen").append('<li class="active" data-id="4" data-name="filterdate" data-querydate="'+$("#startDate").val()+'-\u81f3\u4eca">'+$("#startDate").val()+"-\u81f3\u4eca<\/li>");$("#enddate").datetimepicker("hide")});$(document).on("click","#chosen>li.active",function(){$(this).remove();$("[data-name='"+$(this).data("name")+"']").removeClass("active");$("[data-id='0'][data-name='"+$(this).data("name")+"']").addClass("active");$("#chosen>li").length==1&&$("#chosen").hide(0)});$("#searchCouponList,#query_like_btn").click(function(){pageLoadCouponRecord()});