function funcEditCateringCharging(){}function pageLoadCateringCharging(n){var t=20;$.get("/CateringCharging/GetCateringChargingTotal/",{seachStr:n,queryType:queryType},function(i){var r=Math.ceil(i.values/t);laypage({cont:$("#pageCateringChargingList"),pages:r,skin:"molv",groups:0,first:!1,last:!1,jump:function(i){getCateringChargingPageList(i.curr,t,n)}})})}function getCateringChargingPageList(n,t,i){var r="",u=commonOpenLoading();$.getAsyncJson("/CateringCharging/GetCateringChargingPageList",{pageIndex:n,pageSize:t,seachStr:i,queryType:queryType},function(n){var i,t;if(commonCloseLoading(u),n.succeed&&n.values!=null&&n.values.length>0){for(i=n.values,t=0;t<i.length;t++)r+='<li data-id="'+i[t].sv_charging_id+'" data-name="'+i[t].sv_charging_name+'">',r+='<div class="bigCategorieslist-name"><i class="icon-stop stop-type"><\/i><span>'+i[t].sv_charging_name+"<\/span><span> \uff08"+i[t].sv_charging_price+"\u5143\uff09<\/span><\/div>",r+='<div class="editbigCategorieslist">',r+='<a href="javascript:void(0);" class="editcateringRegionList" data-id="'+i[t].sv_charging_id+'" data-name="'+i[t].sv_charging_name+'"><i class="icon-edit"><\/i><\/a>',r+='<a href="javascript:void(0);" class="DeleteCateringRegion " data-id="'+i[t].sv_charging_id+'" data-name="'+i[t].sv_charging_name+'"><i class="icon-remove"><\/i><\/a>',r+="<\/div><\/li>";$("#CateringChargingTableListHtml").html(r);$("#CateringChargingTableListHtml>li:eq(0)").addClass("active");pageLoadCateringChargingRelation($("#CateringChargingTableListHtml li.active").attr("data-id"))}else $("#CateringChargingTableListHtml").html('<li style="padding-left:0;">\u6682\u65e0\u6570\u636e<\/li>')})}function addMoreProductFn(){$.getJSON("/ProductCategory/GetFirstCategory?type=0",function(n){for(var i="",t=0;t<n.length;t++)i+='<li class="click_view" data-id="'+n[t].productcategory_id+'"><i class="icon-stop all"><\/i>'+n[t].sv_pc_name+"<\/li>";Getpackageproduct(0,1);$("#product_list_info").html(i);$(".click_view").click(function(){$("#checkAll").attr("checked",!1);$(this).addClass("active").siblings().removeClass("active");Getpackageproduct($(this).data("id"),1)})})}function Getpackageproduct(n,t){$.getJSON("/AjaxProduct/GetProductList",{category:n,pageIndex:t||1,producttype_id:0,pageSize:20},function(i){var u=i.list,f="",r;if(u.length>0)for(r=0;r<u.length;r++)f+='<tr data-pid="'+u[r].product_id+'" data-pricingmethod="'+u[r].sv_pricing_method+'"><td><input data-pid="'+u[r].product_id+'" data-pricingmethod="'+u[r].sv_pricing_method+'" data-price = '+u[r].sv_p_originalprice+'  type="checkbox" class="checkinput lucky selectcheckbox" name="subbox" value="" style="display:block;width:16px;height:16px;padding-left:0;"/><\/td><td>'+(u[r].sv_p_barcode==null?"":u[r].sv_p_barcode)+"<\/td> <td><span>"+(u[r].sv_p_name==null?"":u[r].sv_p_name)+'<\/span><\/td><td><i class="colorff">\u00a5'+parseFloat(u[r].sv_p_originalprice).toFixed(2)+"<\/i><\/td><td>"+u[r].sv_p_unit+"<\/td> <\/a><\/tr>";$("#product_tbody").html(f);laypage({cont:"pageGro2",pages:i.total,curr:t||1,skin:"molv",skip:!0,first:"\u9996\u9875",last:"\u5c3e\u9875",prev:"\u4e0a\u4e00\u9875",next:"\u4e0b\u4e00\u9875",jump:function(t,i){i||Getpackageproduct(n,t.curr)}})})}function pageLoadCateringChargingRelation(n,t,i){var r=10,u,f;thisPageIndex>1?(u=$("#CateringChargingRelationTableListHtml .deletelinkproduct.active").length,f=$("#CateringChargingRelationTableListHtml tr").length,i=f-u>0?thisPageIndex:thisPageIndex-1>0?thisPageIndex-1:1,getCateringChargingRelationPageList(n,i,r,t)):getCateringChargingRelationPageList(n,1,r,t);$.get("/CateringChargingRelation/GetCateringChargingRelationTotal/",{seachStr:t,chargingId:n},function(u){var f=Math.ceil(u.values/r);laypage({cont:$("#pageCateringChargingRelationList"),pages:f,skin:"molv",curr:i||1,skip:!0,first:"\u9996\u9875",last:"\u5c3e\u9875",prev:"\u4e0a\u4e00\u9875",next:"\u4e0b\u4e00\u9875",jump:function(i,u){thisPageIndex=i.curr;u||getCateringChargingRelationPageList(n,i.curr,r,t)}})})}function getCateringChargingRelationPageList(n,t,i,r){var u="",f=commonOpenLoading();$.getAsyncJson("/CateringChargingRelation/GetCateringChargingRelationPageList",{pageIndex:t,pageSize:i,seachStr:r,chargingId:n},function(n){var i,t,e,r;if(commonCloseLoading(f),n.succeed&&n.values!=null&&n.values.length>0){for(i=n.values,t=0;t<i.length;t++)e=i[t].sv_enabled==!0?"\u662f":"\u5426",r=isNullOrWhiteSpace(i[t].sv_remark)?i[t].sv_remark:"",u+='<tr class="selectChk" data-enabled="true">',u+="<td>"+i[t].sv_p_barcode+"<\/td>",u+="<td>"+i[t].sv_p_name+"<\/td>",u+='<td class="colorff">\u00a5 '+parseFloat(i[t].sv_p_unitprice).toFixed(2)+"<\/td>",u+='<td class="minhide">'+new Date(i[t].sv_creation_date).Format("yyyy-MM-dd")+"<\/td>",u+='<td class="minhide">'+r+"<\/td>",u+='<td class="changeproduct" style="width: 120px;"><a href="javascript:void(0);" data-id="'+i[t].sv_relation_id+'" data-type="0" class="tasteinfo deletelinkproduct">\u5220\u9664<\/a><\/td>',u+="<\/tr>";$("#CateringChargingRelationTableListHtml").html(u)}else $("#CateringChargingRelationTableListHtml").html('<tr><td class="text-center sad" style="text-align:center !important" colspan="6"><img src="../skin_N3/images/sad.png" /><i class="padd0">\u6682\u65e0\u6570\u636e<\/i><\/td><\/tr>')})}var _pageTitle="\u52a0\u6599",queryType=0,thisPageIndex=1;$(function(){queryType=getQueryString("type");queryType==0?_pageTitle="\u52a0\u6599":queryType==1?(_pageTitle="\u89c4\u683c",pageLoadCateringCharging("",queryType)):queryType=0;pageLoadCateringCharging("")});$(document).unbind("click",".selectcheckbox").on("click",".selectcheckbox",function(){var u=$(this).attr("data-type"),n,f,t,i,r;u=="all"?(n=$(this).is(":checked"),n?$("#product_tbody").find(".selectcheckbox").prop("checked",!0):$("#product_tbody").find(".selectcheckbox").prop("checked",!1)):(f=$(this).is(":checked"),t=$('.selectcheckbox[data-type="all"]').is(":checked"),t?$('.selectcheckbox[data-type="all"]').prop("checked",!1):(i=$(".selectcheckbox:checked").length,r=$(".selectcheckbox").length-1,i==r&&$('.selectcheckbox[data-type="all"]').prop("checked",!0)))});$(document).unbind("click","#btnSaveCateringChargingInfo").on("click","#btnSaveCateringChargingInfo",function(){var f=$("#sv_charging_id").val().replace(/\ +/g,""),n=$("#sv_charging_name").val().replace(/\ +/g,""),i=$("#sv_charging_sort").val().replace(/\ +/g,""),t=$("#sv_charging_price").val().replace(/\ +/g,""),e=$("#sv_enabled").is(":checked"),r,u;if(!isNullOrWhiteSpace(n)){layer.msg("\u8bf7\u8f93\u5165"+_pageTitle+"\u540d\u79f0\uff01");$("#sv_charging_name").focus();return}if(n.length>20){layer.msg(""+_pageTitle+"\u540d\u79f0\u4e0d\u80fd\u8d85\u8fc720\u4e2a\u5b57\u7b26\uff01");$("#sv_charging_name").focus();return}if(!parseInt(i)<0){layer.msg("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u6570\u5b57\uff01");$("#sv_charging_sort").focus();return}if(!isNullOrWhiteSpace(t)){layer.msg("\u8bf7\u8f93\u5165"+_pageTitle+"\u4ef7\u683c\uff01");$("#sv_charging_price").focus();return}if(!parseFloat(t)<0){layer.msg("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u91d1\u989d\uff01");$("#sv_charging_price").focus();return}r={sv_charging_id:f,sv_charging_name:n,sv_charging_sort:i,sv_charging_price:t,sv_enabled:e,sv_charging_type:queryType};u=commonOpenLoading();$.postAsyncJson("/CateringCharging/OperateCateringCharging",r,function(n){commonCloseLoading(u);n.succeed?(commondResultMsg("\u4fdd\u5b58\u6570\u636e\u6210\u529f",1,1e3),pageLoadCateringCharging(""),setTimeout(function(){layer.closeAll()},600)):(commondResultMsg(n.errmsg,2,1e3),setTimeout(function(){layer.closeAll()},600))})});$(document).on("click","#CateringChargingTableListHtml li",function(n){n.preventDefault();$(this).addClass("active").siblings("li").removeClass("active");var t=$(this).attr("data-id");pageLoadCateringChargingRelation(t)});$(document).on("mouseover","#CateringChargingTableListHtml li",function(){$(this).addClass("showbg");$(this).children(".editbigCategorieslist").addClass("show");$(this).children(".bigCategorieslist-name").addClass("paddright")});$(document).on("mouseout","#CateringChargingTableListHtml li",function(){$(this).removeClass("showbg");$(this).hasClass("active")||($(this).children(".editbigCategorieslist").removeClass("show"),$(this).children(".bigCategorieslist-name").removeClass("paddright"))});$("#btnAddCateringCharging").click(function(){layerpage.Deke_layerpage.show_Url2("1","\u65b0\u589e"+_pageTitle+"","/CateringCharging/_PartialOperateCateringCharging_N3?chargingId=0",["400px","290px"],"")});$(document).unbind("click","#CateringChargingTableListHtml .editcateringRegionList").on("click","#CateringChargingTableListHtml .editcateringRegionList",function(){var n=$(this).attr("data-id");n>0?layerpage.Deke_layerpage.show_Url2("1","\u4fee\u6539"+_pageTitle+"\u4fe1\u606f","/CateringCharging/_PartialOperateCateringCharging_N3?chargingId="+n,["400px","290px"],funcEditCateringCharging):commondResultMsg("\u8bf7\u9009\u62e9\u7f16\u8f91\u7684\u6570\u636e",3,800)});$(document).unbind("click","#CateringChargingTableListHtml .DeleteCateringRegion").on("click","#CateringChargingTableListHtml .DeleteCateringRegion",function(n){var t=$(this).attr("data-id"),i=$(this).attr("data-name");t>0?layer.confirm("\u662f\u5426\u786e\u8ba4\u5220\u9664\u201c"+i+"\u201d\u8be5\u6570\u636e\uff1f",{btn:["\u662f","\u5426"]},function(){$.postAsyncJson("/CateringCharging/DeleteCateringCharging",{chargingId:t},function(n){n.succeed?(commondResultMsg("\u5220\u9664\u6570\u636e\u6210\u529f\uff01",1,800),pageLoadCateringCharging("")):commondResultMsg(n.errmsg,2,800)})},function(){}):commondResultMsg("\u8bf7\u9009\u62e9\u8981\u5220\u9664\u7684"+_pageTitle+"",3,800);n.preventDefault()});$("#btnRefreshCateringCharging").click(function(){pageLoadCateringCharging("")});$(document).unbind("click","#btnCancel").on("click","#btnCancel",function(){layer.closeAll()});$("#txtSeachCateringCharging").keypress(function(n){if(n.keyCode==13){var t=$(this).val().replace(/\ +/g,"");isNullOrWhiteSpace(t)?pageLoadCateringCharging(t):layer.msg("\u8bf7\u8f93\u5165\u8981\u67e5\u8be2\u7684\u6570\u636e\uff01")}});$(document).on("click","#btnOpenProductCharging",function(){var n=$("#CateringChargingTableListHtml li.active").attr("data-id"),t=$("#CateringChargingTableListHtml li.active").attr("data-name");n>0?layerpage.Deke_layerpage.show_Url2("1","\u9009\u62e9\u5546\u54c1\u5e76\u5173\u8054\u5230 ("+t+")","/ajaxHtml_N3/product/selectProductList.html?="+getTimeStamp(),["790px","520px"],addMoreProductFn):layer.msg("\u8bf7\u9009\u62e9\u52a0\u6599\u533a\u57df\uff01")});$(document).unbind("click","#BtnsavepackageFn").on("click","#BtnsavepackageFn",function(){var n=[],t;$('input.lucky[name="subbox"]:checked').each(function(){var t={sv_charging_id:parseInt($("#CateringChargingTableListHtml li.active").attr("data-id")),product_id:parseInt($(this).attr("data-pid")),sv_relation_id:0,sv_is_active:!0,sv_enabled:!0,sv_charging_type:queryType};n.push(t)});n.length>0?(t=commonOpenLoading(),$.postAsyncContentJson("/CateringChargingRelation/OperateCateringChargingRelation",n,function(n){commonCloseLoading(t);n.succeed?(layer.closeAll(),layer.msg("\u4fdd\u5b58\u6210\u529f\uff01"),pageLoadCateringChargingRelation($("#CateringChargingTableListHtml li.active").attr("data-id"))):layer.msg(n.errmsg)})):layer.msg("\u8bf7\u9009\u62e9\u83dc\u54c1\uff01")});$(document).unbind("click","#CateringChargingRelationTableListHtml .deletelinkproduct").on("click","#CateringChargingRelationTableListHtml .deletelinkproduct",function(){var n=$(this).attr("data-id");$("#CateringChargingRelationTableListHtml .deletelinkproduct").removeClass("active");$(this).addClass("active");n>0?layer.confirm("\u662f\u5426\u786e\u8ba4\u5220\u9664\u8be5\u6570\u636e\uff1f",{btn:["\u662f","\u5426"]},function(){$.postAsyncJson("/CateringChargingRelation/DeleteCateringChargingRelation",{relationId:n},function(n){n.succeed?(commondResultMsg("\u5220\u9664\u6570\u636e\u6210\u529f\uff01",1,800),pageLoadCateringChargingRelation($("#CateringChargingTableListHtml li.active").attr("data-id"))):commondResultMsg(n.errmsg,2,800)})},function(){}):layer.msg("\u8bf7\u9009\u62e9\u8981\u5220\u9664\u7684\u83dc\u54c1\uff01")});