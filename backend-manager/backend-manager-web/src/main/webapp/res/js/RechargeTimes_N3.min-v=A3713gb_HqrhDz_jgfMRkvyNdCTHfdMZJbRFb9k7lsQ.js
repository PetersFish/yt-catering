function salesGetShopNameFn(){$.get("/BranchStore/GetStorelist/?type=0",function(n){var t,i;if(n==-2)layer.msg("\u60a8\u6ca1\u6709\u8be5\u6743\u9650\uff01");else if(n==-1)$("#getshopname").hide();else{$("#getshopname").show();t="";for(i in n)t+=n[i];$("#getshopname").html(t)}})}function salesGetOperatorFn(){var n='<option value="">\u64cd\u4f5c\u5458<\/option>';$.getJSON("/Salesclerk/PageList/",{page:1,pagesize:100},function(t){if(t!=null&&t.length>0)for(var i=0;i<t.length;i++)n+=isNullOrWhiteSpace(t[i].sv_employee_name)?'<option value="'+t[i].sp_salesclerkid+'">'+t[i].sv_employee_name+"<\/option>":'<option value=""><\/option>';$("#getoperator").html(n)})}var pagesize=5,pageIndex=1,rechargeTimesSummary;$(document).ready(function(){salesGetShopNameFn();salesGetOperatorFn();rechargeTimesSummary.getRechangeTimesCountsFn(1,"","","","","");rechargeTimesSummary.exportReport()});$(document).unbind("click","#queryday>li").on("click","#queryday>li",function(){var n=$(this).data("queryday");$(this).addClass("active").siblings("li").removeClass("active");n!=3?($(".querydate").css("display","none"),rechargeTimesSummary.shareQueryRechargeTimesInfoFn()):$(".querydate").css("display","block");$("#otherday").unbind("click").click(function(){rechargeTimesSummary.shareQueryRechargeTimesInfoFn()})});$("#begindate").datetimepicker({language:"zh",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,forceParse:0,endDate:new Date,pickerPosition:"bottom-left"}).on("change",function(){var n=$("#begindateval").val();$("#enddate").datetimepicker("setStartDate",n);$("#begindate").datetimepicker("hide")});$("#enddate").datetimepicker({language:"zh",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,forceParse:0,startDate:$("#begindateval").val(),endDate:new Date,pickerPosition:"bottom-left"}).on("change",function(){var n=$("#enddateval").val();$("#begindate").datetimepicker("setReturnDate",n);$("#enddate").datetimepicker("hide")});$("#getshopname,#getoperator").change(function(){rechargeTimesSummary.shareQueryRechargeTimesInfoFn()});$(document).on("click","#btnOrderQuery",function(){rechargeTimesSummary.shareQueryRechargeTimesInfoFn()});$("#rechangeTimesList").delegate(".revokedRechangeTimes","click",function(){var n=$(this).data("id");layer.confirm("\u60a8\u786e\u8ba4\u8981\u53d6\u6d88\u8be5\u7b14\u5145\u6b21\u5417\uff1f",{btn:["\u786e\u8ba4","\u53d6\u6d88"]},function(){$.post("/intelligent/Post_cancelchans/"+n,function(n){layer.closeAll();loggin.chklogn(n);n>0?(layer.msg("\u64cd\u4f5c\u6210\u529f\uff01"),rechargeTimesSummary.shareQueryRechargeTimesInfoFn()):n==-3?layer.msg("\u73b0\u5728\u7528\u6237\u7684\u8be5\u9879\u76ee\u6b21\u6570\u4e0d\u8db3\u4ee5\u53d6\u6d88\u8be5\u7b14\u8ba2\u5355\uff01"):n==-5?layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01"):layer.msg("\u64cd\u4f5c\u5931\u8d25\uff01")})})});rechargeTimesSummary={shareQueryRechargeTimesInfoFn:function(){var n=$("#queryday>li.active").data("queryday"),t=$("#salesmemberInfo").val().trim(),i=$("#begindateval").val()||"",r=$("#enddateval").val()||"",u=$("#getshopname").val(),f=$("#getoperator").val();rechargeTimesSummary.getRechangeTimesCountsFn(n,t,i,r,u,f)},getRechangeTimesCountsFn:function(n,t,i,r,u,f){$.get("/intelligent/GetchaneCount/",{day:n,key:t,date:i,date2:r,storeid:u,sv_mrr_operator:f},function(e){$("#rowtotal").text(e[0]);$("#moneytotal").text(e[1]);var o=Math.ceil(e[0]/pagesize);laypage({cont:$("#layerpage"),pages:o,skin:"molv",skip:!0,first:"\u9996\u9875",last:"\u5c3e\u9875",prev:"\u4e0a\u4e00\u9875",next:"\u4e0b\u4e00\u9875",jump:function(e){pageinxe=e.curr;rechargeTimesSummary.getRechangeTimesListFn(e.curr,n,t,i,r,u,f)}})})},getRechangeTimesListFn:function(n,t,i,r,u,f,e){$.getJSON("/intelligent/GetchangList/"+n,{day:t,key:i,date:r,date2:u,storeid:f,sv_mrr_operator:e},function(n){var t,i,r;if(n&&n.length>0){for(t="",i=0;i<n.length;i++)t+="<tr> ",t+="<td><span>"+n[i].sv_mr_cardno+"<\/span><\/td>",t+="<td><span>"+n[i].sv_mcr_productname+"<\/span><\/td>",t+="<td><span>"+n[i].sv_mr_name+"<\/span><\/td>",t+="<td><span>"+n[i].sv_mcr_count+"<\/span><\/td>",t+="<td><i>\u00a5"+n[i].sv_mcr_money+"<\/i><\/td>",t+="<td><span>"+n[i].sv_mcr_payment+"<\/span><\/td>",t+=n[i].sv_mcr_operator?"<td><span>"+n[i].sv_mcr_operator.replace(n[i].user_id,"")+"<\/span><\/td>":"<td><span><\/span><\/td>",t+="<td><span>"+new Date(n[i].sv_mcr_date).Format("yyyy-MM-dd")+"<\/span><\/td>",t+="<td><span>"+n[i].consumeusername+"<\/span><\/td>",t+="<td><span>"+n[i].memberuserName+"<\/span><\/td> ",t+='<td class="text-center"><span class="icon-question-sign salestips tipss" data-content="'+n[i].sv_mcr_desc+'"><\/span><\/td> ',t+='<td class="shareexecl">',n[i].sv_mcr_sate?t+='<a style="width:100%;" class="isonereturnclass" href="javascript:void(0);" >\u5df2\u7ecf\u64a4\u9500 <\/a> ':(t+='<a href="javascript:void(0);" class="revokedRechangeTimes" data-id="'+n[i].cardrecharge_id+'">\u64a4\u9500\u5145\u6b21 <\/a>',t+=' <a href="javascript:void(0);"  class=""  data-id="'+n[i].cardrecharge_id+'">\u6253\u5370 <\/a> '),t+="<\/td>",t+="<\/tr> ";$("#rechangeTimesList").html(t)}else r=$("#rowlength").children("th").length,$("#rechangeTimesList").html('<tr><td class="text-center sad" style="" colspan="'+r+'"><img src="../skin_N3/images/sad.png" /><i class="padd0">\u6682\u65e0\u6570\u636e<\/i><\/td><\/tr>')})},exportReport:function(){$("#exportReport").click(function(){disableButtonById("exportReport");$.getJSON("/intelligent/GetchangList/",{day:$("#queryday>li.active").data("queryday"),key:$("#salesmemberInfo").val().trim(),date:$("#begindateval").val()||"",date2:$("#enddateval").val()||"",storeid:$("#getshopname").val(),isexport:1,sv_mrr_operator:$("#getoperator").val()},function(n){n==-2?(enabledButtonById("exportReport"),layer.msg("\u4f60\u6ca1\u6709\u8be5\u64cd\u4f5c\u6743\u9650\uff01")):n!=0?(enabledButtonById("exportReport"),location.href=n):(enabledButtonById("exportReport"),layer.msg("\u6570\u636e\u5bfc\u51fa\u5931\u8d25!"))})})}};$("#salesmemberInfo").keydown(function(n){if(n.keyCode==113){var t=typeof Cef;t!=undefined&&GetICCardEventData($("#salesmemberInfo"),n)}});